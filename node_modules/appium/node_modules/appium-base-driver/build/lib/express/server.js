'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

Object.defineProperty(exports, '__esModule', {
  value: true
});

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _express = require('express');

var _express2 = _interopRequireDefault(_express);

var _http = require('http');

var _http2 = _interopRequireDefault(_http);

var _serveFavicon = require('serve-favicon');

var _serveFavicon2 = _interopRequireDefault(_serveFavicon);

var _bodyParser = require('body-parser');

var _bodyParser2 = _interopRequireDefault(_bodyParser);

var _methodOverride = require('method-override');

var _methodOverride2 = _interopRequireDefault(_methodOverride);

var _logger = require('./logger');

var _logger2 = _interopRequireDefault(_logger);

var _expressLogging = require('./express-logging');

var _middleware = require('./middleware');

var _static = require('./static');

var _crash = require('./crash');

var _websocket = require('./websocket');

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

function server(configureRoutes, port) {
  var hostname = arguments.length <= 2 || arguments[2] === undefined ? null : arguments[2];
  var app, httpServer, close;
  return _regeneratorRuntime.async(function server$(context$1$0) {
    var _this = this;

    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        app = (0, _express2['default'])();
        httpServer = _http2['default'].createServer(app);

        httpServer.addWebSocketHandler = _websocket.addWebSocketHandler;
        httpServer.removeWebSocketHandler = _websocket.removeWebSocketHandler;
        httpServer.removeAllWebSocketHandlers = _websocket.removeAllWebSocketHandlers;
        httpServer.getWebSocketHandlers = _websocket.getWebSocketHandlers;

        // http.Server.close() only stops new connections, but we need to wait until
        // all connections are closed and the `close` event is emitted
        close = httpServer.close.bind(httpServer);

        httpServer.close = function callee$1$0() {
          return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
            while (1) switch (context$2$0.prev = context$2$0.next) {
              case 0:
                context$2$0.next = 2;
                return _regeneratorRuntime.awrap(new _bluebird2['default'](function (resolve, reject) {
                  httpServer.on('close', resolve);
                  close(function (err) {
                    if (err) reject(err); // eslint-disable-line curly
                  });
                }));

              case 2:
                return context$2$0.abrupt('return', context$2$0.sent);

              case 3:
              case 'end':
                return context$2$0.stop();
            }
          }, null, _this);
        };

        context$1$0.next = 10;
        return _regeneratorRuntime.awrap(new _bluebird2['default'](function (resolve, reject) {
          httpServer.on('error', function (err) {
            if (err.code === 'EADDRNOTAVAIL') {
              _logger2['default'].error('Could not start REST http interface listener. ' + 'Requested address is not available.');
            } else {
              _logger2['default'].error('Could not start REST http interface listener. The requested ' + 'port may already be in use. Please make sure there is no ' + 'other instance of this server running already.');
            }
            reject(err);
          });
          httpServer.on('connection', function (socket) {
            socket.setTimeout(600 * 1000); // 10 minute timeout
            socket.on('error', reject);
          });
          configureServer(app, configureRoutes);

          var serverArgs = [port];
          if (hostname) {
            // If the hostname is omitted, the server will accept
            // connections on any IP address
            serverArgs.push(hostname);
          }
          httpServer.listen.apply(httpServer, serverArgs.concat([function (err) {
            if (err) {
              reject(err);
            }
            resolve(httpServer);
          }]));
        }));

      case 10:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 11:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
}

function configureServer(app, configureRoutes) {
  app.use(_expressLogging.endLogFormatter);

  // set up static assets
  app.use((0, _serveFavicon2['default'])(_path2['default'].resolve(_static.STATIC_DIR, 'favicon.ico')));
  app.use(_express2['default']['static'](_static.STATIC_DIR));

  // crash routes, for testing
  app.use('/wd/hub/produce_error', _crash.produceError);
  app.use('/wd/hub/crash', _crash.produceCrash);

  // add middlewares
  app.use(_middleware.allowCrossDomain);
  app.use(_middleware.fixPythonContentType);
  app.use(_middleware.defaultToJSONContentType);
  app.use(_bodyParser2['default'].urlencoded({ extended: true }));
  app.use((0, _methodOverride2['default'])());
  app.use(_middleware.catch4XXHandler);
  app.use(_middleware.catchAllHandler);

  // make sure appium never fails because of a file size upload limit
  app.use(_bodyParser2['default'].json({ limit: '1gb' }));

  // set up start logging (which depends on bodyParser doing its thing)
  app.use(_expressLogging.startLogFormatter);

  configureRoutes(app);

  // dynamic routes for testing, etc.
  app.all('/welcome', _static.welcome);
  app.all('/test/guinea-pig', _static.guineaPig);
  app.all('/test/guinea-pig-scrollable', _static.guineaPigScrollable);
  app.all('/test/guinea-pig-app-banner', _static.guineaPigAppBanner);

  // catch this last, so anything that falls through is 404ed
  app.use(_middleware.catch404Handler);
}

exports.server = server;
exports.configureServer = configureServer;

// create the actual http server
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9leHByZXNzL3NlcnZlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O29CQUFpQixNQUFNOzs7O3VCQUNILFNBQVM7Ozs7b0JBQ1osTUFBTTs7Ozs0QkFDSCxlQUFlOzs7OzBCQUNaLGFBQWE7Ozs7OEJBQ1QsaUJBQWlCOzs7O3NCQUM1QixVQUFVOzs7OzhCQUN5QixtQkFBbUI7OzBCQUVKLGNBQWM7O3NCQUNRLFVBQVU7O3FCQUN2RCxTQUFTOzt5QkFFZixhQUFhOzt3QkFDcEMsVUFBVTs7OztBQUd4QixTQUFlLE1BQU0sQ0FBRSxlQUFlLEVBQUUsSUFBSTtNQUFFLFFBQVEseURBQUcsSUFBSTtNQUV2RCxHQUFHLEVBQ0gsVUFBVSxFQVFWLEtBQUs7Ozs7OztBQVRMLFdBQUcsR0FBRywyQkFBUztBQUNmLGtCQUFVLEdBQUcsa0JBQUssWUFBWSxDQUFDLEdBQUcsQ0FBQzs7QUFDdkMsa0JBQVUsQ0FBQyxtQkFBbUIsaUNBQXNCLENBQUM7QUFDckQsa0JBQVUsQ0FBQyxzQkFBc0Isb0NBQXlCLENBQUM7QUFDM0Qsa0JBQVUsQ0FBQywwQkFBMEIsd0NBQTZCLENBQUM7QUFDbkUsa0JBQVUsQ0FBQyxvQkFBb0Isa0NBQXVCLENBQUM7Ozs7QUFJbkQsYUFBSyxHQUFHLFVBQVUsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQzs7QUFDN0Msa0JBQVUsQ0FBQyxLQUFLLEdBQUc7Ozs7O2lEQUNKLDBCQUFNLFVBQUMsT0FBTyxFQUFFLE1BQU0sRUFBSztBQUN0Qyw0QkFBVSxDQUFDLEVBQUUsQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUM7QUFDaEMsdUJBQUssQ0FBQyxVQUFDLEdBQUcsRUFBSztBQUNiLHdCQUFJLEdBQUcsRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7bUJBQ3RCLENBQUMsQ0FBQztpQkFDSixDQUFDOzs7Ozs7Ozs7O1NBQ0gsQ0FBQzs7O3lDQUVXLDBCQUFNLFVBQUMsT0FBTyxFQUFFLE1B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bGliL2V4cHJlc3Mvc2VydmVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgZXhwcmVzcyBmcm9tICdleHByZXNzJztcbmltcG9ydCBodHRwIGZyb20gJ2h0dHAnO1xuaW1wb3J0IGZhdmljb24gZnJvbSAnc2VydmUtZmF2aWNvbic7XG5pbXBvcnQgYm9keVBhcnNlciBmcm9tICdib2R5LXBhcnNlcic7XG5pbXBvcnQgbWV0aG9kT3ZlcnJpZGUgZnJvbSAnbWV0aG9kLW92ZXJyaWRlJztcbmltcG9ydCBsb2cgZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IHsgc3RhcnRMb2dGb3JtYXR0ZXIsIGVuZExvZ0Zvcm1hdHRlciB9IGZyb20gJy4vZXhwcmVzcy1sb2dnaW5nJztcbmltcG9ydCB7IGFsbG93Q3Jvc3NEb21haW4sIGZpeFB5dGhvbkNvbnRlbnRUeXBlLCBkZWZhdWx0VG9KU09OQ29udGVudFR5cGUsXG4gICAgICAgICBjYXRjaEFsbEhhbmRsZXIsIGNhdGNoNDA0SGFuZGxlciwgY2F0Y2g0WFhIYW5kbGVyIH0gZnJvbSAnLi9taWRkbGV3YXJlJztcbmltcG9ydCB7IGd1aW5lYVBpZywgZ3VpbmVhUGlnU2Nyb2xsYWJsZSwgZ3VpbmVhUGlnQXBwQmFubmVyLCB3ZWxjb21lLCBTVEFUSUNfRElSIH0gZnJvbSAnLi9zdGF0aWMnO1xuaW1wb3J0IHsgcHJvZHVjZUVycm9yLCBwcm9kdWNlQ3Jhc2ggfSBmcm9tICcuL2NyYXNoJztcbmltcG9ydCB7IGFkZFdlYlNvY2tldEhhbmRsZXIsIHJlbW92ZVdlYlNvY2tldEhhbmRsZXIsIHJlbW92ZUFsbFdlYlNvY2tldEhhbmRsZXJzLFxuICAgICAgICAgZ2V0V2ViU29ja2V0SGFuZGxlcnMgfSBmcm9tICcuL3dlYnNvY2tldCc7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5cblxuYXN5bmMgZnVuY3Rpb24gc2VydmVyIChjb25maWd1cmVSb3V0ZXMsIHBvcnQsIGhvc3RuYW1lID0gbnVsbCkge1xuICAvLyBjcmVhdGUgdGhlIGFjdHVhbCBodHRwIHNlcnZlclxuICBsZXQgYXBwID0gZXhwcmVzcygpO1xuICBsZXQgaHR0cFNlcnZlciA9IGh0dHAuY3JlYXRlU2VydmVyKGFwcCk7XG4gIGh0dHBTZXJ2ZXIuYWRkV2ViU29ja2V0SGFuZGxlciA9IGFkZFdlYlNvY2tldEhhbmRsZXI7XG4gIGh0dHBTZXJ2ZXIucmVtb3ZlV2ViU29ja2V0SGFuZGxlciA9IHJlbW92ZVdlYlNvY2tldEhhbmRsZXI7XG4gIGh0dHBTZXJ2ZXIucmVtb3ZlQWxsV2ViU29ja2V0SGFuZGxlcnMgPSByZW1vdmVBbGxXZWJTb2NrZXRIYW5kbGVycztcbiAgaHR0cFNlcnZlci5nZXRXZWJTb2NrZXRIYW5kbGVycyA9IGdldFdlYlNvY2tldEhhbmRsZXJzO1xuXG4gIC8vIGh0dHAuU2VydmVyLmNsb3NlKCkgb25seSBzdG9wcyBuZXcgY29ubmVjdGlvbnMsIGJ1dCB3ZSBuZWVkIHRvIHdhaXQgdW50aWxcbiAgLy8gYWxsIGNvbm5lY3Rpb25zIGFyZSBjbG9zZWQgYW5kIHRoZSBgY2xvc2VgIGV2ZW50IGlzIGVtaXR0ZWRcbiAgbGV0IGNsb3NlID0gaHR0cFNlcnZlci5jbG9zZS5iaW5kKGh0dHBTZXJ2ZXIpO1xuICBodHRwU2VydmVyLmNsb3NlID0gYXN5bmMgKCkgPT4ge1xuICAgIHJldHVybiBhd2FpdCBuZXcgQigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBodHRwU2VydmVyLm9uKCdjbG9zZScsIHJlc29sdmUpO1xuICAgICAgY2xvc2UoKGVycikgPT4ge1xuICAgICAgICBpZiAoZXJyKSByZWplY3QoZXJyKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjdXJseVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG5cbiAgcmV0dXJuIGF3YWl0IG5ldyBCKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBodHRwU2VydmVyLm9uKCdlcnJvcicsIChlcnIpID0+IHtcbiAgICAgIGlmIChlcnIuY29kZSA9PT0gJ0VBRERSTk9UQVZBSUwnKSB7XG4gICAgICAgIGxvZy5lcnJvcignQ291bGQgbm90IHN0YXJ0IFJFU1QgaHR0cCBpbnRlcmZhY2UgbGlzdGVuZXIuICcgK1xuICAgICAgICAgICAgICAgICAgJ1JlcXVlc3RlZCBhZGRyZXNzIGlzIG5vdCBhdmFpbGFibGUuJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsb2cuZXJyb3IoJ0NvdWxkIG5vdCBzdGFydCBSRVNUIGh0dHAgaW50ZXJmYWNlIGxpc3RlbmVyLiBUaGUgcmVxdWVzdGVkICcgK1xuICAgICAgICAgICAgICAgICAgJ3BvcnQgbWF5IGFscmVhZHkgYmUgaW4gdXNlLiBQbGVhc2UgbWFrZSBzdXJlIHRoZXJlIGlzIG5vICcgK1xuICAgICAgICAgICAgICAgICAgJ290aGVyIGluc3RhbmNlIG9mIHRoaXMgc2VydmVyIHJ1bm5pbmcgYWxyZWFkeS4nKTtcbiAgICAgIH1cbiAgICAgIHJlamVjdChlcnIpO1xuICAgIH0pO1xuICAgIGh0dHBTZXJ2ZXIub24oJ2Nvbm5lY3Rpb24nLCAoc29ja2V0KSA9PiB7XG4gICAgICBzb2NrZXQuc2V0VGltZW91dCg2MDAgKiAxMDAwKTsgLy8gMTAgbWludXRlIHRpbWVvdXRcbiAgICAgIHNvY2tldC5vbignZXJyb3InLCByZWplY3QpO1xuICAgIH0pO1xuICAgIGNvbmZpZ3VyZVNlcnZlcihhcHAsIGNvbmZpZ3VyZVJvdXRlcyk7XG5cbiAgICBsZXQgc2VydmVyQXJncyA9IFtwb3J0XTtcbiAgICBpZiAoaG9zdG5hbWUpIHtcbiAgICAgIC8vIElmIHRoZSBob3N0bmFtZSBpcyBvbWl0dGVkLCB0aGUgc2VydmVyIHdpbGwgYWNjZXB0XG4gICAgICAvLyBjb25uZWN0aW9ucyBvbiBhbnkgSVAgYWRkcmVzc1xuICAgICAgc2VydmVyQXJncy5wdXNoKGhvc3RuYW1lKTtcbiAgICB9XG4gICAgaHR0cFNlcnZlci5saXN0ZW4oLi4uc2VydmVyQXJncywgKGVycikgPT4ge1xuICAgICAgaWYgKGVycikge1xuICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgIH1cbiAgICAgIHJlc29sdmUoaHR0cFNlcnZlcik7XG4gICAgfSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBjb25maWd1cmVTZXJ2ZXIgKGFwcCwgY29uZmlndXJlUm91dGVzKSB7XG4gIGFwcC51c2UoZW5kTG9nRm9ybWF0dGVyKTtcblxuICAvLyBzZXQgdXAgc3RhdGljIGFzc2V0c1xuICBhcHAudXNlKGZhdmljb24ocGF0aC5yZXNvbHZlKFNUQVRJQ19ESVIsICdmYXZpY29uLmljbycpKSk7XG4gIGFwcC51c2UoZXhwcmVzcy5zdGF0aWMoU1RBVElDX0RJUikpO1xuXG4gIC8vIGNyYXNoIHJvdXRlcywgZm9yIHRlc3RpbmdcbiAgYXBwLnVzZSgnL3dkL2h1Yi9wcm9kdWNlX2Vycm9yJywgcHJvZHVjZUVycm9yKTtcbiAgYXBwLnVzZSgnL3dkL2h1Yi9jcmFzaCcsIHByb2R1Y2VDcmFzaCk7XG5cbiAgLy8gYWRkIG1pZGRsZXdhcmVzXG4gIGFwcC51c2UoYWxsb3dDcm9zc0RvbWFpbik7XG4gIGFwcC51c2UoZml4UHl0aG9uQ29udGVudFR5cGUpO1xuICBhcHAudXNlKGRlZmF1bHRUb0pTT05Db250ZW50VHlwZSk7XG4gIGFwcC51c2UoYm9keVBhcnNlci51cmxlbmNvZGVkKHtleHRlbmRlZDogdHJ1ZX0pKTtcbiAgYXBwLnVzZShtZXRob2RPdmVycmlkZSgpKTtcbiAgYXBwLnVzZShjYXRjaDRYWEhhbmRsZXIpO1xuICBhcHAudXNlKGNhdGNoQWxsSGFuZGxlcik7XG5cbiAgLy8gbWFrZSBzdXJlIGFwcGl1bSBuZXZlciBmYWlscyBiZWNhdXNlIG9mIGEgZmlsZSBzaXplIHVwbG9hZCBsaW1pdFxuICBhcHAudXNlKGJvZHlQYXJzZXIuanNvbih7bGltaXQ6ICcxZ2InfSkpO1xuXG4gIC8vIHNldCB1cCBzdGFydCBsb2dnaW5nICh3aGljaCBkZXBlbmRzIG9uIGJvZHlQYXJzZXIgZG9pbmcgaXRzIHRoaW5nKVxuICBhcHAudXNlKHN0YXJ0TG9nRm9ybWF0dGVyKTtcblxuICBjb25maWd1cmVSb3V0ZXMoYXBwKTtcblxuICAvLyBkeW5hbWljIHJvdXRlcyBmb3IgdGVzdGluZywgZXRjLlxuICBhcHAuYWxsKCcvd2VsY29tZScsIHdlbGNvbWUpO1xuICBhcHAuYWxsKCcvdGVzdC9ndWluZWEtcGlnJywgZ3VpbmVhUGlnKTtcbiAgYXBwLmFsbCgnL3Rlc3QvZ3VpbmVhLXBpZy1zY3JvbGxhYmxlJywgZ3VpbmVhUGlnU2Nyb2xsYWJsZSk7XG4gIGFwcC5hbGwoJy90ZXN0L2d1aW5lYS1waWctYXBwLWJhbm5lcicsIGd1aW5lYVBpZ0FwcEJhbm5lcik7XG5cbiAgLy8gY2F0Y2ggdGhpcyBsYXN0LCBzbyBhbnl0aGluZyB0aGF0IGZhbGxzIHRocm91Z2ggaXMgNDA0ZWRcbiAgYXBwLnVzZShjYXRjaDQwNEhhbmRsZXIpO1xufVxuXG5leHBvcnQgeyBzZXJ2ZXIsIGNvbmZpZ3VyZVNlcnZlciB9O1xuIl0sInNvdXJjZVJvb3QiOiIuLi8uLi8uLiJ9
