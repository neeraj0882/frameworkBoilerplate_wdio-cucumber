'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _Object$assign = require('babel-runtime/core-js/object/assign')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _wd = require('wd');

var _wd2 = _interopRequireDefault(_wd);

var _helpersSession = require('./helpers/session');

var _desired = require('./desired');

var _ = require('../..');

_chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

describe('createSession', function () {
  var _this = this;

  this.timeout(_helpersSession.MOCHA_TIMEOUT);

  var driver = undefined;
  var server = undefined;
  before(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap((0, _.startServer)(_helpersSession.PORT, _helpersSession.HOST));

        case 2:
          server = context$2$0.sent;

          driver = _wd2['default'].promiseChainRemote(_helpersSession.HOST, _helpersSession.PORT);

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  after(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.prev = 0;
          context$2$0.next = 3;
          return _regeneratorRuntime.awrap(server.close());

        case 3:
          context$2$0.next = 7;
          break;

        case 5:
          context$2$0.prev = 5;
          context$2$0.t0 = context$2$0['catch'](0);

        case 7:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this, [[0, 5]]);
  });
  afterEach(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.prev = 0;
          context$2$0.next = 3;
          return _regeneratorRuntime.awrap(driver.quit());

        case 3:
          context$2$0.next = 7;
          break;

        case 5:
          context$2$0.prev = 5;
          context$2$0.t0 = context$2$0['catch'](0);

        case 7:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this, [[0, 5]]);
  });

  it('should start android session focusing on default activity', function callee$1$0() {
    var status, activity;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.init(_desired.APIDEMO_CAPS));

        case 2:
          status = context$2$0.sent;

          status[1].app.should.eql(_desired.APIDEMO_CAPS.app);

          context$2$0.next = 6;
          return _regeneratorRuntime.awrap(driver.getCurrentDeviceActivity());

        case 6:
          activity = context$2$0.sent;

          activity.should.equal('.ApiDemos');

        case 8:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should start android session focusing on specified activity', function callee$1$0() {
    var status, activity;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.init(_Object$assign({
            appActivity: 'io.appium.android.apis.view.TextFields'
          }, _desired.APIDEMO_CAPS)));

        case 2:
          status = context$2$0.sent;

          status[1].app.should.eql(_desired.APIDEMO_CAPS.app);

          context$2$0.next = 6;
          return _regeneratorRuntime.awrap(driver.getCurrentDeviceActivity());

        case 6:
          activity = context$2$0.sent;

          activity.should.equal('.view.TextFields');

        case 8:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
});

// for now the activity needs to be fully qualified
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZnVuY3Rpb25hbC9kcml2ZXItZTJlLXNwZWNzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O29CQUFpQixNQUFNOzs7OzhCQUNJLGtCQUFrQjs7OztrQkFDOUIsSUFBSTs7Ozs4QkFDdUIsbUJBQW1COzt1QkFDaEMsV0FBVzs7Z0JBQ1osT0FBTzs7QUFHbkMsa0JBQUssTUFBTSxFQUFFLENBQUM7QUFDZCxrQkFBSyxHQUFHLDZCQUFnQixDQUFDOztBQUV6QixRQUFRLENBQUMsZUFBZSxFQUFFLFlBQVk7OztBQUNwQyxNQUFJLENBQUMsT0FBTywrQkFBZSxDQUFDOztBQUU1QixNQUFJLE1BQU0sWUFBQSxDQUFDO0FBQ1gsTUFBSSxNQUFNLFlBQUEsQ0FBQztBQUNYLFFBQU0sQ0FBQzs7Ozs7MkNBQ1UsOERBQXVCOzs7QUFBdEMsZ0JBQU07O0FBQ04sZ0JBQU0sR0FBRyxnQkFBRyxrQkFBa0IsNENBQVksQ0FBQzs7Ozs7OztHQUM1QyxDQUFDLENBQUM7QUFDSCxPQUFLLENBQUM7Ozs7OzsyQ0FFSSxNQUFNLENBQUMsS0FBSyxFQUFFOzs7Ozs7Ozs7Ozs7Ozs7R0FFdkIsQ0FBQyxDQUFDO0FBQ0gsV0FBUyxDQUFDOzs7Ozs7MkNBRUEsTUFBTSxDQUFDLElBQUksRUFBRTs7Ozs7Ozs7Ozs7Ozs7O0dBRXRCLENBQUMsQ0FBQzs7QUFFSCxJQUFFLENBQUMsMkRBQTJELEVBQUU7UUFDMUQsTUFBTSxFQUlOLFFBQVE7Ozs7OzJDQUpPLE1BQU0sQ0FBQyxJQUFJLHVCQUFjOzs7QUFBeEMsZ0JBQU07O0FBRVYsZ0JBQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxzQkFBYSxHQUFHLENBQUMsQ0FBQzs7OzJDQUV0QixNQUFNLENBQUMsd0JBQXdCLEVBQUU7OztBQUFsRCxrQkFBUTs7QUFDWixrQkFBUSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUM7Ozs7Ozs7R0FDcEMsQ0FBQyxDQUFDO0FBQ0gsSUFBRSxDQUFDLDZEQUE2RCxFQUFFO1FBRTVELE1BQU0sRUFNTixRQUFROzs7OzsyQ0FOTyxNQUFNLENBQUMsSUFBSSxDQUFDLGVBQWM7QUFDM0MsdUJBQVcsRUFBRSx3Q0FBd0M7V0FDdEQsd0JBQWUsQ0FBQzs7O0FBRmIsZ0JBQU07O0FBSVYsZ0JBQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxzQkFBYSxHQUFHLENBQUMsQ0FBQzs7OzJDQUV0QixNQUFNLENBQUMsd0JBQXdCLEVBQUU7OztBQUFsRCxrQkFBUTs7QUFDWixrQkFBUSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsa0JBQWtCLENBQUMsQ0FBQzs7Ozs7OztHQUMzQyxDQUFDLENBQUM7Q0FDSixDQUFDLENBQUMiLCJmaWxlIjoidGVzdC9mdW5jdGlvbmFsL2RyaXZlci1lMmUtc3BlY3MuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY2hhaSBmcm9tICdjaGFpJztcbmltcG9ydCBjaGFpQXNQcm9taXNlZCBmcm9tICdjaGFpLWFzLXByb21pc2VkJztcbmltcG9ydCB3ZCBmcm9tICd3ZCc7XG5pbXBvcnQgeyBIT1NULCBQT1JULCBNT0NIQV9USU1FT1VUIH0gZnJvbSAnLi9oZWxwZXJzL3Nlc3Npb24nO1xuaW1wb3J0IHsgQVBJREVNT19DQVBTIH0gZnJvbSAnLi9kZXNpcmVkJztcbmltcG9ydCB7IHN0YXJ0U2VydmVyIH0gZnJvbSAnLi4vLi4nO1xuXG5cbmNoYWkuc2hvdWxkKCk7XG5jaGFpLnVzZShjaGFpQXNQcm9taXNlZCk7XG5cbmRlc2NyaWJlKCdjcmVhdGVTZXNzaW9uJywgZnVuY3Rpb24gKCkge1xuICB0aGlzLnRpbWVvdXQoTU9DSEFfVElNRU9VVCk7XG5cbiAgbGV0IGRyaXZlcjtcbiAgbGV0IHNlcnZlcjtcbiAgYmVmb3JlKGFzeW5jICgpID0+IHtcbiAgICBzZXJ2ZXIgPSBhd2FpdCBzdGFydFNlcnZlcihQT1JULCBIT1NUKTtcbiAgICBkcml2ZXIgPSB3ZC5wcm9taXNlQ2hhaW5SZW1vdGUoSE9TVCwgUE9SVCk7XG4gIH0pO1xuICBhZnRlcihhc3luYyAoKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHNlcnZlci5jbG9zZSgpO1xuICAgIH0gY2F0Y2ggKGlnbikge31cbiAgfSk7XG4gIGFmdGVyRWFjaChhc3luYyAoKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGRyaXZlci5xdWl0KCk7XG4gICAgfSBjYXRjaCAoaWduKSB7fVxuICB9KTtcblxuICBpdCgnc2hvdWxkIHN0YXJ0IGFuZHJvaWQgc2Vzc2lvbiBmb2N1c2luZyBvbiBkZWZhdWx0IGFjdGl2aXR5JywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBzdGF0dXMgPSBhd2FpdCBkcml2ZXIuaW5pdChBUElERU1PX0NBUFMpO1xuXG4gICAgc3RhdHVzWzFdLmFwcC5zaG91bGQuZXFsKEFQSURFTU9fQ0FQUy5hcHApO1xuXG4gICAgbGV0IGFjdGl2aXR5ID0gYXdhaXQgZHJpdmVyLmdldEN1cnJlbnREZXZpY2VBY3Rpdml0eSgpO1xuICAgIGFjdGl2aXR5LnNob3VsZC5lcXVhbCgnLkFwaURlbW9zJyk7XG4gIH0pO1xuICBpdCgnc2hvdWxkIHN0YXJ0IGFuZHJvaWQgc2Vzc2lvbiBmb2N1c2luZyBvbiBzcGVjaWZpZWQgYWN0aXZpdHknLCBhc3luYyAoKSA9PiB7XG4gICAgLy8gZm9yIG5vdyB0aGUgYWN0aXZpdHkgbmVlZHMgdG8gYmUgZnVsbHkgcXVhbGlmaWVkXG4gICAgbGV0IHN0YXR1cyA9IGF3YWl0IGRyaXZlci5pbml0KE9iamVjdC5hc3NpZ24oe1xuICAgICAgYXBwQWN0aXZpdHk6ICdpby5hcHBpdW0uYW5kcm9pZC5hcGlzLnZpZXcuVGV4dEZpZWxkcydcbiAgICB9LCBBUElERU1PX0NBUFMpKTtcblxuICAgIHN0YXR1c1sxXS5hcHAuc2hvdWxkLmVxbChBUElERU1PX0NBUFMuYXBwKTtcblxuICAgIGxldCBhY3Rpdml0eSA9IGF3YWl0IGRyaXZlci5nZXRDdXJyZW50RGV2aWNlQWN0aXZpdHkoKTtcbiAgICBhY3Rpdml0eS5zaG91bGQuZXF1YWwoJy52aWV3LlRleHRGaWVsZHMnKTtcbiAgfSk7XG59KTtcbiJdLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
