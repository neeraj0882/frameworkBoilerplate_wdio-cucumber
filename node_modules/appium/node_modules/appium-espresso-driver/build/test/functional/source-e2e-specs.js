'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _wd = require('wd');

var _wd2 = _interopRequireDefault(_wd);

var _xmldom = require('xmldom');

var _xpath = require('xpath');

var _xpath2 = _interopRequireDefault(_xpath);

var _helpersSession = require('./helpers/session');

var _desired = require('./desired');

var _ = require('../..');

_chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

describe('createSession', function () {
  var _this = this;

  this.timeout(_helpersSession.MOCHA_TIMEOUT);

  var driver = undefined;
  var server = undefined;
  before(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap((0, _.startServer)(_helpersSession.PORT, _helpersSession.HOST));

        case 2:
          server = context$2$0.sent;

          driver = _wd2['default'].promiseChainRemote(_helpersSession.HOST, _helpersSession.PORT);
          context$2$0.next = 6;
          return _regeneratorRuntime.awrap(driver.init(_desired.APIDEMO_CAPS));

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  after(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.prev = 0;
          context$2$0.next = 3;
          return _regeneratorRuntime.awrap(server.close());

        case 3:
          context$2$0.next = 7;
          break;

        case 5:
          context$2$0.prev = 5;
          context$2$0.t0 = context$2$0['catch'](0);

        case 7:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this, [[0, 5]]);
  });
  afterEach(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.prev = 0;
          context$2$0.next = 3;
          return _regeneratorRuntime.awrap(driver.quit());

        case 3:
          context$2$0.next = 7;
          break;

        case 5:
          context$2$0.prev = 5;
          context$2$0.t0 = context$2$0['catch'](0);

        case 7:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this, [[0, 5]]);
  });
  it('should get sourceXML, parse it, and find a node by xpath', function callee$1$0() {
    var sourceXML, doc, node;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.source());

        case 2:
          sourceXML = context$2$0.sent;

          sourceXML.should.be.a.string;
          doc = new _xmldom.DOMParser().parseFromString(sourceXML, 'test/xml');
          node = _xpath2['default'].select('//*[content-desc=Animation]', doc);

          node.should.exist;

        case 7:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZnVuY3Rpb25hbC9zb3VyY2UtZTJlLXNwZWNzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztvQkFBaUIsTUFBTTs7Ozs4QkFDSSxrQkFBa0I7Ozs7a0JBQzlCLElBQUk7Ozs7c0JBQ08sUUFBUTs7cUJBQ2hCLE9BQU87Ozs7OEJBQ2lCLG1CQUFtQjs7dUJBQ2hDLFdBQVc7O2dCQUNaLE9BQU87O0FBR25DLGtCQUFLLE1BQU0sRUFBRSxDQUFDO0FBQ2Qsa0JBQUssR0FBRyw2QkFBZ0IsQ0FBQzs7QUFFekIsUUFBUSxDQUFDLGVBQWUsRUFBRSxZQUFZOzs7QUFDcEMsTUFBSSxDQUFDLE9BQU8sK0JBQWUsQ0FBQzs7QUFFNUIsTUFBSSxNQUFNLFlBQUEsQ0FBQztBQUNYLE1BQUksTUFBTSxZQUFBLENBQUM7QUFDWCxRQUFNLENBQUM7Ozs7OzJDQUNVLDhEQUF1Qjs7O0FBQXRDLGdCQUFNOztBQUNOLGdCQUFNLEdBQUcsZ0JBQUcsa0JBQWtCLDRDQUFZLENBQUM7OzJDQUNyQyxNQUFNLENBQUMsSUFBSSx1QkFBYzs7Ozs7OztHQUNoQyxDQUFDLENBQUM7QUFDSCxPQUFLLENBQUM7Ozs7OzsyQ0FFSSxNQUFNLENBQUMsS0FBSyxFQUFFOzs7Ozs7Ozs7Ozs7Ozs7R0FFdkIsQ0FBQyxDQUFDO0FBQ0gsV0FBUyxDQUFDOzs7Ozs7MkNBRUEsTUFBTSxDQUFDLElBQUksRUFBRTs7Ozs7Ozs7Ozs7Ozs7O0dBRXRCLENBQUMsQ0FBQztBQUNILElBQUUsQ0FBQywwREFBMEQsRUFBRTtRQUN2RCxTQUFTLEVBRVQsR0FBRyxFQUNILElBQUk7Ozs7OzJDQUhjLE1BQU0sQ0FBQyxNQUFNLEVBQUU7OztBQUFqQyxtQkFBUzs7QUFDZixtQkFBUyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztBQUN2QixhQUFHLEdBQUcsdUJBQWUsQ0FBQyxlQUFlLENBQUMsU0FBUyxFQUFFLFVBQVUsQ0FBQztBQUM1RCxjQUFJLEdBQUcsbUJBQU0sTUFBTSxDQUFDLDZCQUE2QixFQUFFLEdBQUcsQ0FBQzs7QUFDN0QsY0FBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7Ozs7Ozs7R0FDbkIsQ0FBQyxDQUFDO0NBQ0osQ0FBQyxDQUFDIiwiZmlsZSI6InRlc3QvZnVuY3Rpb25hbC9zb3VyY2UtZTJlLXNwZWNzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGNoYWkgZnJvbSAnY2hhaSc7XG5pbXBvcnQgY2hhaUFzUHJvbWlzZWQgZnJvbSAnY2hhaS1hcy1wcm9taXNlZCc7XG5pbXBvcnQgd2QgZnJvbSAnd2QnO1xuaW1wb3J0IHsgRE9NUGFyc2VyIH0gZnJvbSAneG1sZG9tJztcbmltcG9ydCB4cGF0aCBmcm9tICd4cGF0aCc7XG5pbXBvcnQgeyBIT1NULCBQT1JULCBNT0NIQV9USU1FT1VUIH0gZnJvbSAnLi9oZWxwZXJzL3Nlc3Npb24nO1xuaW1wb3J0IHsgQVBJREVNT19DQVBTIH0gZnJvbSAnLi9kZXNpcmVkJztcbmltcG9ydCB7IHN0YXJ0U2VydmVyIH0gZnJvbSAnLi4vLi4nO1xuXG5cbmNoYWkuc2hvdWxkKCk7XG5jaGFpLnVzZShjaGFpQXNQcm9taXNlZCk7XG5cbmRlc2NyaWJlKCdjcmVhdGVTZXNzaW9uJywgZnVuY3Rpb24gKCkge1xuICB0aGlzLnRpbWVvdXQoTU9DSEFfVElNRU9VVCk7XG5cbiAgbGV0IGRyaXZlcjtcbiAgbGV0IHNlcnZlcjtcbiAgYmVmb3JlKGFzeW5jICgpID0+IHtcbiAgICBzZXJ2ZXIgPSBhd2FpdCBzdGFydFNlcnZlcihQT1JULCBIT1NUKTtcbiAgICBkcml2ZXIgPSB3ZC5wcm9taXNlQ2hhaW5SZW1vdGUoSE9TVCwgUE9SVCk7XG4gICAgYXdhaXQgZHJpdmVyLmluaXQoQVBJREVNT19DQVBTKTtcbiAgfSk7XG4gIGFmdGVyKGFzeW5jICgpID0+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgc2VydmVyLmNsb3NlKCk7XG4gICAgfSBjYXRjaCAoaWduKSB7fVxuICB9KTtcbiAgYWZ0ZXJFYWNoKGFzeW5jICgpID0+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgZHJpdmVyLnF1aXQoKTtcbiAgICB9IGNhdGNoIChpZ24pIHt9XG4gIH0pO1xuICBpdCgnc2hvdWxkIGdldCBzb3VyY2VYTUwsIHBhcnNlIGl0LCBhbmQgZmluZCBhIG5vZGUgYnkgeHBhdGgnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3Qgc291cmNlWE1MID0gYXdhaXQgZHJpdmVyLnNvdXJjZSgpO1xuICAgIHNvdXJjZVhNTC5zaG91bGQuYmUuYS5zdHJpbmc7XG4gICAgY29uc3QgZG9jID0gbmV3IERPTVBhcnNlcigpLnBhcnNlRnJvbVN0cmluZyhzb3VyY2VYTUwsICd0ZXN0L3htbCcpO1xuICAgIGNvbnN0IG5vZGUgPSB4cGF0aC5zZWxlY3QoJy8vKltjb250ZW50LWRlc2M9QW5pbWF0aW9uXScsIGRvYyk7XG4gICAgbm9kZS5zaG91bGQuZXhpc3Q7XG4gIH0pO1xufSk7XG4iXSwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
