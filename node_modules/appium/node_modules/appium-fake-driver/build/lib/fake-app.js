'use strict';

var _createClass = require('babel-runtime/helpers/create-class')['default'];

var _classCallCheck = require('babel-runtime/helpers/class-call-check')['default'];

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

Object.defineProperty(exports, '__esModule', {
  value: true
});

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var _fs = require('fs');

var _fs2 = _interopRequireDefault(_fs);

var _xmldom = require('xmldom');

var _xmldom2 = _interopRequireDefault(_xmldom);

var _xpath = require('xpath');

var _xpath2 = _interopRequireDefault(_xpath);

var _logger = require('./logger');

var _logger2 = _interopRequireDefault(_logger);

var _fakeElement = require('./fake-element');

var readFile = _bluebird2['default'].promisify(_fs2['default'].readFile);

var FakeApp = (function () {
  function FakeApp() {
    _classCallCheck(this, FakeApp);

    this.dom = null;
    this.activeDom = null;
    this.activeWebview = null;
    this.activeFrame = null;
    this.activeAlert = null;
    this.lat = 0;
    this.long = 0;
    this.rawXml = '';
    this.currentOrientation = "PORTRAIT";
  }

  _createClass(FakeApp, [{
    key: 'loadApp',
    value: function loadApp(appPath) {
      var data;
      return _regeneratorRuntime.async(function loadApp$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            _logger2['default'].info("Loading Mock app model");
            context$2$0.next = 3;
            return _regeneratorRuntime.awrap(readFile(appPath));

          case 3:
            data = context$2$0.sent;

            _logger2['default'].info("Parsing Mock app XML");
            this.rawXml = data.toString();
            this.dom = new _xmldom2['default'].DOMParser().parseFromString(this.rawXml);
            this.activeDom = this.dom;

          case 8:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'getWebviews',
    value: function getWebviews() {
      return this.xpathQuery('//MockWebView/*[1]').map(function (n) {
        return new FakeWebView(n);
      });
    }
  }, {
    key: 'activateWebview',
    value: function activateWebview(wv) {
      this.activeWebview = wv;
      var fragment = new _xmldom2['default'].XMLSerializer().serializeToString(wv.node);
      this.activeDom = new _xmldom2['default'].DOMParser().parseFromString(fragment, "application/xml");
    }
  }, {
    key: 'deactivateWebview',
    value: function deactivateWebview() {
      this.activeWebview = null;
      this.activeDom = this.dom;
    }
  }, {
    key: 'activateFrame',
    value: function activateFrame(frame) {
      this.activeFrame = frame;
      var fragment = new _xmldom2['default'].XMLSerializer().serializeToString(frame);
      this.activeDom = new _xmldom2['default'].DOMParser().parseFromString(fragment, "application/xml");
    }
  }, {
    key: 'deactivateFrame',
    value: function deactivateFrame() {
      this.activeFrame = null;
      this.activateWebview(this.activeWebview);
    }
  }, {
    key: 'xpathQuery',
    value: function xpathQuery(sel, ctx) {
      return _xpath2['default'].select(sel, ctx || this.activeDom);
    }
  }, {
    key: 'idQuery',
    value: function idQuery(id, ctx) {
      return this.xpathQuery('//*[@id="' + id + '"]', ctx);
    }
  }, {
    key: 'classQuery',
    value: function classQuery(className, ctx) {
      return this.xpathQuery('//' + className, ctx);
    }
  }, {
    key: 'hasAlert',
    value: function hasAlert() {
      return this.activeAlert !== null;
    }
  }, {
    key: 'setAlertText',
    value: function setAlertText(text) {
      if (!this.activeAlert.hasPrompt()) {
        throw new Error("No prompt to set text of");
      }
      this.activeAlert.setAttr('prompt', text);
    }
  }, {
    key: 'showAlert',
    value: function showAlert(alertId) {
      var nodes = this.xpathQuery('//alert[@id="' + alertId + '"]');
      if (nodes.length < 1) {
        throw new Error('Alert ' + alertId + ' doesn\'t exist!');
      }
      this.activeAlert = new _fakeElement.FakeElement(nodes[0], this);
    }
  }, {
    key: 'alertText',
    value: function alertText() {
      return this.activeAlert.getAttr('prompt') || this.activeAlert.nodeAttrs.text;
    }
  }, {
    key: 'handleAlert',
    value: function handleAlert() {
      this.activeAlert = null;
    }
  }, {
    key: 'getScreenshot',
    value: function getScreenshot() {
      return "hahahanotreallyascreenshot";
    }
  }, {
    key: 'title',
    get: function get() {
      var nodes = this.xpathQuery('//title');
      if (nodes.length < 1) {
        throw new Error("No title!");
      }
      return nodes[0].firstChild.data;
    }
  }, {
    key: 'currentGeoLocation',
    get: function get() {
      return {
        latitude: this.lat,
        longitude: this.long
      };
    }
  }, {
    key: 'orientation',
    get: function get() {
      return this.currentOrientation;
    },
    set: function set(o) {
      this.currentOrientation = o;
    }
  }]);

  return FakeApp;
})();

var FakeWebView = function FakeWebView(node) {
  _classCallCheck(this, FakeWebView);

  this.node = node;
};

exports.FakeApp = FakeApp;
//# sourceMappingURL=data:application/json;charset=utf8;base64,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QkFBRztBQUNiLFVBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO0tBQ3pCOzs7V0FFYSx5QkFBRztBQUNmLGFBQU8sNEJBQTRCLENBQUM7S0FDckM7OztTQXhHUyxlQUFHO0FBQ1gsVUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUN2QyxVQUFJLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO0FBQ3BCLGNBQU0sSUFBSSxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUM7T0FDOUI7QUFDRCxhQUFPLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDO0tBQ2pDOzs7U0FFc0IsZUFBRztBQUN4QixhQUFPO0FBQ0wsZ0JBQVEsRUFBRSxJQUFJLENBQUMsR0FBRztBQUNsQixpQkFBUyxFQUFFLElBQUksQ0FBQyxJQUFJO09BQ3JCLENBQUM7S0FDSDs7O1NBRWUsZUFBRztBQUNqQixhQUFPLElBQUksQ0FBQyxrQkFBa0IsQ0FBQztLQUNoQztTQUVlLGFBQUMsQ0FBQyxFQUFFO0FBQ2xCLFVBQUksQ0FBQyxrQkFBa0IsR0FBRyxDQUFDLENBQUM7S0FDN0I7OztTQWxDRyxPQUFPOzs7SUF5SFAsV0FBVyxHQUNILFNBRFIsV0FBVyxDQUNGLElBQUksRUFBRTt3QkFEZixXQUFXOztBQUViLE1BQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO0NBQ2xCOztRQUdNLE9BQU8sR0FBUCxPQUFPIiwiZmlsZSI6ImxpYi9mYWtlLWFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCBmcyBmcm9tICdmcyc7XG5pbXBvcnQgWE1MRG9tIGZyb20gJ3htbGRvbSc7XG5pbXBvcnQgeHBhdGggZnJvbSAneHBhdGgnO1xuaW1wb3J0IGxvZyBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgeyBGYWtlRWxlbWVudCB9IGZyb20gJy4vZmFrZS1lbGVtZW50JztcblxuY29uc3QgcmVhZEZpbGUgPSBCLnByb21pc2lmeShmcy5yZWFkRmlsZSk7XG5cbmNsYXNzIEZha2VBcHAge1xuICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgdGhpcy5kb20gPSBudWxsO1xuICAgIHRoaXMuYWN0aXZlRG9tID0gbnVsbDtcbiAgICB0aGlzLmFjdGl2ZVdlYnZpZXcgPSBudWxsO1xuICAgIHRoaXMuYWN0aXZlRnJhbWUgPSBudWxsO1xuICAgIHRoaXMuYWN0aXZlQWxlcnQgPSBudWxsO1xuICAgIHRoaXMubGF0ID0gMDtcbiAgICB0aGlzLmxvbmcgPSAwO1xuICAgIHRoaXMucmF3WG1sID0gJyc7XG4gICAgdGhpcy5jdXJyZW50T3JpZW50YXRpb24gPSBcIlBPUlRSQUlUXCI7XG4gIH1cblxuICBnZXQgdGl0bGUgKCkge1xuICAgIGxldCBub2RlcyA9IHRoaXMueHBhdGhRdWVyeSgnLy90aXRsZScpO1xuICAgIGlmIChub2Rlcy5sZW5ndGggPCAxKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJObyB0aXRsZSFcIik7XG4gICAgfVxuICAgIHJldHVybiBub2Rlc1swXS5maXJzdENoaWxkLmRhdGE7XG4gIH1cblxuICBnZXQgY3VycmVudEdlb0xvY2F0aW9uICgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgbGF0aXR1ZGU6IHRoaXMubGF0LFxuICAgICAgbG9uZ2l0dWRlOiB0aGlzLmxvbmdcbiAgICB9O1xuICB9XG5cbiAgZ2V0IG9yaWVudGF0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5jdXJyZW50T3JpZW50YXRpb247XG4gIH1cblxuICBzZXQgb3JpZW50YXRpb24gKG8pIHtcbiAgICB0aGlzLmN1cnJlbnRPcmllbnRhdGlvbiA9IG87XG4gIH1cblxuICBhc3luYyBsb2FkQXBwIChhcHBQYXRoKSB7XG4gICAgbG9nLmluZm8oXCJMb2FkaW5nIE1vY2sgYXBwIG1vZGVsXCIpO1xuICAgIGxldCBkYXRhID0gYXdhaXQgcmVhZEZpbGUoYXBwUGF0aCk7XG4gICAgbG9nLmluZm8oXCJQYXJzaW5nIE1vY2sgYXBwIFhNTFwiKTtcbiAgICB0aGlzLnJhd1htbCA9IGRhdGEudG9TdHJpbmcoKTtcbiAgICB0aGlzLmRvbSA9IG5ldyBYTUxEb20uRE9NUGFyc2VyKCkucGFyc2VGcm9tU3RyaW5nKHRoaXMucmF3WG1sKTtcbiAgICB0aGlzLmFjdGl2ZURvbSA9IHRoaXMuZG9tO1xuICB9XG5cbiAgZ2V0V2Vidmlld3MgKCkge1xuICAgIHJldHVybiB0aGlzLnhwYXRoUXVlcnkoJy8vTW9ja1dlYlZpZXcvKlsxXScpLm1hcCgobikgPT4ge1xuICAgICAgcmV0dXJuIG5ldyBGYWtlV2ViVmlldyhuKTtcbiAgICB9KTtcbiAgfVxuXG4gIGFjdGl2YXRlV2VidmlldyAod3YpIHtcbiAgICB0aGlzLmFjdGl2ZVdlYnZpZXcgPSB3djtcbiAgICBsZXQgZnJhZ21lbnQgPSBuZXcgWE1MRG9tLlhNTFNlcmlhbGl6ZXIoKS5zZXJpYWxpemVUb1N0cmluZyh3di5ub2RlKTtcbiAgICB0aGlzLmFjdGl2ZURvbSA9IG5ldyBYTUxEb20uRE9NUGFyc2VyKCkucGFyc2VGcm9tU3RyaW5nKGZyYWdtZW50LFxuICAgICAgICBcImFwcGxpY2F0aW9uL3htbFwiKTtcbiAgfVxuXG4gIGRlYWN0aXZhdGVXZWJ2aWV3ICgpIHtcbiAgICB0aGlzLmFjdGl2ZVdlYnZpZXcgPSBudWxsO1xuICAgIHRoaXMuYWN0aXZlRG9tID0gdGhpcy5kb207XG4gIH1cblxuICBhY3RpdmF0ZUZyYW1lIChmcmFtZSkge1xuICAgIHRoaXMuYWN0aXZlRnJhbWUgPSBmcmFtZTtcbiAgICBsZXQgZnJhZ21lbnQgPSBuZXcgWE1MRG9tLlhNTFNlcmlhbGl6ZXIoKS5zZXJpYWxpemVUb1N0cmluZyhmcmFtZSk7XG4gICAgdGhpcy5hY3RpdmVEb20gPSBuZXcgWE1MRG9tLkRPTVBhcnNlcigpLnBhcnNlRnJvbVN0cmluZyhmcmFnbWVudCxcbiAgICAgICAgXCJhcHBsaWNhdGlvbi94bWxcIik7XG4gIH1cblxuICBkZWFjdGl2YXRlRnJhbWUgKCkge1xuICAgIHRoaXMuYWN0aXZlRnJhbWUgPSBudWxsO1xuICAgIHRoaXMuYWN0aXZhdGVXZWJ2aWV3KHRoaXMuYWN0aXZlV2Vidmlldyk7XG4gIH1cblxuICB4cGF0aFF1ZXJ5IChzZWwsIGN0eCkge1xuICAgIHJldHVybiB4cGF0aC5zZWxlY3Qoc2VsLCBjdHggfHwgdGhpcy5hY3RpdmVEb20pO1xuICB9XG5cbiAgaWRRdWVyeSAoaWQsIGN0eCkge1xuICAgIHJldHVybiB0aGlzLnhwYXRoUXVlcnkoYC8vKltAaWQ9XCIke2lkfVwiXWAsIGN0eCk7XG4gIH1cblxuICBjbGFzc1F1ZXJ5IChjbGFzc05hbWUsIGN0eCkge1xuICAgIHJldHVybiB0aGlzLnhwYXRoUXVlcnkoYC8vJHtjbGFzc05hbWV9YCwgY3R4KTtcbiAgfVxuXG4gIGhhc0FsZXJ0ICgpIHtcbiAgICByZXR1cm4gdGhpcy5hY3RpdmVBbGVydCAhPT0gbnVsbDtcbiAgfVxuXG4gIHNldEFsZXJ0VGV4dCAodGV4dCkge1xuICAgIGlmICghdGhpcy5hY3RpdmVBbGVydC5oYXNQcm9tcHQoKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gcHJvbXB0IHRvIHNldCB0ZXh0IG9mXCIpO1xuICAgIH1cbiAgICB0aGlzLmFjdGl2ZUFsZXJ0LnNldEF0dHIoJ3Byb21wdCcsIHRleHQpO1xuICB9XG5cbiAgc2hvd0FsZXJ0IChhbGVydElkKSB7XG4gICAgbGV0IG5vZGVzID0gdGhpcy54cGF0aFF1ZXJ5KGAvL2FsZXJ0W0BpZD1cIiR7YWxlcnRJZH1cIl1gKTtcbiAgICBpZiAobm9kZXMubGVuZ3RoIDwgMSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBBbGVydCAke2FsZXJ0SWR9IGRvZXNuJ3QgZXhpc3QhYCk7XG4gICAgfVxuICAgIHRoaXMuYWN0aXZlQWxlcnQgPSBuZXcgRmFrZUVsZW1lbnQobm9kZXNbMF0sIHRoaXMpO1xuICB9XG5cbiAgYWxlcnRUZXh0ICgpIHtcbiAgICByZXR1cm4gdGhpcy5hY3RpdmVBbGVydC5nZXRBdHRyKCdwcm9tcHQnKSB8fFxuICAgICAgICAgICB0aGlzLmFjdGl2ZUFsZXJ0Lm5vZGVBdHRycy50ZXh0O1xuICB9XG5cbiAgaGFuZGxlQWxlcnQgKCkge1xuICAgIHRoaXMuYWN0aXZlQWxlcnQgPSBudWxsO1xuICB9XG5cbiAgZ2V0U2NyZWVuc2hvdCAoKSB7XG4gICAgcmV0dXJuIFwiaGFoYWhhbm90cmVhbGx5YXNjcmVlbnNob3RcIjtcbiAgfVxuXG59XG5cbmNsYXNzIEZha2VXZWJWaWV3IHtcbiAgY29uc3RydWN0b3IgKG5vZGUpIHtcbiAgICB0aGlzLm5vZGUgPSBub2RlO1xuICB9XG59XG5cbmV4cG9ydCB7IEZha2VBcHAgfTtcbiJdLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
