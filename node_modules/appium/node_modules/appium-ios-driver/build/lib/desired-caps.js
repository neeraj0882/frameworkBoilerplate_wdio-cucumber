'use strict';

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

Object.defineProperty(exports, '__esModule', {
  value: true
});

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _logger = require('./logger');

var _logger2 = _interopRequireDefault(_logger);

var desiredCapConstraints = {
  platformName: {
    presence: true,
    isString: true,
    inclusionCaseInsensitive: ['iOS']
  },
  browserName: {
    isString: true
  },
  app: {
    isString: true
  },

  launchTimeout: {
    // recognize the cap,
    // but validate in the driver#validateDesiredCaps method
  },
  calendarFormat: {
    isString: true
  },
  bundleId: {
    isString: true
  },
  udid: {
    isString: true
  },
  locationServicesEnabled: {
    isBoolean: true
  },
  locationServicesAuthorized: {
    isBoolean: true
  },
  autoAcceptAlerts: {
    isBoolean: true
  },
  autoDismissAlerts: {
    isBoolean: true
  },
  nativeInstrumentsLib: {
    isBoolean: true
  },
  nativeWebTap: {
    isBoolean: true
  },
  safariInitialUrl: {
    isString: true
  },
  safariAllowPopups: {
    isBoolean: true
  },
  safariIgnoreFraudWarning: {
    isBoolean: true
  },
  safariOpenLinksInBackground: {
    isBoolean: true
  },
  keepKeyChains: {
    isBoolean: true
  },
  localizableStringsDir: {
    isString: true
  },
  processArguments: {
    // recognize the cap,
    // but validate in the driver#validateDesiredCaps method
  },
  interKeyDelay: {
    isNumber: true
  },
  showIOSLog: {
    isBoolean: true
  },
  sendKeyStrategy: {
    isString: true,
    inclusion: ['oneByOne', 'grouped', 'setValue']
  },
  screenshotWaitTimeout: {
    isNumber: true
  },
  waitForAppScript: {
    isString: true
  },
  webviewConnectRetries: {
    isNumber: true
  },
  appName: {
    isString: true
  },
  clearSystemFiles: {
    isBoolean: true
  },
  customSSLCert: {
    isString: true
  },
  webkitResponseTimeout: {
    isNumber: true
  },
  enablePerformanceLogging: {
    isBoolean: true
  },
  enableAsyncExecuteFromHttps: {
    isBoolean: true
  },
  realDeviceLogger: {
    isString: true
  },
  fullContextList: {
    isBoolean: true
  },
  ignoreAboutBlankUrl: {
    isBoolean: true
  }
};

function desiredCapValidation(caps) {
  // make sure that the capabilities have one of `app` or `bundleId`
  if ((caps.browserName || '').toLowerCase() !== 'safari' && !caps.app && !caps.bundleId) {
    var msg = 'The desired capabilities must include either an app or a bundleId for iOS';
    _logger2['default'].errorAndThrow(msg);
  }

  // `launchTimeout` is more complex than the validators can easily handle
  // and too specific for a generalized validator of its own
  if (caps.launchTimeout) {
    // it can be a number, a JSON string, or an object
    var msg = 'launchTimeout must be a number, object, or string JSON object';
    if (!_lodash2['default'].isNumber(caps.launchTimeout)) {
      if (_lodash2['default'].isString(caps.launchTimeout)) {
        // if this is a string, it must be a JSON string
        try {
          // change `launchTimeout` to an object
          caps.launchTimeout = JSON.parse(caps.launchTimeout);
        } catch (err) {
          // it was a string, but not something parsable as JSON
          _logger2['default'].errorAndThrow(msg);
        }
      }
      if (!_lodash2['default'].isObject(caps.launchTimeout)) {
        _logger2['default'].errorAndThrow(msg);
      }
    }
  }

  // `processArguments` is more complex as it can be a string
  // or a hash
  if (caps.processArguments) {
    if (_lodash2['default'].isString(caps.processArguments)) {
      try {
        // try to parse the string as JSON
        caps.processArguments = JSON.parse(caps.processArguments);
      } catch (ign) {
        // if we cannot parse, just leave as a string
      }
    } else if (!_lodash2['default'].isObject(caps.processArguments)) {
        _logger2['default'].errorAndThrow('processArguments must be a string, object, or a string JSON object');
      }
  }

  // there is an undocumented legacy cap `loggingPrefs.performance` to enable
  // performance logging. Translate to `enablePerformanceLogging`
  if (typeof caps.enablePerformanceLogging !== 'boolean' && typeof caps.loggingPrefs === 'object' && caps.loggingPrefs.performance) {
    caps.enablePerformanceLogging = !!caps.loggingPrefs.performance;
  }

  // finally, return true since the superclass check passed, as did this
  return true;
}

exports.desiredCapConstraints = desiredCapConstraints;
exports.desiredCapValidation = desiredCapValidation;
exports['default'] = desiredCapConstraints;
//# sourceMappingURL=data:application/json;charset=utf8;base64,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T0FBTyxJQUFJLENBQUMsd0JBQXdCLEtBQUssU0FBUyxJQUNsRCxPQUFPLElBQUksQ0FBQyxZQUFZLEtBQUssUUFBUSxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsV0FBVyxFQUFFO0FBQzFFLFFBQUksQ0FBQyx3QkFBd0IsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxXQUFXLENBQUM7R0FDakU7OztBQUdELFNBQU8sSUFBSSxDQUFDO0NBQ2I7O1FBRVEscUJBQXFCLEdBQXJCLHFCQUFxQjtRQUFFLG9CQUFvQixHQUFwQixvQkFBb0I7cUJBQ3JDLHFCQUFxQiIsImZpbGUiOiJsaWIvZGVzaXJlZC1jYXBzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBsb2dnZXIgZnJvbSAnLi9sb2dnZXInO1xuXG5cbmNvbnN0IGRlc2lyZWRDYXBDb25zdHJhaW50cyA9IHtcbiAgcGxhdGZvcm1OYW1lOiB7XG4gICAgcHJlc2VuY2U6IHRydWUsXG4gICAgaXNTdHJpbmc6IHRydWUsXG4gICAgaW5jbHVzaW9uQ2FzZUluc2Vuc2l0aXZlOiBbJ2lPUyddXG4gIH0sXG4gIGJyb3dzZXJOYW1lOiB7XG4gICAgaXNTdHJpbmc6IHRydWVcbiAgfSxcbiAgYXBwOiB7XG4gICAgaXNTdHJpbmc6IHRydWVcbiAgfSxcblxuICBsYXVuY2hUaW1lb3V0OiB7XG4gICAgLy8gcmVjb2duaXplIHRoZSBjYXAsXG4gICAgLy8gYnV0IHZhbGlkYXRlIGluIHRoZSBkcml2ZXIjdmFsaWRhdGVEZXNpcmVkQ2FwcyBtZXRob2RcbiAgfSxcbiAgY2FsZW5kYXJGb3JtYXQ6IHtcbiAgICBpc1N0cmluZzogdHJ1ZVxuICB9LFxuICBidW5kbGVJZDoge1xuICAgIGlzU3RyaW5nOiB0cnVlXG4gIH0sXG4gIHVkaWQ6IHtcbiAgICBpc1N0cmluZzogdHJ1ZVxuICB9LFxuICBsb2NhdGlvblNlcnZpY2VzRW5hYmxlZDoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICBsb2NhdGlvblNlcnZpY2VzQXV0aG9yaXplZDoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICBhdXRvQWNjZXB0QWxlcnRzOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIGF1dG9EaXNtaXNzQWxlcnRzOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIG5hdGl2ZUluc3RydW1lbnRzTGliOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIG5hdGl2ZVdlYlRhcDoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICBzYWZhcmlJbml0aWFsVXJsOiB7XG4gICAgaXNTdHJpbmc6IHRydWVcbiAgfSxcbiAgc2FmYXJpQWxsb3dQb3B1cHM6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgc2FmYXJpSWdub3JlRnJhdWRXYXJuaW5nOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIHNhZmFyaU9wZW5MaW5rc0luQmFja2dyb3VuZDoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICBrZWVwS2V5Q2hhaW5zOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIGxvY2FsaXphYmxlU3RyaW5nc0Rpcjoge1xuICAgIGlzU3RyaW5nOiB0cnVlXG4gIH0sXG4gIHByb2Nlc3NBcmd1bWVudHM6IHtcbiAgICAvLyByZWNvZ25pemUgdGhlIGNhcCxcbiAgICAvLyBidXQgdmFsaWRhdGUgaW4gdGhlIGRyaXZlciN2YWxpZGF0ZURlc2lyZWRDYXBzIG1ldGhvZFxuICB9LFxuICBpbnRlcktleURlbGF5OiB7XG4gICAgaXNOdW1iZXI6IHRydWVcbiAgfSxcbiAgc2hvd0lPU0xvZzoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICBzZW5kS2V5U3RyYXRlZ3k6IHtcbiAgICBpc1N0cmluZzogdHJ1ZSxcbiAgICBpbmNsdXNpb246IFsnb25lQnlPbmUnLCAnZ3JvdXBlZCcsICdzZXRWYWx1ZSddXG4gIH0sXG4gIHNjcmVlbnNob3RXYWl0VGltZW91dDoge1xuICAgIGlzTnVtYmVyOiB0cnVlXG4gIH0sXG4gIHdhaXRGb3JBcHBTY3JpcHQ6IHtcbiAgICBpc1N0cmluZzogdHJ1ZVxuICB9LFxuICB3ZWJ2aWV3Q29ubmVjdFJldHJpZXM6IHtcbiAgICBpc051bWJlcjogdHJ1ZVxuICB9LFxuICBhcHBOYW1lOiB7XG4gICAgaXNTdHJpbmc6IHRydWVcbiAgfSxcbiAgY2xlYXJTeXN0ZW1GaWxlczoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICBjdXN0b21TU0xDZXJ0OiB7XG4gICAgaXNTdHJpbmc6IHRydWVcbiAgfSxcbiAgd2Via2l0UmVzcG9uc2VUaW1lb3V0OiB7XG4gICAgaXNOdW1iZXI6IHRydWVcbiAgfSxcbiAgZW5hYmxlUGVyZm9ybWFuY2VMb2dnaW5nOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIGVuYWJsZUFzeW5jRXhlY3V0ZUZyb21IdHRwczoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICByZWFsRGV2aWNlTG9nZ2VyOiB7XG4gICAgaXNTdHJpbmc6IHRydWVcbiAgfSxcbiAgZnVsbENvbnRleHRMaXN0OiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIGlnbm9yZUFib3V0QmxhbmtVcmw6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbn07XG5cbmZ1bmN0aW9uIGRlc2lyZWRDYXBWYWxpZGF0aW9uIChjYXBzKSB7XG4gIC8vIG1ha2Ugc3VyZSB0aGF0IHRoZSBjYXBhYmlsaXRpZXMgaGF2ZSBvbmUgb2YgYGFwcGAgb3IgYGJ1bmRsZUlkYFxuICBpZiAoKGNhcHMuYnJvd3Nlck5hbWUgfHwgJycpLnRvTG93ZXJDYXNlKCkgIT09ICdzYWZhcmknICYmXG4gICAgICAhY2Fwcy5hcHAgJiYgIWNhcHMuYnVuZGxlSWQpIHtcbiAgICBsZXQgbXNnID0gJ1RoZSBkZXNpcmVkIGNhcGFiaWxpdGllcyBtdXN0IGluY2x1ZGUgZWl0aGVyIGFuIGFwcCBvciBhIGJ1bmRsZUlkIGZvciBpT1MnO1xuICAgIGxvZ2dlci5lcnJvckFuZFRocm93KG1zZyk7XG4gIH1cblxuICAvLyBgbGF1bmNoVGltZW91dGAgaXMgbW9yZSBjb21wbGV4IHRoYW4gdGhlIHZhbGlkYXRvcnMgY2FuIGVhc2lseSBoYW5kbGVcbiAgLy8gYW5kIHRvbyBzcGVjaWZpYyBmb3IgYSBnZW5lcmFsaXplZCB2YWxpZGF0b3Igb2YgaXRzIG93blxuICBpZiAoY2Fwcy5sYXVuY2hUaW1lb3V0KSB7XG4gICAgLy8gaXQgY2FuIGJlIGEgbnVtYmVyLCBhIEpTT04gc3RyaW5nLCBvciBhbiBvYmplY3RcbiAgICBsZXQgbXNnID0gJ2xhdW5jaFRpbWVvdXQgbXVzdCBiZSBhIG51bWJlciwgb2JqZWN0LCBvciBzdHJpbmcgSlNPTiBvYmplY3QnO1xuICAgIGlmICghXy5pc051bWJlcihjYXBzLmxhdW5jaFRpbWVvdXQpKSB7XG4gICAgICBpZiAoXy5pc1N0cmluZyhjYXBzLmxhdW5jaFRpbWVvdXQpKSB7XG4gICAgICAgIC8vIGlmIHRoaXMgaXMgYSBzdHJpbmcsIGl0IG11c3QgYmUgYSBKU09OIHN0cmluZ1xuICAgICAgICB0cnkge1xuICAgICAgICAgIC8vIGNoYW5nZSBgbGF1bmNoVGltZW91dGAgdG8gYW4gb2JqZWN0XG4gICAgICAgICAgY2Fwcy5sYXVuY2hUaW1lb3V0ID0gSlNPTi5wYXJzZShjYXBzLmxhdW5jaFRpbWVvdXQpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAvLyBpdCB3YXMgYSBzdHJpbmcsIGJ1dCBub3Qgc29tZXRoaW5nIHBhcnNhYmxlIGFzIEpTT05cbiAgICAgICAgICBsb2dnZXIuZXJyb3JBbmRUaHJvdyhtc2cpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoIV8uaXNPYmplY3QoY2Fwcy5sYXVuY2hUaW1lb3V0KSkge1xuICAgICAgICBsb2dnZXIuZXJyb3JBbmRUaHJvdyhtc2cpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIGBwcm9jZXNzQXJndW1lbnRzYCBpcyBtb3JlIGNvbXBsZXggYXMgaXQgY2FuIGJlIGEgc3RyaW5nXG4gIC8vIG9yIGEgaGFzaFxuICBpZiAoY2Fwcy5wcm9jZXNzQXJndW1lbnRzKSB7XG4gICAgaWYgKF8uaXNTdHJpbmcoY2Fwcy5wcm9jZXNzQXJndW1lbnRzKSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gdHJ5IHRvIHBhcnNlIHRoZSBzdHJpbmcgYXMgSlNPTlxuICAgICAgICBjYXBzLnByb2Nlc3NBcmd1bWVudHMgPSBKU09OLnBhcnNlKGNhcHMucHJvY2Vzc0FyZ3VtZW50cyk7XG4gICAgICB9IGNhdGNoIChpZ24pIHtcbiAgICAgICAgLy8gaWYgd2UgY2Fubm90IHBhcnNlLCBqdXN0IGxlYXZlIGFzIGEgc3RyaW5nXG4gICAgICB9XG4gICAgfSBlbHNlIGlmICghXy5pc09iamVjdChjYXBzLnByb2Nlc3NBcmd1bWVudHMpKSB7XG4gICAgICBsb2dnZXIuZXJyb3JBbmRUaHJvdygncHJvY2Vzc0FyZ3VtZW50cyBtdXN0IGJlIGEgc3RyaW5nLCBvYmplY3QsIG9yIGEgc3RyaW5nIEpTT04gb2JqZWN0Jyk7XG4gICAgfVxuICB9XG5cbiAgLy8gdGhlcmUgaXMgYW4gdW5kb2N1bWVudGVkIGxlZ2FjeSBjYXAgYGxvZ2dpbmdQcmVmcy5wZXJmb3JtYW5jZWAgdG8gZW5hYmxlXG4gIC8vIHBlcmZvcm1hbmNlIGxvZ2dpbmcuIFRyYW5zbGF0ZSB0byBgZW5hYmxlUGVyZm9ybWFuY2VMb2dnaW5nYFxuICBpZiAodHlwZW9mIGNhcHMuZW5hYmxlUGVyZm9ybWFuY2VMb2dnaW5nICE9PSAnYm9vbGVhbicgJiZcbiAgICAgIHR5cGVvZiBjYXBzLmxvZ2dpbmdQcmVmcyA9PT0gJ29iamVjdCcgJiYgY2Fwcy5sb2dnaW5nUHJlZnMucGVyZm9ybWFuY2UpIHtcbiAgICBjYXBzLmVuYWJsZVBlcmZvcm1hbmNlTG9nZ2luZyA9ICEhY2Fwcy5sb2dnaW5nUHJlZnMucGVyZm9ybWFuY2U7XG4gIH1cblxuICAvLyBmaW5hbGx5LCByZXR1cm4gdHJ1ZSBzaW5jZSB0aGUgc3VwZXJjbGFzcyBjaGVjayBwYXNzZWQsIGFzIGRpZCB0aGlzXG4gIHJldHVybiB0cnVlO1xufVxuXG5leHBvcnQgeyBkZXNpcmVkQ2FwQ29uc3RyYWludHMsIGRlc2lyZWRDYXBWYWxpZGF0aW9uIH07XG5leHBvcnQgZGVmYXVsdCBkZXNpcmVkQ2FwQ29uc3RyYWludHM7XG4iXSwic291cmNlUm9vdCI6Ii4uLy4uIn0=
