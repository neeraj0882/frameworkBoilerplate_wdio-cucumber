require('source-map-support').install();

'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _ = require('..');

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _helpers = require('./helpers');

var _appiumSupport = require('appium-support');

// Windows doesn't understand SIGHUP
var stopSignal = _appiumSupport.system.isWindows() ? 'SIGTERM' : 'SIGHUP';
var should = _chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

describe('SubProcess', function () {
  it('should throw an error if initialized without a command', function () {
    should['throw'](function () {
      new _.SubProcess();
    });
  });
  it('should throw an error if initialized with a bad command', function () {
    should['throw'](function () {
      new _.SubProcess({ lol: true });
    });
    should['throw'](function () {
      new _.SubProcess(1);
    });
  });
  it('should throw an error if initialized with bad args', function () {
    should['throw'](function () {
      new _.SubProcess('ls', 'foo');
    });
    should['throw'](function () {
      new _.SubProcess('ls', 1);
    });
    should['throw'](function () {
      new _.SubProcess('ls', {});
    });
  });
  it('should default args list to []', function () {
    var x = new _.SubProcess('ls');
    x.args.should.eql([]);
  });
  it('should default opts dict to {}', function () {
    var x = new _.SubProcess('ls');
    x.opts.should.eql({});
  });
  it('should pass opts to spawn', function callee$1$0() {
    var cwd, subproc, lines;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          cwd = _path2['default'].resolve((0, _helpers.getFixture)('.'));
          subproc = new _.SubProcess('ls', [], { cwd: cwd });
          lines = [];

          subproc.on('lines-stdout', function (newLines) {
            lines = lines.concat(newLines);
          });
          context$2$0.next = 6;
          return _regeneratorRuntime.awrap(subproc.start(0));

        case 6:
          context$2$0.next = 8;
          return _regeneratorRuntime.awrap(_bluebird2['default'].delay(50));

        case 8:
          lines.should.include('bad_exit.sh');
          lines.should.contain('bigbuffer.js');
          lines.should.contain('echo.sh');

        case 11:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  describe('#start', function () {
    it('should throw an error if command fails on startup', function callee$2$0() {
      var s;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            s = new _.SubProcess('blargimarg');
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(s.start().should.eventually.be.rejectedWith(/not found/));

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should have a default startDetector of waiting for output', function callee$2$0() {
      var hasData, s;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            hasData = false;
            s = new _.SubProcess('ls');

            s.on('output', function (stdout) {
              if (stdout) {
                hasData = true;
              }
            });
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(s.start());

          case 5:
            hasData.should.be['true'];

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should interpret a numeric startDetector as a start timeout', function callee$2$0() {
      var hasData, s;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            hasData = false;
            s = new _.SubProcess((0, _helpers.getFixture)('sleepyproc'), ['ls']);

            s.on('output', function (stdout) {
              if (stdout) {
                hasData = true;
              }
            });
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(s.start(0));

          case 5:
            hasData.should.be['false'];
            context$3$0.next = 8;
            return _regeneratorRuntime.awrap(_bluebird2['default'].delay(1200));

          case 8:
            hasData.should.be['true'];

          case 9:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should fail even with a start timeout of 0 when command is bad', function callee$2$0() {
      var s;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            s = new _.SubProcess('blargimarg');
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(s.start(0).should.eventually.be.rejectedWith(/not found/));

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should be able to provide a custom startDetector function', function callee$2$0() {
      var sd, hasData, s;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            sd = function sd(stdout) {
              return stdout;
            };

            hasData = false;
            s = new _.SubProcess('ls');

            s.on('output', function (stdout) {
              if (stdout) {
                hasData = true;
              }
            });
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(s.start(sd));

          case 6:
            hasData.should.be['true'];

          case 7:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should pass on custom errors from startDetector', function callee$2$0() {
      var sd, s;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            sd = function sd() {
              throw new Error('foo');
            };

            s = new _.SubProcess('ls');
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(s.start(sd).should.eventually.be.rejectedWith(/foo/));

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should time out starts that take longer than specified ms', function callee$2$0() {
      var sd, s, start;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            sd = function sd(stdout) {
              return stdout.indexOf('nothere') !== -1;
            };

            s = new _.SubProcess('ls');
            start = Date.now();
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(s.start(sd, 500).should.eventually.be.rejectedWith(/did not start.+time/i));

          case 5:
            (Date.now() - start).should.be.below(600);

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
  });

  describe('listening for data', function () {
    var subproc = undefined;
    afterEach(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.prev = 0;
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(subproc.stop());

          case 3:
            context$3$0.next = 7;
            break;

          case 5:
            context$3$0.prev = 5;
            context$3$0.t0 = context$3$0['catch'](0);

          case 7:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this, [[0, 5]]);
    });
    it('should get output as params', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        var _this = this;

        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(new _bluebird2['default'](function callee$3$0(resolve, reject) {
              return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
                while (1) switch (context$4$0.prev = context$4$0.next) {
                  case 0:
                    subproc = new _.SubProcess((0, _helpers.getFixture)('sleepyproc'), ['ls', _path2['default'].resolve(__dirname)]);
                    subproc.on('output', function (stdout) {
                      if (stdout && stdout.indexOf('subproc-specs') === -1) {
                        reject();
                      } else {
                        resolve();
                      }
                    });
                    context$4$0.next = 4;
                    return _regeneratorRuntime.awrap(subproc.start());

                  case 4:
                  case 'end':
                    return context$4$0.stop();
                }
              }, null, _this);
            }).should.eventually.not.be.rejected);

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should get output as params', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        var _this2 = this;

        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(new _bluebird2['default'](function callee$3$0(resolve, reject) {
              return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
                while (1) switch (context$4$0.prev = context$4$0.next) {
                  case 0:
                    subproc = new _.SubProcess((0, _helpers.getFixture)('echo'), ['foo', 'bar']);
                    subproc.on('output', function (stdout, stderr) {
                      if (stderr && stderr.indexOf('bar') === -1) {
                        reject();
                      } else {
                        resolve();
                      }
                    });
                    context$4$0.next = 4;
                    return _regeneratorRuntime.awrap(subproc.start());

                  case 4:
                  case 'end':
                    return context$4$0.stop();
                }
              }, null, _this2);
            }));

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should get output by lines', function callee$2$0() {
      var lines;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            subproc = new _.SubProcess('ls', [_path2['default'].resolve(__dirname)]);
            lines = [];

            subproc.on('lines-stdout', function (newLines) {
              lines = lines.concat(newLines);
            });
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(subproc.start(0));

          case 5:
            context$3$0.next = 7;
            return _regeneratorRuntime.awrap(_bluebird2['default'].delay(50));

          case 7:
            lines.should.eql(['exec-specs.js', 'fixtures', 'helpers.js', 'subproc-specs.js']);

          case 8:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
  });

  describe('#stop', function () {
    it('should send the right signal to stop a proc', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        var _this3 = this;

        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            return context$3$0.abrupt('return', new _bluebird2['default'](function callee$3$0(resolve, reject) {
              var subproc;
              return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
                while (1) switch (context$4$0.prev = context$4$0.next) {
                  case 0:
                    subproc = new _.SubProcess('tail', ['-f', _path2['default'].resolve(__filename)]);
                    context$4$0.next = 3;
                    return _regeneratorRuntime.awrap(subproc.start());

                  case 3:
                    subproc.on('exit', function (code, signal) {
                      try {
                        signal.should.equal(stopSignal);
                        resolve();
                      } catch (e) {
                        reject(e);
                      }
                    });
                    context$4$0.next = 6;
                    return _regeneratorRuntime.awrap(subproc.stop(stopSignal));

                  case 6:
                  case 'end':
                    return context$4$0.stop();
                }
              }, null, _this3);
            }));

          case 1:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should time out if stop doesnt complete fast enough', function callee$2$0() {
      var subproc;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            subproc = new _.SubProcess((0, _helpers.getFixture)('traphup'), ['tail', '-f', _path2['default'].resolve(__filename)]);
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(subproc.start());

          case 3:
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(subproc.stop(stopSignal, 1).should.eventually.be.rejectedWith(/Process didn't end/));

          case 5:
            context$3$0.prev = 5;
            context$3$0.next = 8;
            return _regeneratorRuntime.awrap((0, _.exec)('kill', ['-9', subproc.proc.pid + 1]));

          case 8:
            context$3$0.next = 12;
            break;

          case 10:
            context$3$0.prev = 10;
            context$3$0.t0 = context$3$0['catch'](5);

          case 12:
            context$3$0.prev = 12;
            context$3$0.next = 15;
            return _regeneratorRuntime.awrap((0, _.exec)('kill', ['-9', subproc.proc.pid]));

          case 15:
            context$3$0.next = 19;
            break;

          case 17:
            context$3$0.prev = 17;
            context$3$0.t1 = context$3$0['catch'](12);

          case 19:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this, [[5, 10], [12, 17]]);
    });

    it('should error if there is no process to stop', function callee$2$0() {
      var subproc;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            subproc = new _.SubProcess('ls');
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(subproc.stop().should.eventually.be.rejectedWith(/Can't stop/));

          case 3:
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(subproc.start());

          case 5:
            context$3$0.next = 7;
            return _regeneratorRuntime.awrap(_bluebird2['default'].delay(10));

          case 7:
            context$3$0.next = 9;
            return _regeneratorRuntime.awrap(subproc.stop().should.eventually.be.rejectedWith(/Can't stop/));

          case 9:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
  });

  describe('#join', function () {
    it('should fail if the #start has not yet been called', function callee$2$0() {
      var proc;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            proc = new _.SubProcess((0, _helpers.getFixture)('sleepyproc.sh'), ['ls']);
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(proc.join().should.eventually.be.rejectedWith(/Can't join/));

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should wait until the process has been finished', function callee$2$0() {
      var proc, now, diff;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            proc = new _.SubProcess((0, _helpers.getFixture)('sleepyproc'), ['ls']);
            now = Date.now();
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(proc.start(0));

          case 4:
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(proc.join());

          case 6:
            diff = Date.now() - now;

            diff.should.be.above(1000);

          case 8:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should throw if process ends with a invalid exitcode', function callee$2$0() {
      var proc;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            proc = new _.SubProcess((0, _helpers.getFixture)('bad_exit'));
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(proc.start(0));

          case 3:
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(proc.join().should.eventually.be.rejectedWith(/Process ended with exitcode/));

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should NOT throw if process ends with a custom allowed exitcode', function callee$2$0() {
      var proc;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            proc = new _.SubProcess((0, _helpers.getFixture)('bad_exit'));
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(proc.start(0));

          case 3:
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(proc.join([1]).should.eventually.be.become(1));

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
  });

  describe('#emitLines', function () {
    it('should emit single lines with stream in front', function callee$2$0() {
      var proc, lines;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            proc = new _.SubProcess((0, _helpers.getFixture)('sleepyproc.sh'), ['ls']);
            lines = [];

            proc.on('stream-line', lines.push.bind(lines));
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(proc.start());

          case 5:
            context$3$0.next = 7;
            return _regeneratorRuntime.awrap(proc.stop());

          case 7:
            lines.length.should.be.above(5);
            lines[0].slice(0, 8).should.eql("[STDOUT]");

          case 9:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
  });

  describe('on exit / die', function () {
    it('should emit exit/end and no stop/die in normal exits', function callee$2$0() {
      var proc, exitCaught, dieCaught, stopCaught, endCaught;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            proc = new _.SubProcess((0, _helpers.getFixture)('sleepyproc'), ['ls']);
            exitCaught = [];
            dieCaught = false;
            stopCaught = false;
            endCaught = false;

            proc.on('exit', function (code, signal) {
              exitCaught = [code, signal];
            });
            proc.on('die', function () {
              dieCaught = true;
            });
            proc.on('stop', function () {
              stopCaught = true;
            });
            proc.on('end', function () {
              endCaught = true;
            });
            context$3$0.next = 11;
            return _regeneratorRuntime.awrap(proc.start());

          case 11:
            context$3$0.next = 13;
            return _regeneratorRuntime.awrap(proc.join());

          case 13:
            exitCaught.should.eql([0, null]);
            dieCaught.should.be['false'];
            stopCaught.should.be['false'];
            endCaught.should.be['true'];

          case 17:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should emit exit/stop and no end/die when we stop a proc', function callee$2$0() {
      var proc, exitCaught, dieCaught, stopCaught, endCaught;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            proc = new _.SubProcess('tail', ['-f', _path2['default'].resolve(__filename)]);
            exitCaught = [];
            dieCaught = false;
            stopCaught = [];
            endCaught = false;

            proc.on('exit', function (code, signal) {
              exitCaught = [code, signal];
            });
            proc.on('stop', function (code, signal) {
              stopCaught = [code, signal];
            });
            proc.on('die', function () {
              dieCaught = true;
            });
            proc.on('end', function () {
              endCaught = true;
            });
            context$3$0.next = 11;
            return _regeneratorRuntime.awrap(proc.start());

          case 11:
            context$3$0.next = 13;
            return _regeneratorRuntime.awrap(proc.stop());

          case 13:
            exitCaught.should.eql([null, 'SIGTERM']);
            stopCaught.should.eql(exitCaught);
            dieCaught.should.be['false'];
            endCaught.should.be['false'];

          case 17:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should emit exit/die and no stop/end when a proc is killed externally', function callee$2$0() {
      var proc, exitCaught, dieCaught, stopCaught, endCaught;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            proc = new _.SubProcess('tail', ['-f', _path2['default'].resolve(__filename)]);
            exitCaught = [];
            dieCaught = [];
            stopCaught = false;
            endCaught = false;

            proc.on('exit', function (code, signal) {
              exitCaught = [code, signal];
            });
            proc.on('die', function (code, signal) {
              dieCaught = [code, signal];
            });
            proc.on('stop', function () {
              stopCaught = true;
            });
            proc.on('end', function () {
              endCaught = true;
            });
            context$3$0.next = 11;
            return _regeneratorRuntime.awrap(proc.start());

          case 11:
            context$3$0.next = 13;
            return _regeneratorRuntime.awrap((0, _.exec)('pkill', ['-f', 'tail -f ' + _path2['default'].resolve(__filename)]));

          case 13:
            context$3$0.prev = 13;
            context$3$0.next = 16;
            return _regeneratorRuntime.awrap(proc.join());

          case 16:
            context$3$0.next = 20;
            break;

          case 18:
            context$3$0.prev = 18;
            context$3$0.t0 = context$3$0['catch'](13);

          case 20:
            exitCaught.should.eql([null, 'SIGTERM']);
            dieCaught.should.eql(exitCaught);
            stopCaught.should.be['false'];
            endCaught.should.be['false'];

          case 24:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this, [[13, 18]]);
    });
  });
});

// need to kill the process
// 1 for the trap, 1 for the tail
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3Qvc3VicHJvYy1zcGVjcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozt3QkFFYyxVQUFVOzs7O29CQUNQLE1BQU07Ozs7Z0JBQ1UsSUFBSTs7b0JBQ3BCLE1BQU07Ozs7OEJBQ0ksa0JBQWtCOzs7O3VCQUNsQixXQUFXOzs2QkFDZixnQkFBZ0I7OztBQUl2QyxJQUFJLFVBQVUsR0FBRyxzQkFBTyxTQUFTLEVBQUUsR0FBRyxTQUFTLEdBQUcsUUFBUSxDQUFDO0FBQzNELElBQU0sTUFBTSxHQUFHLGtCQUFLLE1BQU0sRUFBRSxDQUFDO0FBQzdCLGtCQUFLLEdBQUcsNkJBQWdCLENBQUM7O0FBRXpCLFFBQVEsQ0FBQyxZQUFZLEVBQUUsWUFBWTtBQUNqQyxJQUFFLENBQUMsd0RBQXdELEVBQUUsWUFBWTtBQUN2RSxVQUFNLFNBQU0sQ0FBQyxZQUFNO0FBQ2pCLHdCQUFnQixDQUFDO0tBQ2xCLENBQUMsQ0FBQztHQUNKLENBQUMsQ0FBQztBQUNILElBQUUsQ0FBQyx5REFBeUQsRUFBRSxZQUFZO0FBQ3hFLFVBQU0sU0FBTSxDQUFDLFlBQU07QUFDakIsdUJBQWUsRUFBQyxHQUFHLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQztLQUM3QixDQUFDLENBQUM7QUFDSCxVQUFNLFNBQU0sQ0FBQyxZQUFNO0FBQ2pCLHVCQUFlLENBQUMsQ0FBQyxDQUFDO0tBQ25CLENBQUMsQ0FBQztHQUNKLENBQUMsQ0FBQztBQUNILElBQUUsQ0FBQyxvREFBb0QsRUFBRSxZQUFZO0FBQ25FLFVBQU0sU0FBTSxDQUFDLFlBQU07QUFDakIsdUJBQWUsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO0tBQzdCLENBQUMsQ0FBQztBQUNILFVBQU0sU0FBTSxDQUFDLFlBQU07QUFDakIsdUJBQWUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO0tBQ3pCLENBQUMsQ0FBQztBQUNILFVBQU0sU0FBTSxDQUFDLFlBQU07QUFDakIsdUJBQWUsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0tBQzFCLENBQUMsQ0FBQztHQUNKLENBQUMsQ0FBQztBQUNILElBQUUsQ0FBQyxnQ0FBZ0MsRUFBRSxZQUFZO0FBQy9DLFFBQUksQ0FBQyxHQUFHLGlCQUFlLElBQUksQ0FBQyxDQUFDO0FBQzdCLEtBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztHQUN2QixDQUFDLENBQUM7QUFDSCxJQUFFLENBQUMsZ0NBQWdDLEVBQUUsWUFBWTtBQUMvQyxRQUFJLENBQUMsR0FBRyxpQkFBZSxJQUFJLENBQUMsQ0FBQztBQUM3QixLQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUM7R0FDdkIsQ0FBQyxDQUFDO0FBQ0gsSUFBRSxDQUFDLDJCQUEyQixFQUFFO1FBQ3hCLEdBQUcsRUFDSCxPQUFPLEVBQ1QsS0FBSzs7OztBQUZILGFBQUcsR0FBRyxrQkFBSyxPQUFPLENBQUMseUJBQVcsR0FBRyxDQUFDLENBQUM7QUFDbkMsaUJBQU8sR0FBRyxpQkFBZSxJQUFJLEVBQUUsRUFBRSxFQUFFLEVBQUMsR0FBRyxFQUFILEdBQUcsRUFBQyxDQUFDO0FBQzNDLGVBQUssR0FBRyxFQUFFOztBQUNkLGlCQUFPLENBQUMsRUFBRSxDQUFDLGNBQWMsRUFBRSxVQUFDLFFBQVEsRUFBSztBQUN2QyxpQkFBSyxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUM7V0FDaEMsQ0FBQyxDQUFDOzsyQ0FDRyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQzs7OzsyQ0FDaEIsc0JBQUUsS0FBSyxDQUFDLEVBQUUsQ0FBQzs7O0FBQ2pCLGVBQUssQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0FBQ3BDLGVBQUssQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFDO0FBQ3JDLGVBQUssQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDOzs7Ozs7O0dBQ2pDLENBQUMsQ0FBQzs7QUFFSCxVQUFRLENBQUMsUUFBUSxFQUFFLFlBQVk7QUFDN0IsTUFBRSxDQUFDLG1EQUFtRCxFQUFFO1VBQ2xELENBQUM7Ozs7QUFBRCxhQUFDLEdBQUcsaUJBQWUsWUFBWSxDQUFDOzs2Q0FDOUIsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLFlBQVksQ0FBQyxXQUFXLENBQUM7Ozs7Ozs7S0FDL0QsQ0FBQyxDQUFDO0FBQ0gsTUFBRSxDQUFDLDJEQUEyRCxFQUFFO1VBQzFELE9BQU8sRUFDUCxDQUFDOzs7O0FBREQsbUJBQU8sR0FBRyxLQUFLO0FBQ2YsYUFBQyxHQUFHLGlCQUFlLElBQUksQ0FBQzs7QUFDNUIsYUFBQyxDQUFDLEVBQUUsQ0FBQyxRQUFRLEVBQUUsVUFBQyxNQUFNLEVBQUs7QUFDekIsa0JBQUksTUFBTSxFQUFFO0FBQ1YsdUJBQU8sR0FBRyxJQUFJLENBQUM7ZUFDaEI7YUFDRixDQUFDLENBQUM7OzZDQUNHLENBQUMsQ0FBQyxLQUFLLEVBQUU7OztBQUNmLG1CQUFPLENBQUMsTUFBTSxDQUFDLEVBQUUsUUFBSyxDQUFDOzs7Ozs7O0tBQ3hCLENBQUMsQ0FBQztBQUNILE1BQUUsQ0FBQyw2REFBNkQsRUFBRTtVQUM1RCxPQUFPLEVBQ1AsQ0FBQzs7OztBQURELG1CQUFPLEdBQUcsS0FBSztBQUNmLGFBQUMsR0FBRyxpQkFBZSx5QkFBVyxZQUFZLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDOztBQUN4RCxhQUFDLENBQUMsRUFBRSxDQUFDLFFBQVEsRUFBRSxVQUFDLE1BQU0sRUFBSztBQUN6QixrQkFBSSxNQUFNLEVBQUU7QUFDVix1QkFBTyxHQUFHLElBQUksQ0FBQztlQUNoQjthQUNGLENBQUMsQ0FBQzs7NkNBQ0csQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7OztBQUNoQixtQkFBTyxDQUFDLE1BQU0sQ0FBQyxFQUFFLFNBQU0sQ0FBQzs7NkNBQ2xCLHNCQUFFLEtBQUssQ0FBQyxJQUFJLENBQUM7OztBQUNuQixtQkFBTyxDQUFDLE1BQU0sQ0FBQyxFQUFFLFFBQUssQ0FBQzs7Ozs7OztLQUN4QixDQUFDLENBQUM7QUFDSCxNQUFFLENBQUMsZ0VBQWdFLEVBQUU7VUFDL0QsQ0FBQzs7OztBQUFELGFBQUMsR0FBRyxpQkFBZSxZQUFZLENBQUM7OzZDQUM5QixDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLFlBQVksQ0FBQyxXQUFXLENBQUM7Ozs7Ozs7S0FDaEUsQ0FBQyxDQUFDO0FBQ0gsTUFBRSxDQUFDLDJEQUEyRCxFQUFFO1VBQzFELEVBQUUsRUFDRixPQUFPLEVBQ1AsQ0FBQzs7OztBQUZELGNBQUUsR0FBRyxTQUFMLEVBQUUsQ0FBSSxNQUFNLEVBQUs7QUFBRSxxQkFBTyxNQUFNLENBQUM7YUFBRTs7QUFDbkMsbUJBQU8sR0FBRyxLQUFLO0FBQ2YsYUFBQyxHQUFHLGlCQUFlLElBQUksQ0FBQzs7QUFDNUIsYUFBQyxDQUFDLEVBQUUsQ0FBQyxRQUFRLEVBQUUsVUFBQyxNQUFNLEVBQUs7QUFDekIsa0JBQUksTUFBTSxFQUFFO0FBQ1YsdUJBQU8sR0FBRyxJQUFJLENBQUM7ZUFDaEI7YUFDRixDQUFDLENBQUM7OzZDQUNHLENBQUMsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDOzs7QUFDakIsbUJBQU8sQ0FBQyxNQUFNLENBQUMsRUFBRSxRQUFLLENBQUM7Ozs7Ozs7S0FDeEIsQ0FBQyxDQUFDO0FBQ0gsTUFBRSxDQUFDLGlEQUFpRCxFQUFFO1VBQ2hELEVBQUUsRUFDRixDQUFDOzs7O0FBREQsY0FBRSxHQUFHLFNBQUwsRUFBRSxHQUFTO0FBQUUsb0JBQU0sSUFBSSxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7YUFBRTs7QUFDdEMsYUFBQyxHQUFHLGlCQUFlLElBQUksQ0FBQzs7NkNBQ3RCLENBQUMsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQzs7Ozs7OztLQUMzRCxDQUFDLENBQUM7QUFDSCxNQUFFLENBQUMsMkRBQTJELEVBQUU7VUFDMUQsRUFBRSxFQUNGLENBQUMsRUFDRCxLQUFLOzs7O0FBRkwsY0FBRSxHQUFHLFNBQUwsRUFBRSxDQUFJLE1BQU0sRUFBSztBQUFFLHFCQUFPLE1BQU0sQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7YUFBRTs7QUFDN0QsYUFBQyxHQUFHLGlCQUFlLElBQUksQ0FBQztBQUN4QixpQkFBSyxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUU7OzZDQUNoQixDQUFDLENBQUMsS0FBSyxDQUFDLEVBQUUsRUFBRSxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxZQUFZLENBQUMsc0JBQXNCLENBQUM7OztBQUNoRixhQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsR0FBRyxLQUFLLENBQUEsQ0FBRSxNQUFNLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQzs7Ozs7OztLQUMzQyxDQUFDLENBQUM7R0FDSixDQUFDLENBQUM7O0FBRUgsVUFBUSxDQUFDLG9CQUFvQixFQUFFLFlBQVk7QUFDekMsUUFBSSxPQUFPLFlBQUEsQ0FBQztBQUNaLGFBQVMsQ0FBQzs7Ozs7OzZDQUVBLE9BQU8sQ0FBQyxJQUFJLEVBQUU7Ozs7Ozs7Ozs7Ozs7OztLQUV2QixDQUFDLENBQUM7QUFDSCxNQUFFLENBQUMsNkJBQTZCLEVBQUU7Ozs7Ozs7NkNBQzFCLDBCQUFNLG9CQUFPLE9BQU8sRUFBRSxNQUFNOzs7O0FBQ2hDLDJCQUFPLEdBQUcsaUJBQWUseUJBQVcsWUFBWSxDQUFDLEVBQ3hCLENBQUMsSUFBSSxFQUFFLGtCQUFLLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDMUQsMkJBQU8sQ0FBQyxFQUFFLENBQUMsUUFBUSxFQUFFLFVBQUMsTUFBTSxFQUFLO0FBQy9CLDBCQUFJLE1BQU0sSUFBSSxNQUFNLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFO0FBQ3BELDhCQUFNLEVBQUUsQ0FBQzt1QkFDVixNQUFNO0FBQ0wsK0JBQU8sRUFBRSxDQUFDO3VCQUNYO3FCQUNGLENBQUMsQ0FBQzs7cURBQ0csT0FBTyxDQUFDLEtBQUssRUFBRTs7Ozs7OzthQUN0QixDQUFDLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLFFBQVE7Ozs7Ozs7S0FDckMsQ0FBQyxDQUFDO0FBQ0gsTUFBRSxDQUFDLDZCQUE2QixFQUFFOzs7Ozs7OzZDQUMxQiwwQkFBTSxvQkFBTyxPQUFPLEVBQUUsTUFBTTs7OztBQUNoQywyQkFBTyxHQUFHLGlCQUFlLHlCQUFXLE1BQU0sQ0FBQyxFQUFFLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUM7QUFDN0QsMkJBQU8sQ0FBQyxFQUFFLENBQUMsUUFBUSxFQUFFLFVBQUMsTUFBTSxFQUFFLE1BQU0sRUFBSztBQUN2QywwQkFBSSxNQUFNLElBQUksTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRTtBQUMxQyw4QkFBTSxFQUFFLENBQUM7dUJBQ1YsTUFBTTtBQUNMLCtCQUFPLEVBQUUsQ0FBQzt1QkFDWDtxQkFDRixDQUFDLENBQUM7O3FEQUNHLE9BQU8sQ0FBQyxLQUFLLEVBQUU7Ozs7Ozs7YUFDdEIsQ0FBQzs7Ozs7OztLQUNILENBQUMsQ0FBQzs7QUFFSCxNQUFFLENBQUMsNEJBQTRCLEVBQUU7VUFFM0IsS0FBSzs7OztBQURULG1CQUFPLEdBQUcsaUJBQWUsSUFBSSxFQUFFLENBQUMsa0JBQUssT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUN0RCxpQkFBSyxHQUFHLEVBQUU7O0FBQ2QsbUJBQU8sQ0FBQyxFQUFFLENBQUMsY0FBYyxFQUFFLFVBQUMsUUFBUSxFQUFLO0FBQ3ZDLG1CQUFLLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQzthQUNoQyxDQUFDLENBQUM7OzZDQUNHLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDOzs7OzZDQUNoQixzQkFBRSxLQUFLLENBQUMsRUFBRSxDQUFDOzs7QUFDakIsaUJBQUssQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsZUFBZSxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQ3pDLGtCQUFrQixDQUFDLENBQUMsQ0FBQzs7Ozs7OztLQUN4QyxDQUFDLENBQUM7R0FDSixDQUFDLENBQUM7O0FBRUgsVUFBUSxDQUFDLE9BQU8sRUFBRSxZQUFZO0FBQzVCLE1BQUUsQ0FBQyw2Q0FBNkMsRUFBRTs7Ozs7O2dEQUN6QywwQkFBTSxvQkFBTyxPQUFPLEVBQUUsTUFBTTtrQkFDN0IsT0FBTzs7OztBQUFQLDJCQUFPLEdBQUcsaUJBQWUsTUFBTSxFQUFFLENBQUMsSUFBSSxFQUFFLGtCQUFLLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDOztxREFDaEUsT0FBTyxDQUFDLEtBQUssRUFBRTs7O0FBQ3JCLDJCQUFPLENBQUMsRUFBRSxDQUFDLE1BQU0sRUFBRSxVQUFDLElBQUksRUFBRSxNQUFNLEVBQUs7QUFDbkMsMEJBQUk7QUFDRiw4QkFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUM7QUFDaEMsK0JBQU8sRUFBRSxDQUFDO3VCQUNYLENBQUMsT0FBTyxDQUFDLEVBQUU7QUFDViw4QkFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO3VCQUNYO3FCQUNGLENBQUMsQ0FBQzs7cURBQ0csT0FBTyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUM7Ozs7Ozs7YUFDL0IsQ0FBQzs7Ozs7OztLQUNILENBQUMsQ0FBQzs7QUFFSCxNQUFFLENBQUMscURBQXFELEVBQUU7VUFDcEQsT0FBTzs7OztBQUFQLG1CQUFPLEdBQUcsaUJBQWUseUJBQVcsU0FBUyxDQUFDLEVBQ3JCLENBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxrQkFBSyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQzs7NkNBQ2hFLE9BQU8sQ0FBQyxLQUFLLEVBQUU7Ozs7NkNBQ2YsT0FBTyxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDLENBQ3hCLE1BQU0sQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLFlBQVksQ0FBQyxvQkFBb0IsQ0FBQzs7Ozs7NkNBS3hELFlBQUssTUFBTSxFQUFFLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDOzs7Ozs7Ozs7Ozs7OzZDQUcxQyxZQUFLLE1BQU0sRUFBRSxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7S0FFL0MsQ0FBQyxDQUFDOztBQUVILE1BQUUsQ0FBQyw2Q0FBNkMsRUFBRTtVQUM1QyxPQUFPOzs7O0FBQVAsbUJBQU8sR0FBRyxpQkFBZSxJQUFJLENBQUM7OzZDQUM1QixPQUFPLENBQUMsSUFBSSxFQUFFLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsWUFBWSxDQUFDLFlBQVksQ0FBQzs7Ozs2Q0FDOUQsT0FBTyxDQUFDLEtBQUssRUFBRTs7Ozs2Q0FDZixzQkFBRSxLQUFLLENBQUMsRUFBRSxDQUFDOzs7OzZDQUNYLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxZQUFZLENBQUMsWUFBWSxDQUFDOzs7Ozs7O0tBQ3JFLENBQUMsQ0FBQztHQUNKLENBQUMsQ0FBQzs7QUFFSCxVQUFRLENBQUMsT0FBTyxFQUFFLFlBQVk7QUFDNUIsTUFBRSxDQUFDLG1EQUFtRCxFQUFFO1VBQ2hELElBQUk7Ozs7QUFBSixnQkFBSSxHQUFHLGlCQUFlLHlCQUFXLGVBQWUsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7OzZDQUMxRCxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsWUFBWSxDQUFDLFlBQVksQ0FBQzs7Ozs7OztLQUNsRSxDQUFDLENBQUM7O0FBRUgsTUFBRSxDQUFDLGlEQUFpRCxFQUFFO1VBQzlDLElBQUksRUFDSixHQUFHLEVBR0gsSUFBSTs7OztBQUpKLGdCQUFJLEdBQUcsaUJBQWUseUJBQVcsWUFBWSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUN2RCxlQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsRUFBRTs7NkNBQ2hCLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDOzs7OzZDQUNiLElBQUksQ0FBQyxJQUFJLEVBQUU7OztBQUNYLGdCQUFJLEdBQUcsSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLEdBQUc7O0FBQzdCLGdCQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7Ozs7Ozs7S0FDNUIsQ0FBQyxDQUFDOztBQUVILE1BQUUsQ0FBQyxzREFBc0QsRUFBRTtVQUNuRCxJQUFJOzs7O0FBQUosZ0JBQUksR0FBRyxpQkFBZSx5QkFBVyxVQUFVLENBQUMsQ0FBQzs7NkNBQzdDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDOzs7OzZDQUNiLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxZQUFZLENBQUMsNkJBQTZCLENBQUM7Ozs7Ozs7S0FDbkYsQ0FBQyxDQUFDOztBQUVILE1BQUUsQ0FBQyxpRUFBaUUsRUFBRTtVQUM5RCxJQUFJOzs7O0FBQUosZ0JBQUksR0FBRyxpQkFBZSx5QkFBVyxVQUFVLENBQUMsQ0FBQzs7NkNBQzdDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDOzs7OzZDQUNiLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7Ozs7Ozs7S0FDcEQsQ0FBQyxDQUFDO0dBQ0osQ0FBQyxDQUFDOztBQUVILFVBQVEsQ0FBQyxZQUFZLEVBQUUsWUFBWTtBQUNqQyxNQUFFLENBQUMsK0NBQStDLEVBQUU7VUFDNUMsSUFBSSxFQUNOLEtBQUs7Ozs7QUFESCxnQkFBSSxHQUFHLGlCQUFlLHlCQUFXLGVBQWUsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDNUQsaUJBQUssR0FBRyxFQUFFOztBQUNkLGdCQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsRUFBRSxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDOzs2Q0FDekMsSUFBSSxDQUFDLEtBQUssRUFBRTs7Ozs2Q0FDWixJQUFJLENBQUMsSUFBSSxFQUFFOzs7QUFDakIsaUJBQUssQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDaEMsaUJBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUM7Ozs7Ozs7S0FDN0MsQ0FBQyxDQUFDO0dBQ0osQ0FBQyxDQUFDOztBQUVILFVBQVEsQ0FBQyxlQUFlLEVBQUUsWUFBWTtBQUNwQyxNQUFFLENBQUMsc0RBQXNELEVBQUU7VUFDbkQsSUFBSSxFQUNOLFVBQVUsRUFDVixTQUFTLEVBQ1QsVUFBVSxFQUNWLFNBQVM7Ozs7QUFKUCxnQkFBSSxHQUFHLGlCQUFlLHlCQUFXLFlBQVksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDekQsc0JBQVUsR0FBRyxFQUFFO0FBQ2YscUJBQVMsR0FBRyxLQUFLO0FBQ2pCLHNCQUFVLEdBQUcsS0FBSztBQUNsQixxQkFBUyxHQUFHLEtBQUs7O0FBQ3JCLGdCQUFJLENBQUMsRUFBRSxDQUFDLE1BQU0sRUFBRSxVQUFDLElBQUksRUFBRSxNQUFNLEVBQUs7QUFBRSx3QkFBVSxHQUFHLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDO2FBQUUsQ0FBQyxDQUFDO0FBQ3BFLGdCQUFJLENBQUMsRUFBRSxDQUFDLEtBQUssRUFBRSxZQUFNO0FBQUUsdUJBQVMsR0FBRyxJQUFJLENBQUM7YUFBRSxDQUFDLENBQUM7QUFDNUMsZ0JBQUksQ0FBQyxFQUFFLENBQUMsTUFBTSxFQUFFLFlBQU07QUFBRSx3QkFBVSxHQUFHLElBQUksQ0FBQzthQUFFLENBQUMsQ0FBQztBQUM5QyxnQkFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsWUFBTTtBQUFFLHVCQUFTLEdBQUcsSUFBSSxDQUFDO2FBQUUsQ0FBQyxDQUFDOzs2Q0FDdEMsSUFBSSxDQUFDLEtBQUssRUFBRTs7Ozs2Q0FDWixJQUFJLENBQUMsSUFBSSxFQUFFOzs7QUFDakIsc0JBQVUsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7QUFDakMscUJBQVMsQ0FBQyxNQUFNLENBQUMsRUFBRSxTQUFNLENBQUM7QUFDMUIsc0JBQVUsQ0FBQyxNQUFNLENBQUMsRUFBRSxTQUFNLENBQUM7QUFDM0IscUJBQVMsQ0FBQyxNQUFNLENBQUMsRUFBRSxRQUFLLENBQUM7Ozs7Ozs7S0FDMUIsQ0FBQyxDQUFDOztBQUVILE1BQUUsQ0FBQywwREFBMEQsRUFBRTtVQUN2RCxJQUFJLEVBQ04sVUFBVSxFQUNWLFNBQVMsRUFDVCxVQUFVLEVBQ1YsU0FBUzs7OztBQUpQLGdCQUFJLEdBQUcsaUJBQWUsTUFBTSxFQUFFLENBQUMsSUFBSSxFQUFFLGtCQUFLLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO0FBQ2pFLHNCQUFVLEdBQUcsRUFBRTtBQUNmLHFCQUFTLEdBQUcsS0FBSztBQUNqQixzQkFBVSxHQUFHLEVBQUU7QUFDZixxQkFBUyxHQUFHLEtBQUs7O0FBQ3JCLGdCQUFJLENBQUMsRUFBRSxDQUFDLE1BQU0sRUFBRSxVQUFDLElBQUksRUFBRSxNQUFNLEVBQUs7QUFBRSx3QkFBVSxHQUFHLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDO2FBQUUsQ0FBQyxDQUFDO0FBQ3BFLGdCQUFJLENBQUMsRUFBRSxDQUFDLE1BQU0sRUFBRSxVQUFDLElBQUksRUFBRSxNQUFNLEVBQUs7QUFBRSx3QkFBVSxHQUFHLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDO2FBQUUsQ0FBQyxDQUFDO0FBQ3BFLGdCQUFJLENBQUMsRUFBRSxDQUFDLEtBQUssRUFBRSxZQUFNO0FBQUUsdUJBQVMsR0FBRyxJQUFJLENBQUM7YUFBRSxDQUFDLENBQUM7QUFDNUMsZ0JBQUksQ0FBQyxFQUFFLENBQUMsS0FBSyxFQUFFLFlBQU07QUFBRSx1QkFBUyxHQUFHLElBQUksQ0FBQzthQUFFLENBQUMsQ0FBQzs7NkNBQ3RDLElBQUksQ0FBQyxLQUFLLEVBQUU7Ozs7NkNBQ1osSUFBSSxDQUFDLElBQUksRUFBRTs7O0FBQ2pCLHNCQUFVLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxTQUFTLENBQUMsQ0FBQyxDQUFDO0FBQ3pDLHNCQUFVLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUNsQyxxQkFBUyxDQUFDLE1BQU0sQ0FBQyxFQUFFLFNBQU0sQ0FBQztBQUMxQixxQkFBUyxDQUFDLE1BQU0sQ0FBQyxFQUFFLFNBQU0sQ0FBQzs7Ozs7OztLQUMzQixDQUFDLENBQUM7O0FBRUgsTUFBRSxDQUFDLHVFQUF1RSxFQUFFO1VBQ3BFLElBQUksRUFDTixVQUFVLEVBQ1YsU0FBUyxFQUNULFVBQVUsRUFDVixTQUFTOzs7O0FBSlAsZ0JBQUksR0FBRyxpQkFBZSxNQUFNLEVBQUUsQ0FBQyxJQUFJLEVBQUUsa0JBQUssT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7QUFDakUsc0JBQVUsR0FBRyxFQUFFO0FBQ2YscUJBQVMsR0FBRyxFQUFFO0FBQ2Qsc0JBQVUsR0FBRyxLQUFLO0FBQ2xCLHFCQUFTLEdBQUcsS0FBSzs7QUFDckIsZ0JBQUksQ0FBQyxFQUFFLENBQUMsTUFBTSxFQUFFLFVBQUMsSUFBSSxFQUFFLE1BQU0sRUFBSztBQUFFLHdCQUFVLEdBQUcsQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7YUFBRSxDQUFDLENBQUM7QUFDcEUsZ0JBQUksQ0FBQyxFQUFFLENBQUMsS0FBSyxFQUFFLFVBQUMsSUFBSSxFQUFFLE1BQU0sRUFBSztBQUFFLHVCQUFTLEdBQUcsQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7YUFBRSxDQUFDLENBQUM7QUFDbEUsZ0JBQUksQ0FBQyxFQUFFLENBQUMsTUFBTSxFQUFFLFlBQU07QUFBRSx3QkFBVSxHQUFHLElBQUksQ0FBQzthQUFFLENBQUMsQ0FBQztBQUM5QyxnQkFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsWUFBTTtBQUFFLHVCQUFTLEdBQUcsSUFBSSxDQUFDO2FBQUUsQ0FBQyxDQUFDOzs2Q0FDdEMsSUFBSSxDQUFDLEtBQUssRUFBRTs7Ozs2Q0FDWixZQUFLLE9BQU8sRUFBRSxDQUFDLElBQUksZUFBYSxrQkFBSyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUcsQ0FBQzs7Ozs7NkNBRTFELElBQUksQ0FBQyxJQUFJLEVBQUU7Ozs7Ozs7Ozs7O0FBRW5CLHNCQUFVLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxTQUFTLENBQUMsQ0FBQyxDQUFDO0FBQ3pDLHFCQUFTLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUNqQyxzQkFBVSxDQUFDLE1BQU0sQ0FBQyxFQUFFLFNBQU0sQ0FBQztBQUMzQixxQkFBUyxDQUFDLE1BQU0sQ0FBQyxFQUFFLFNBQU0sQ0FBQzs7Ozs7OztLQUMzQixDQUFDLENBQUM7R0FDSixDQUFDLENBQUM7Q0FDSixDQUFDLENBQUMiLCJmaWxlIjoidGVzdC9zdWJwcm9jLXNwZWNzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gdHJhbnNwaWxlOm1vY2hhXG5cbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgZXhlYywgU3ViUHJvY2VzcyB9IGZyb20gJy4uJztcbmltcG9ydCBjaGFpIGZyb20gJ2NoYWknO1xuaW1wb3J0IGNoYWlBc1Byb21pc2VkIGZyb20gJ2NoYWktYXMtcHJvbWlzZWQnO1xuaW1wb3J0IHsgZ2V0Rml4dHVyZSB9IGZyb20gJy4vaGVscGVycyc7XG5pbXBvcnQgeyBzeXN0ZW0gfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5cblxuLy8gV2luZG93cyBkb2Vzbid0IHVuZGVyc3RhbmQgU0lHSFVQXG5sZXQgc3RvcFNpZ25hbCA9IHN5c3RlbS5pc1dpbmRvd3MoKSA/ICdTSUdURVJNJyA6ICdTSUdIVVAnO1xuY29uc3Qgc2hvdWxkID0gY2hhaS5zaG91bGQoKTtcbmNoYWkudXNlKGNoYWlBc1Byb21pc2VkKTtcblxuZGVzY3JpYmUoJ1N1YlByb2Nlc3MnLCBmdW5jdGlvbiAoKSB7XG4gIGl0KCdzaG91bGQgdGhyb3cgYW4gZXJyb3IgaWYgaW5pdGlhbGl6ZWQgd2l0aG91dCBhIGNvbW1hbmQnLCBmdW5jdGlvbiAoKSB7XG4gICAgc2hvdWxkLnRocm93KCgpID0+IHtcbiAgICAgIG5ldyBTdWJQcm9jZXNzKCk7XG4gICAgfSk7XG4gIH0pO1xuICBpdCgnc2hvdWxkIHRocm93IGFuIGVycm9yIGlmIGluaXRpYWxpemVkIHdpdGggYSBiYWQgY29tbWFuZCcsIGZ1bmN0aW9uICgpIHtcbiAgICBzaG91bGQudGhyb3coKCkgPT4ge1xuICAgICAgbmV3IFN1YlByb2Nlc3Moe2xvbDogdHJ1ZX0pO1xuICAgIH0pO1xuICAgIHNob3VsZC50aHJvdygoKSA9PiB7XG4gICAgICBuZXcgU3ViUHJvY2VzcygxKTtcbiAgICB9KTtcbiAgfSk7XG4gIGl0KCdzaG91bGQgdGhyb3cgYW4gZXJyb3IgaWYgaW5pdGlhbGl6ZWQgd2l0aCBiYWQgYXJncycsIGZ1bmN0aW9uICgpIHtcbiAgICBzaG91bGQudGhyb3coKCkgPT4ge1xuICAgICAgbmV3IFN1YlByb2Nlc3MoJ2xzJywgJ2ZvbycpO1xuICAgIH0pO1xuICAgIHNob3VsZC50aHJvdygoKSA9PiB7XG4gICAgICBuZXcgU3ViUHJvY2VzcygnbHMnLCAxKTtcbiAgICB9KTtcbiAgICBzaG91bGQudGhyb3coKCkgPT4ge1xuICAgICAgbmV3IFN1YlByb2Nlc3MoJ2xzJywge30pO1xuICAgIH0pO1xuICB9KTtcbiAgaXQoJ3Nob3VsZCBkZWZhdWx0IGFyZ3MgbGlzdCB0byBbXScsIGZ1bmN0aW9uICgpIHtcbiAgICBsZXQgeCA9IG5ldyBTdWJQcm9jZXNzKCdscycpO1xuICAgIHguYXJncy5zaG91bGQuZXFsKFtdKTtcbiAgfSk7XG4gIGl0KCdzaG91bGQgZGVmYXVsdCBvcHRzIGRpY3QgdG8ge30nLCBmdW5jdGlvbiAoKSB7XG4gICAgbGV0IHggPSBuZXcgU3ViUHJvY2VzcygnbHMnKTtcbiAgICB4Lm9wdHMuc2hvdWxkLmVxbCh7fSk7XG4gIH0pO1xuICBpdCgnc2hvdWxkIHBhc3Mgb3B0cyB0byBzcGF3bicsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCBjd2QgPSBwYXRoLnJlc29sdmUoZ2V0Rml4dHVyZSgnLicpKTtcbiAgICBjb25zdCBzdWJwcm9jID0gbmV3IFN1YlByb2Nlc3MoJ2xzJywgW10sIHtjd2R9KTtcbiAgICBsZXQgbGluZXMgPSBbXTtcbiAgICBzdWJwcm9jLm9uKCdsaW5lcy1zdGRvdXQnLCAobmV3TGluZXMpID0+IHtcbiAgICAgIGxpbmVzID0gbGluZXMuY29uY2F0KG5ld0xpbmVzKTtcbiAgICB9KTtcbiAgICBhd2FpdCBzdWJwcm9jLnN0YXJ0KDApO1xuICAgIGF3YWl0IEIuZGVsYXkoNTApO1xuICAgIGxpbmVzLnNob3VsZC5pbmNsdWRlKCdiYWRfZXhpdC5zaCcpO1xuICAgIGxpbmVzLnNob3VsZC5jb250YWluKCdiaWdidWZmZXIuanMnKTtcbiAgICBsaW5lcy5zaG91bGQuY29udGFpbignZWNoby5zaCcpO1xuICB9KTtcblxuICBkZXNjcmliZSgnI3N0YXJ0JywgZnVuY3Rpb24gKCkge1xuICAgIGl0KCdzaG91bGQgdGhyb3cgYW4gZXJyb3IgaWYgY29tbWFuZCBmYWlscyBvbiBzdGFydHVwJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IHMgPSBuZXcgU3ViUHJvY2VzcygnYmxhcmdpbWFyZycpO1xuICAgICAgYXdhaXQgcy5zdGFydCgpLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlamVjdGVkV2l0aCgvbm90IGZvdW5kLyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBoYXZlIGEgZGVmYXVsdCBzdGFydERldGVjdG9yIG9mIHdhaXRpbmcgZm9yIG91dHB1dCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBoYXNEYXRhID0gZmFsc2U7XG4gICAgICBsZXQgcyA9IG5ldyBTdWJQcm9jZXNzKCdscycpO1xuICAgICAgcy5vbignb3V0cHV0JywgKHN0ZG91dCkgPT4ge1xuICAgICAgICBpZiAoc3Rkb3V0KSB7XG4gICAgICAgICAgaGFzRGF0YSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgYXdhaXQgcy5zdGFydCgpO1xuICAgICAgaGFzRGF0YS5zaG91bGQuYmUudHJ1ZTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGludGVycHJldCBhIG51bWVyaWMgc3RhcnREZXRlY3RvciBhcyBhIHN0YXJ0IHRpbWVvdXQnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBsZXQgaGFzRGF0YSA9IGZhbHNlO1xuICAgICAgbGV0IHMgPSBuZXcgU3ViUHJvY2VzcyhnZXRGaXh0dXJlKCdzbGVlcHlwcm9jJyksIFsnbHMnXSk7XG4gICAgICBzLm9uKCdvdXRwdXQnLCAoc3Rkb3V0KSA9PiB7XG4gICAgICAgIGlmIChzdGRvdXQpIHtcbiAgICAgICAgICBoYXNEYXRhID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBhd2FpdCBzLnN0YXJ0KDApO1xuICAgICAgaGFzRGF0YS5zaG91bGQuYmUuZmFsc2U7XG4gICAgICBhd2FpdCBCLmRlbGF5KDEyMDApO1xuICAgICAgaGFzRGF0YS5zaG91bGQuYmUudHJ1ZTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGZhaWwgZXZlbiB3aXRoIGEgc3RhcnQgdGltZW91dCBvZiAwIHdoZW4gY29tbWFuZCBpcyBiYWQnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBsZXQgcyA9IG5ldyBTdWJQcm9jZXNzKCdibGFyZ2ltYXJnJyk7XG4gICAgICBhd2FpdCBzLnN0YXJ0KDApLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlamVjdGVkV2l0aCgvbm90IGZvdW5kLyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBiZSBhYmxlIHRvIHByb3ZpZGUgYSBjdXN0b20gc3RhcnREZXRlY3RvciBmdW5jdGlvbicsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBzZCA9IChzdGRvdXQpID0+IHsgcmV0dXJuIHN0ZG91dDsgfTtcbiAgICAgIGxldCBoYXNEYXRhID0gZmFsc2U7XG4gICAgICBsZXQgcyA9IG5ldyBTdWJQcm9jZXNzKCdscycpO1xuICAgICAgcy5vbignb3V0cHV0JywgKHN0ZG91dCkgPT4ge1xuICAgICAgICBpZiAoc3Rkb3V0KSB7XG4gICAgICAgICAgaGFzRGF0YSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgYXdhaXQgcy5zdGFydChzZCk7XG4gICAgICBoYXNEYXRhLnNob3VsZC5iZS50cnVlO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgcGFzcyBvbiBjdXN0b20gZXJyb3JzIGZyb20gc3RhcnREZXRlY3RvcicsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBzZCA9ICgpID0+IHsgdGhyb3cgbmV3IEVycm9yKCdmb28nKTsgfTtcbiAgICAgIGxldCBzID0gbmV3IFN1YlByb2Nlc3MoJ2xzJyk7XG4gICAgICBhd2FpdCBzLnN0YXJ0KHNkKS5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZFdpdGgoL2Zvby8pO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgdGltZSBvdXQgc3RhcnRzIHRoYXQgdGFrZSBsb25nZXIgdGhhbiBzcGVjaWZpZWQgbXMnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBsZXQgc2QgPSAoc3Rkb3V0KSA9PiB7IHJldHVybiBzdGRvdXQuaW5kZXhPZignbm90aGVyZScpICE9PSAtMTsgfTtcbiAgICAgIGxldCBzID0gbmV3IFN1YlByb2Nlc3MoJ2xzJyk7XG4gICAgICBsZXQgc3RhcnQgPSBEYXRlLm5vdygpO1xuICAgICAgYXdhaXQgcy5zdGFydChzZCwgNTAwKS5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZFdpdGgoL2RpZCBub3Qgc3RhcnQuK3RpbWUvaSk7XG4gICAgICAoRGF0ZS5ub3coKSAtIHN0YXJ0KS5zaG91bGQuYmUuYmVsb3coNjAwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2xpc3RlbmluZyBmb3IgZGF0YScsIGZ1bmN0aW9uICgpIHtcbiAgICBsZXQgc3VicHJvYztcbiAgICBhZnRlckVhY2goYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgc3VicHJvYy5zdG9wKCk7XG4gICAgICB9IGNhdGNoIChpZ24pIHt9XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBnZXQgb3V0cHV0IGFzIHBhcmFtcycsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGF3YWl0IG5ldyBCKGFzeW5jIChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgc3VicHJvYyA9IG5ldyBTdWJQcm9jZXNzKGdldEZpeHR1cmUoJ3NsZWVweXByb2MnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsnbHMnLCBwYXRoLnJlc29sdmUoX19kaXJuYW1lKV0pO1xuICAgICAgICBzdWJwcm9jLm9uKCdvdXRwdXQnLCAoc3Rkb3V0KSA9PiB7XG4gICAgICAgICAgaWYgKHN0ZG91dCAmJiBzdGRvdXQuaW5kZXhPZignc3VicHJvYy1zcGVjcycpID09PSAtMSkge1xuICAgICAgICAgICAgcmVqZWN0KCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBhd2FpdCBzdWJwcm9jLnN0YXJ0KCk7XG4gICAgICB9KS5zaG91bGQuZXZlbnR1YWxseS5ub3QuYmUucmVqZWN0ZWQ7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBnZXQgb3V0cHV0IGFzIHBhcmFtcycsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGF3YWl0IG5ldyBCKGFzeW5jIChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgc3VicHJvYyA9IG5ldyBTdWJQcm9jZXNzKGdldEZpeHR1cmUoJ2VjaG8nKSwgWydmb28nLCAnYmFyJ10pO1xuICAgICAgICBzdWJwcm9jLm9uKCdvdXRwdXQnLCAoc3Rkb3V0LCBzdGRlcnIpID0+IHtcbiAgICAgICAgICBpZiAoc3RkZXJyICYmIHN0ZGVyci5pbmRleE9mKCdiYXInKSA9PT0gLTEpIHtcbiAgICAgICAgICAgIHJlamVjdCgpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgYXdhaXQgc3VicHJvYy5zdGFydCgpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGdldCBvdXRwdXQgYnkgbGluZXMnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBzdWJwcm9jID0gbmV3IFN1YlByb2Nlc3MoJ2xzJywgW3BhdGgucmVzb2x2ZShfX2Rpcm5hbWUpXSk7XG4gICAgICBsZXQgbGluZXMgPSBbXTtcbiAgICAgIHN1YnByb2Mub24oJ2xpbmVzLXN0ZG91dCcsIChuZXdMaW5lcykgPT4ge1xuICAgICAgICBsaW5lcyA9IGxpbmVzLmNvbmNhdChuZXdMaW5lcyk7XG4gICAgICB9KTtcbiAgICAgIGF3YWl0IHN1YnByb2Muc3RhcnQoMCk7XG4gICAgICBhd2FpdCBCLmRlbGF5KDUwKTtcbiAgICAgIGxpbmVzLnNob3VsZC5lcWwoWydleGVjLXNwZWNzLmpzJywgJ2ZpeHR1cmVzJywgJ2hlbHBlcnMuanMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ3N1YnByb2Mtc3BlY3MuanMnXSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCcjc3RvcCcsIGZ1bmN0aW9uICgpIHtcbiAgICBpdCgnc2hvdWxkIHNlbmQgdGhlIHJpZ2h0IHNpZ25hbCB0byBzdG9wIGEgcHJvYycsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBuZXcgQihhc3luYyAocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGxldCBzdWJwcm9jID0gbmV3IFN1YlByb2Nlc3MoJ3RhaWwnLCBbJy1mJywgcGF0aC5yZXNvbHZlKF9fZmlsZW5hbWUpXSk7XG4gICAgICAgIGF3YWl0IHN1YnByb2Muc3RhcnQoKTtcbiAgICAgICAgc3VicHJvYy5vbignZXhpdCcsIChjb2RlLCBzaWduYWwpID0+IHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgc2lnbmFsLnNob3VsZC5lcXVhbChzdG9wU2lnbmFsKTtcbiAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgYXdhaXQgc3VicHJvYy5zdG9wKHN0b3BTaWduYWwpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRpbWUgb3V0IGlmIHN0b3AgZG9lc250IGNvbXBsZXRlIGZhc3QgZW5vdWdoJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IHN1YnByb2MgPSBuZXcgU3ViUHJvY2VzcyhnZXRGaXh0dXJlKCd0cmFwaHVwJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsndGFpbCcsICctZicsIHBhdGgucmVzb2x2ZShfX2ZpbGVuYW1lKV0pO1xuICAgICAgYXdhaXQgc3VicHJvYy5zdGFydCgpO1xuICAgICAgYXdhaXQgc3VicHJvYy5zdG9wKHN0b3BTaWduYWwsIDEpXG4gICAgICAgICAgICAgIC5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZFdpdGgoL1Byb2Nlc3MgZGlkbid0IGVuZC8pO1xuXG4gICAgICAvLyBuZWVkIHRvIGtpbGwgdGhlIHByb2Nlc3NcbiAgICAgIC8vIDEgZm9yIHRoZSB0cmFwLCAxIGZvciB0aGUgdGFpbFxuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgZXhlYygna2lsbCcsIFsnLTknLCBzdWJwcm9jLnByb2MucGlkICsgMV0pO1xuICAgICAgfSBjYXRjaCAoaWduKSB7fVxuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgZXhlYygna2lsbCcsIFsnLTknLCBzdWJwcm9jLnByb2MucGlkXSk7XG4gICAgICB9IGNhdGNoIChpZ24pIHt9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGVycm9yIGlmIHRoZXJlIGlzIG5vIHByb2Nlc3MgdG8gc3RvcCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBzdWJwcm9jID0gbmV3IFN1YlByb2Nlc3MoJ2xzJyk7XG4gICAgICBhd2FpdCBzdWJwcm9jLnN0b3AoKS5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZFdpdGgoL0Nhbid0IHN0b3AvKTtcbiAgICAgIGF3YWl0IHN1YnByb2Muc3RhcnQoKTtcbiAgICAgIGF3YWl0IEIuZGVsYXkoMTApO1xuICAgICAgYXdhaXQgc3VicHJvYy5zdG9wKCkuc2hvdWxkLmV2ZW50dWFsbHkuYmUucmVqZWN0ZWRXaXRoKC9DYW4ndCBzdG9wLyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCcjam9pbicsIGZ1bmN0aW9uICgpIHtcbiAgICBpdCgnc2hvdWxkIGZhaWwgaWYgdGhlICNzdGFydCBoYXMgbm90IHlldCBiZWVuIGNhbGxlZCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IHByb2MgPSBuZXcgU3ViUHJvY2VzcyhnZXRGaXh0dXJlKCdzbGVlcHlwcm9jLnNoJyksIFsnbHMnXSk7XG4gICAgICBhd2FpdCBwcm9jLmpvaW4oKS5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZFdpdGgoL0Nhbid0IGpvaW4vKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgd2FpdCB1bnRpbCB0aGUgcHJvY2VzcyBoYXMgYmVlbiBmaW5pc2hlZCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IHByb2MgPSBuZXcgU3ViUHJvY2VzcyhnZXRGaXh0dXJlKCdzbGVlcHlwcm9jJyksIFsnbHMnXSk7XG4gICAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgICAgYXdhaXQgcHJvYy5zdGFydCgwKTtcbiAgICAgIGF3YWl0IHByb2Muam9pbigpO1xuICAgICAgY29uc3QgZGlmZiA9IERhdGUubm93KCkgLSBub3c7XG4gICAgICBkaWZmLnNob3VsZC5iZS5hYm92ZSgxMDAwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgaWYgcHJvY2VzcyBlbmRzIHdpdGggYSBpbnZhbGlkIGV4aXRjb2RlJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgcHJvYyA9IG5ldyBTdWJQcm9jZXNzKGdldEZpeHR1cmUoJ2JhZF9leGl0JykpO1xuICAgICAgYXdhaXQgcHJvYy5zdGFydCgwKTtcbiAgICAgIGF3YWl0IHByb2Muam9pbigpLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlamVjdGVkV2l0aCgvUHJvY2VzcyBlbmRlZCB3aXRoIGV4aXRjb2RlLyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIE5PVCB0aHJvdyBpZiBwcm9jZXNzIGVuZHMgd2l0aCBhIGN1c3RvbSBhbGxvd2VkIGV4aXRjb2RlJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgcHJvYyA9IG5ldyBTdWJQcm9jZXNzKGdldEZpeHR1cmUoJ2JhZF9leGl0JykpO1xuICAgICAgYXdhaXQgcHJvYy5zdGFydCgwKTtcbiAgICAgIGF3YWl0IHByb2Muam9pbihbMV0pLnNob3VsZC5ldmVudHVhbGx5LmJlLmJlY29tZSgxKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJyNlbWl0TGluZXMnLCBmdW5jdGlvbiAoKSB7XG4gICAgaXQoJ3Nob3VsZCBlbWl0IHNpbmdsZSBsaW5lcyB3aXRoIHN0cmVhbSBpbiBmcm9udCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IHByb2MgPSBuZXcgU3ViUHJvY2VzcyhnZXRGaXh0dXJlKCdzbGVlcHlwcm9jLnNoJyksIFsnbHMnXSk7XG4gICAgICBsZXQgbGluZXMgPSBbXTtcbiAgICAgIHByb2Mub24oJ3N0cmVhbS1saW5lJywgbGluZXMucHVzaC5iaW5kKGxpbmVzKSk7XG4gICAgICBhd2FpdCBwcm9jLnN0YXJ0KCk7XG4gICAgICBhd2FpdCBwcm9jLnN0b3AoKTtcbiAgICAgIGxpbmVzLmxlbmd0aC5zaG91bGQuYmUuYWJvdmUoNSk7XG4gICAgICBsaW5lc1swXS5zbGljZSgwLCA4KS5zaG91bGQuZXFsKFwiW1NURE9VVF1cIik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdvbiBleGl0IC8gZGllJywgZnVuY3Rpb24gKCkge1xuICAgIGl0KCdzaG91bGQgZW1pdCBleGl0L2VuZCBhbmQgbm8gc3RvcC9kaWUgaW4gbm9ybWFsIGV4aXRzJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgcHJvYyA9IG5ldyBTdWJQcm9jZXNzKGdldEZpeHR1cmUoJ3NsZWVweXByb2MnKSwgWydscyddKTtcbiAgICAgIGxldCBleGl0Q2F1Z2h0ID0gW107XG4gICAgICBsZXQgZGllQ2F1Z2h0ID0gZmFsc2U7XG4gICAgICBsZXQgc3RvcENhdWdodCA9IGZhbHNlO1xuICAgICAgbGV0IGVuZENhdWdodCA9IGZhbHNlO1xuICAgICAgcHJvYy5vbignZXhpdCcsIChjb2RlLCBzaWduYWwpID0+IHsgZXhpdENhdWdodCA9IFtjb2RlLCBzaWduYWxdOyB9KTtcbiAgICAgIHByb2Mub24oJ2RpZScsICgpID0+IHsgZGllQ2F1Z2h0ID0gdHJ1ZTsgfSk7XG4gICAgICBwcm9jLm9uKCdzdG9wJywgKCkgPT4geyBzdG9wQ2F1Z2h0ID0gdHJ1ZTsgfSk7XG4gICAgICBwcm9jLm9uKCdlbmQnLCAoKSA9PiB7IGVuZENhdWdodCA9IHRydWU7IH0pO1xuICAgICAgYXdhaXQgcHJvYy5zdGFydCgpO1xuICAgICAgYXdhaXQgcHJvYy5qb2luKCk7XG4gICAgICBleGl0Q2F1Z2h0LnNob3VsZC5lcWwoWzAsIG51bGxdKTtcbiAgICAgIGRpZUNhdWdodC5zaG91bGQuYmUuZmFsc2U7XG4gICAgICBzdG9wQ2F1Z2h0LnNob3VsZC5iZS5mYWxzZTtcbiAgICAgIGVuZENhdWdodC5zaG91bGQuYmUudHJ1ZTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZW1pdCBleGl0L3N0b3AgYW5kIG5vIGVuZC9kaWUgd2hlbiB3ZSBzdG9wIGEgcHJvYycsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IHByb2MgPSBuZXcgU3ViUHJvY2VzcygndGFpbCcsIFsnLWYnLCBwYXRoLnJlc29sdmUoX19maWxlbmFtZSldKTtcbiAgICAgIGxldCBleGl0Q2F1Z2h0ID0gW107XG4gICAgICBsZXQgZGllQ2F1Z2h0ID0gZmFsc2U7XG4gICAgICBsZXQgc3RvcENhdWdodCA9IFtdO1xuICAgICAgbGV0IGVuZENhdWdodCA9IGZhbHNlO1xuICAgICAgcHJvYy5vbignZXhpdCcsIChjb2RlLCBzaWduYWwpID0+IHsgZXhpdENhdWdodCA9IFtjb2RlLCBzaWduYWxdOyB9KTtcbiAgICAgIHByb2Mub24oJ3N0b3AnLCAoY29kZSwgc2lnbmFsKSA9PiB7IHN0b3BDYXVnaHQgPSBbY29kZSwgc2lnbmFsXTsgfSk7XG4gICAgICBwcm9jLm9uKCdkaWUnLCAoKSA9PiB7IGRpZUNhdWdodCA9IHRydWU7IH0pO1xuICAgICAgcHJvYy5vbignZW5kJywgKCkgPT4geyBlbmRDYXVnaHQgPSB0cnVlOyB9KTtcbiAgICAgIGF3YWl0IHByb2Muc3RhcnQoKTtcbiAgICAgIGF3YWl0IHByb2Muc3RvcCgpO1xuICAgICAgZXhpdENhdWdodC5zaG91bGQuZXFsKFtudWxsLCAnU0lHVEVSTSddKTtcbiAgICAgIHN0b3BDYXVnaHQuc2hvdWxkLmVxbChleGl0Q2F1Z2h0KTtcbiAgICAgIGRpZUNhdWdodC5zaG91bGQuYmUuZmFsc2U7XG4gICAgICBlbmRDYXVnaHQuc2hvdWxkLmJlLmZhbHNlO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBlbWl0IGV4aXQvZGllIGFuZCBubyBzdG9wL2VuZCB3aGVuIGEgcHJvYyBpcyBraWxsZWQgZXh0ZXJuYWxseScsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IHByb2MgPSBuZXcgU3ViUHJvY2VzcygndGFpbCcsIFsnLWYnLCBwYXRoLnJlc29sdmUoX19maWxlbmFtZSldKTtcbiAgICAgIGxldCBleGl0Q2F1Z2h0ID0gW107XG4gICAgICBsZXQgZGllQ2F1Z2h0ID0gW107XG4gICAgICBsZXQgc3RvcENhdWdodCA9IGZhbHNlO1xuICAgICAgbGV0IGVuZENhdWdodCA9IGZhbHNlO1xuICAgICAgcHJvYy5vbignZXhpdCcsIChjb2RlLCBzaWduYWwpID0+IHsgZXhpdENhdWdodCA9IFtjb2RlLCBzaWduYWxdOyB9KTtcbiAgICAgIHByb2Mub24oJ2RpZScsIChjb2RlLCBzaWduYWwpID0+IHsgZGllQ2F1Z2h0ID0gW2NvZGUsIHNpZ25hbF07IH0pO1xuICAgICAgcHJvYy5vbignc3RvcCcsICgpID0+IHsgc3RvcENhdWdodCA9IHRydWU7IH0pO1xuICAgICAgcHJvYy5vbignZW5kJywgKCkgPT4geyBlbmRDYXVnaHQgPSB0cnVlOyB9KTtcbiAgICAgIGF3YWl0IHByb2Muc3RhcnQoKTtcbiAgICAgIGF3YWl0IGV4ZWMoJ3BraWxsJywgWyctZicsIGB0YWlsIC1mICR7cGF0aC5yZXNvbHZlKF9fZmlsZW5hbWUpfWBdKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHByb2Muam9pbigpO1xuICAgICAgfSBjYXRjaCAoaWduKSB7fVxuICAgICAgZXhpdENhdWdodC5zaG91bGQuZXFsKFtudWxsLCAnU0lHVEVSTSddKTtcbiAgICAgIGRpZUNhdWdodC5zaG91bGQuZXFsKGV4aXRDYXVnaHQpO1xuICAgICAgc3RvcENhdWdodC5zaG91bGQuYmUuZmFsc2U7XG4gICAgICBlbmRDYXVnaHQuc2hvdWxkLmJlLmZhbHNlO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIuLi8uLiJ9
