'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _ = require('../../..');

var _2 = _interopRequireDefault(_);

var _appiumTestSupport = require('appium-test-support');

var _appiumSupport = require('appium-support');

var _temp = require('temp');

var _temp2 = _interopRequireDefault(_temp);

var _appiumAdb = require('appium-adb');

var _appiumAdb2 = _interopRequireDefault(_appiumAdb);

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

_chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

var driver = new _2['default']();
var adb = new _appiumAdb2['default']();
driver.adb = adb;
describe('recording the screen', function () {
  this.timeout(60000);

  describe('basic', (0, _appiumTestSupport.withMocks)({ adb: adb, driver: driver, fs: _appiumSupport.fs, temp: _temp2['default'] }, function (mocks) {
    var localFile = '/path/to/local.mp4';
    var mediaContent = new Buffer('appium');

    it('should fail to recording the screen on an older emulator', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            mocks.driver.expects('isEmulator').returns(true);
            mocks.adb.expects('getApiLevel').returns(26);

            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(driver.startRecordingScreen().should.eventually.be.rejectedWith(/Screen recording does not work on emulators/));

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should fail to recording the screen on a device with API level 18', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            mocks.driver.expects('isEmulator').returns(false);
            mocks.adb.expects('getApiLevel').returns(18);

            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(driver.startRecordingScreen().should.eventually.be.rejectedWith(/Screen recording not available on API Level 18. Minimum API Level is 19/));

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    describe('beginning the recording', function () {
      beforeEach(function () {
        driver._recentScreenRecordingPath = null;
        mocks.driver.expects('isEmulator').atLeast(1).returns(false);
        mocks.adb.expects('getApiLevel').atLeast(1).returns(19);
        mocks.adb.expects('getPIDsByName').atLeast(1).withExactArgs('screenrecord').returns([]);
      });
      afterEach(function () {
        mocks.driver.verify();
        mocks.adb.verify();
        mocks.fs.verify();
        mocks.temp.verify();
      });

      it('should call adb to start screen recording', function callee$3$0() {
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              mocks.adb.expects('shell').once().returns(new _bluebird2['default'](function () {}));
              mocks.adb.expects('fileSize').once().returns(39571);

              context$4$0.next = 4;
              return _regeneratorRuntime.awrap(driver.startRecordingScreen());

            case 4:
              driver._recentScreenRecordingPath.should.not.be.empty;

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, this);
      });

      it('should return previous capture before starting a new recording', function callee$3$0() {
        var remotePath;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              remotePath = '/sdcard/video.mp4';

              mocks.adb.expects('shell').returns(new _bluebird2['default'](function () {}));
              mocks.adb.expects('fileSize').once().returns(39571);
              mocks.adb.expects('pull').once().withExactArgs(remotePath, localFile);
              mocks.fs.expects('readFile').once().withExactArgs(localFile).returns(mediaContent);
              mocks.adb.expects('rimraf').once().withExactArgs(remotePath);
              mocks.fs.expects('rimraf').withExactArgs(localFile).once();
              mocks.fs.expects('stat').once().withExactArgs(localFile).returns({ size: 100 });
              mocks.temp.expects('path').once().returns(localFile);

              driver._recentScreenRecordingPath = remotePath;
              context$4$0.next = 12;
              return _regeneratorRuntime.awrap(driver.startRecordingScreen());

            case 12:
              context$4$0.t0 = mediaContent.toString('base64');
              context$4$0.sent.should.be.eql(context$4$0.t0);

              driver._recentScreenRecordingPath.should.not.be.empty;
              driver._recentScreenRecordingPath.should.not.be.eql(localFile);

            case 16:
            case 'end':
              return context$4$0.stop();
          }
        }, null, this);
      });

      it('should fail if adb screen recording errors out', function callee$3$0() {
        var shellStub;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              mocks.adb.expects('fileSize').returns(31);
              shellStub = _sinon2['default'].stub(adb, 'shell');
              context$4$0.prev = 2;

              shellStub.returns(_bluebird2['default'].reject(new Error('shell command failed')));

              context$4$0.next = 6;
              return _regeneratorRuntime.awrap(driver.startRecordingScreen().should.eventually.be.rejectedWith(/shell command failed/));

            case 6:
              context$4$0.prev = 6;

              shellStub.restore();
              return context$4$0.finish(6);

            case 9:
            case 'end':
              return context$4$0.stop();
          }
        }, null, this, [[2,, 6, 9]]);
      });

      it('should call ls multiple times until size is big enough', function callee$3$0() {
        var fileSizeStub;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              mocks.adb.expects('shell').once().returns(new _bluebird2['default'](function () {}));
              fileSizeStub = _sinon2['default'].stub(adb, 'fileSize');
              context$4$0.prev = 2;

              fileSizeStub.onCall(0).returns(31).onCall(1).returns(42);

              context$4$0.next = 6;
              return _regeneratorRuntime.awrap(driver.startRecordingScreen());

            case 6:
              context$4$0.prev = 6;

              fileSizeStub.restore();
              return context$4$0.finish(6);

            case 9:
            case 'end':
              return context$4$0.stop();
          }
        }, null, this, [[2,, 6, 9]]);
      });

      it('should call ls multiple times and fail if size never gets big enough', function callee$3$0() {
        var fileSizeStub;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              mocks.adb.expects('shell').once().returns(new _bluebird2['default'](function () {}));
              fileSizeStub = _sinon2['default'].stub(adb, 'fileSize');
              context$4$0.prev = 2;

              fileSizeStub.withArgs().returns(31);

              context$4$0.next = 6;
              return _regeneratorRuntime.awrap(driver.startRecordingScreen().should.eventually.be.rejectedWith(/is still too small: 31 bytes/));

            case 6:
              context$4$0.prev = 6;

              fileSizeStub.restore();
              return context$4$0.finish(6);

            case 9:
            case 'end':
              return context$4$0.stop();
          }
        }, null, this, [[2,, 6, 9]]);
      });
    });

    describe('stopRecordingScreen', function () {
      var psOutput = '\n      USER           PID  PPID     VSZ    RSS WCHAN            ADDR S NAME\n      root          8384     2       0      0 worker_thread       0 S [kworker/0:1]\n      u0_a43        8400  1510 1449772  90992 ep_poll             0 S com.google.android.apps.messaging:rcs\n      root          8423     2       0      0 worker_thread       0 S [kworker/u4:2]\n      u0_a43        8435  1510 1452544  93576 ep_poll             0 S com.google.android.apps.messaging\n      u0_a7         8471  1510 1427536  79804 ep_poll             0 S android.process.acore\n      root          8669     2       0      0 worker_thread       0 S [kworker/u5:1]\n      u0_a35        8805  1510 1426428  61540 ep_poll             0 S com.google.android.apps.wallpaper\n      u0_a10        8864  1510 1427412  69752 ep_poll             0 S android.process.media\n      root          8879     2       0      0 worker_thread       0 S [kworker/1:1]\n      u0_a60        8897  1510 1490420 108852 ep_poll             0 S com.google.android.apps.photos\n      shell         9136  1422    7808   2784 0            ebddfaf0 R ps\n      ';

      beforeEach(function () {
        mocks.driver.expects('isEmulator').atLeast(1).returns(false);
        mocks.adb.expects('getApiLevel').atLeast(1).returns(19);
      });
      afterEach(function () {
        mocks.driver.verify();
        mocks.adb.verify();
        mocks.fs.verify();
        mocks.temp.verify();
      });

      it('should kill the process and get the content of the created mp4 file using lsof', function callee$3$0() {
        var pids, remotePath;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              pids = ['1'];

              driver._recentScreenRecordingPath = null;
              remotePath = '/sdcard/file.mp4';

              mocks.adb.expects('getPIDsByName').withExactArgs('screenrecord').atLeast(1).returns(pids);
              mocks.adb.expects('shell').withExactArgs(['lsof', '-p', pids.join(',')]).returns({ output: '\n          screenrec 11328      shell  mem       REG              253,0   1330160        554 /system/bin/linker64\n          screenrec 11328      shell    0u     unix                          0t0      99935 socket\n          screenrec 11328      shell    1u     unix                          0t0      99935 socket\n          screenrec 11328      shell    2u     unix                          0t0      99937 socket\n          screenrec 11328      shell    3u      CHR              10,64       0t0      12300 /dev/binder\n          screenrec 11328      shell    4u     unix                          0t0     101825 socket\n          screenrec 11328      shell    5w      CHR              254,0       0t0       2923 /dev/pmsg0\n          screenrec 11328      shell    6u      CHR              10,62       0t0      11690 /dev/ashmem\n          screenrec 11328      shell    7u      CHR              10,62       0t0      11690 /dev/ashmem\n          screenrec 11328      shell    8w      REG                0,5         0       6706 /sys/kernel/debug/tracing/trace_marker\n          screenrec 11328      shell    9u      REG               0,19     11521     294673 ' + remotePath + '\n        ' });
              mocks.adb.expects('shell').withExactArgs(['kill', '-2'].concat(pids));
              mocks.adb.expects('shell').withExactArgs(['ps']).returns(psOutput);
              mocks.adb.expects('pull').once().withExactArgs(remotePath, localFile);
              mocks.fs.expects('readFile').once().withExactArgs(localFile).returns(mediaContent);
              mocks.adb.expects('rimraf').once().withExactArgs(remotePath);
              mocks.fs.expects('rimraf').once().withExactArgs(localFile);
              mocks.fs.expects('stat').once().withExactArgs(localFile).returns({ size: 100 });
              mocks.temp.expects('path').once().returns(localFile);

              context$4$0.next = 15;
              return _regeneratorRuntime.awrap(driver.stopRecordingScreen());

            case 15:
              context$4$0.t0 = mediaContent.toString('base64');
              context$4$0.sent.should.eql(context$4$0.t0);

            case 17:
            case 'end':
              return context$4$0.stop();
          }
        }, null, this);
      });

      it('should use the remembered file path if present', function callee$3$0() {
        var pids;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              pids = ['1'];

              driver._recentScreenRecordingPath = '/sdcard/file.mp4';
              mocks.adb.expects('getPIDsByName').withExactArgs('screenrecord').atLeast(1).returns(pids);
              mocks.adb.expects('shell').withExactArgs(['kill', '-2'].concat(pids));
              mocks.adb.expects('shell').withExactArgs(['ps']).returns(psOutput);
              mocks.adb.expects('pull').once().withExactArgs(driver._recentScreenRecordingPath, localFile);
              mocks.fs.expects('readFile').once().withExactArgs(localFile).returns(mediaContent);
              mocks.adb.expects('rimraf').once().withExactArgs(driver._recentScreenRecordingPath);
              mocks.fs.expects('rimraf').withExactArgs(localFile).once();
              mocks.fs.expects('stat').once().withExactArgs(localFile).returns({ size: 100 });
              mocks.temp.expects('path').once().returns(localFile);

              context$4$0.next = 13;
              return _regeneratorRuntime.awrap(driver.stopRecordingScreen());

            case 13:
              context$4$0.t0 = mediaContent.toString('base64');
              context$4$0.sent.should.eql(context$4$0.t0);

            case 15:
            case 'end':
              return context$4$0.stop();
          }
        }, null, this);
      });

      it('should fail if the recorded file is too large', function callee$3$0() {
        var pids;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              pids = ['1'];

              driver._recentScreenRecordingPath = '/sdcard/file.mp4';
              mocks.adb.expects('getPIDsByName').withExactArgs('screenrecord').atLeast(1).returns(pids);
              mocks.adb.expects('shell').withExactArgs(['kill', '-2'].concat(pids));
              mocks.adb.expects('shell').withExactArgs(['ps']).returns(psOutput);
              mocks.adb.expects('pull').once().withExactArgs(driver._recentScreenRecordingPath, localFile);
              mocks.adb.expects('rimraf').once().withExactArgs(driver._recentScreenRecordingPath);
              mocks.fs.expects('rimraf').withExactArgs(localFile).once();
              mocks.fs.expects('stat').once().withExactArgs(localFile).returns({ size: process.memoryUsage().heapTotal });
              mocks.temp.expects('path').once().returns(localFile);

              context$4$0.next = 12;
              return _regeneratorRuntime.awrap(driver.stopRecordingScreen().should.eventually.be.rejectedWith(/is too large/));

            case 12:
            case 'end':
              return context$4$0.stop();
          }
        }, null, this);
      });

      it('should return empty string if no recording processes are running', function callee$3$0() {
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              driver._recentScreenRecordingPath = null;
              mocks.adb.expects('getPIDsByName').atLeast(1).withExactArgs('screenrecord').returns([]);

              context$4$0.next = 4;
              return _regeneratorRuntime.awrap(driver.stopRecordingScreen());

            case 4:
              context$4$0.sent.should.eql('');

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, this);
      });
    });
  }));
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvdW5pdC9jb21tYW5kcy9yZWNvcmRzY3JlZW4tc3BlY3MuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O29CQUFpQixNQUFNOzs7OzhCQUNJLGtCQUFrQjs7OztnQkFDbkIsVUFBVTs7OztpQ0FDVixxQkFBcUI7OzZCQUM1QixnQkFBZ0I7O29CQUNsQixNQUFNOzs7O3lCQUNQLFlBQVk7Ozs7cUJBQ1YsT0FBTzs7Ozt3QkFDWCxVQUFVOzs7O0FBR3hCLGtCQUFLLE1BQU0sRUFBRSxDQUFDO0FBQ2Qsa0JBQUssR0FBRyw2QkFBZ0IsQ0FBQzs7QUFFekIsSUFBSSxNQUFNLEdBQUcsbUJBQW1CLENBQUM7QUFDakMsSUFBSSxHQUFHLEdBQUcsNEJBQVMsQ0FBQztBQUNwQixNQUFNLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQztBQUNqQixRQUFRLENBQUMsc0JBQXNCLEVBQUUsWUFBWTtBQUMzQyxNQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDOztBQUVwQixVQUFRLENBQUMsT0FBTyxFQUFFLGtDQUFVLEVBQUMsR0FBRyxFQUFILEdBQUcsRUFBRSxNQUFNLEVBQU4sTUFBTSxFQUFFLEVBQUUsbUJBQUEsRUFBRSxJQUFJLG1CQUFBLEVBQUMsRUFBRSxVQUFDLEtBQUssRUFBSztBQUM5RCxRQUFNLFNBQVMsR0FBRyxvQkFBb0IsQ0FBQztBQUN2QyxRQUFNLFlBQVksR0FBRyxJQUFJLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQzs7QUFFMUMsTUFBRSxDQUFDLDBEQUEwRCxFQUFFOzs7O0FBQzdELGlCQUFLLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDakQsaUJBQUssQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQzs7OzZDQUV2QyxNQUFNLENBQUMsb0JBQW9CLEVBQUUsQ0FBQyxNQUFN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TSxDQUFDLDBCQUEwQixHQUFHLElBQUksQ0FBQztBQUN6QyxtQkFBSyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQy9CLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUMsY0FBYyxDQUFDLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDOzs7K0NBRWpELE1BQU0sQ0FBQyxtQkFBbUIsRUFBRTs7OytCQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRTs7Ozs7OztPQUNuRCxDQUFDLENBQUM7S0FDSixDQUFDLENBQUM7R0FDSixDQUFDLENBQUMsQ0FBQztDQUNMLENBQUMsQ0FBQyIsImZpbGUiOiJ0ZXN0L3VuaXQvY29tbWFuZHMvcmVjb3Jkc2NyZWVuLXNwZWNzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGNoYWkgZnJvbSAnY2hhaSc7XG5pbXBvcnQgY2hhaUFzUHJvbWlzZWQgZnJvbSAnY2hhaS1hcy1wcm9taXNlZCc7XG5pbXBvcnQgQW5kcm9pZERyaXZlciBmcm9tICcuLi8uLi8uLic7XG5pbXBvcnQgeyB3aXRoTW9ja3MgfSBmcm9tICdhcHBpdW0tdGVzdC1zdXBwb3J0JztcbmltcG9ydCB7IGZzIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IHRlbXAgZnJvbSAndGVtcCc7XG5pbXBvcnQgQURCIGZyb20gJ2FwcGl1bS1hZGInO1xuaW1wb3J0IHNpbm9uIGZyb20gJ3Npbm9uJztcbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcblxuXG5jaGFpLnNob3VsZCgpO1xuY2hhaS51c2UoY2hhaUFzUHJvbWlzZWQpO1xuXG5sZXQgZHJpdmVyID0gbmV3IEFuZHJvaWREcml2ZXIoKTtcbmxldCBhZGIgPSBuZXcgQURCKCk7XG5kcml2ZXIuYWRiID0gYWRiO1xuZGVzY3JpYmUoJ3JlY29yZGluZyB0aGUgc2NyZWVuJywgZnVuY3Rpb24gKCkge1xuICB0aGlzLnRpbWVvdXQoNjAwMDApO1xuXG4gIGRlc2NyaWJlKCdiYXNpYycsIHdpdGhNb2Nrcyh7YWRiLCBkcml2ZXIsIGZzLCB0ZW1wfSwgKG1vY2tzKSA9PiB7XG4gICAgY29uc3QgbG9jYWxGaWxlID0gJy9wYXRoL3RvL2xvY2FsLm1wNCc7XG4gICAgY29uc3QgbWVkaWFDb250ZW50ID0gbmV3IEJ1ZmZlcignYXBwaXVtJyk7XG5cbiAgICBpdCgnc2hvdWxkIGZhaWwgdG8gcmVjb3JkaW5nIHRoZSBzY3JlZW4gb24gYW4gb2xkZXIgZW11bGF0b3InLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBtb2Nrcy5kcml2ZXIuZXhwZWN0cygnaXNFbXVsYXRvcicpLnJldHVybnModHJ1ZSk7XG4gICAgICBtb2Nrcy5hZGIuZXhwZWN0cygnZ2V0QXBpTGV2ZWwnKS5yZXR1cm5zKDI2KTtcblxuICAgICAgYXdhaXQgZHJpdmVyLnN0YXJ0UmVjb3JkaW5nU2NyZWVuKCkuc2hvdWxkLmV2ZW50dWFsbHkuYmUucmVqZWN0ZWRXaXRoKC9TY3JlZW4gcmVjb3JkaW5nIGRvZXMgbm90IHdvcmsgb24gZW11bGF0b3JzLyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGZhaWwgdG8gcmVjb3JkaW5nIHRoZSBzY3JlZW4gb24gYSBkZXZpY2Ugd2l0aCBBUEkgbGV2ZWwgMTgnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBtb2Nrcy5kcml2ZXIuZXhwZWN0cygnaXNFbXVsYXRvcicpLnJldHVybnMoZmFsc2UpO1xuICAgICAgbW9ja3MuYWRiLmV4cGVjdHMoJ2dldEFwaUxldmVsJykucmV0dXJucygxOCk7XG5cbiAgICAgIGF3YWl0IGRyaXZlci5zdGFydFJlY29yZGluZ1NjcmVlbigpLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlamVjdGVkV2l0aCgvU2NyZWVuIHJlY29yZGluZyBub3QgYXZhaWxhYmxlIG9uIEFQSSBMZXZlbCAxOC4gTWluaW11bSBBUEkgTGV2ZWwgaXMgMTkvKTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdiZWdpbm5pbmcgdGhlIHJlY29yZGluZycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGJlZm9yZUVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICBkcml2ZXIuX3JlY2VudFNjcmVlblJlY29yZGluZ1BhdGggPSBudWxsO1xuICAgICAgICBtb2Nrcy5kcml2ZXIuZXhwZWN0cygnaXNFbXVsYXRvcicpLmF0TGVhc3QoMSkucmV0dXJucyhmYWxzZSk7XG4gICAgICAgIG1vY2tzLmFkYi5leHBlY3RzKCdnZXRBcGlMZXZlbCcpLmF0TGVhc3QoMSkucmV0dXJucygxOSk7XG4gICAgICAgIG1vY2tzLmFkYi5leHBlY3RzKCdnZXRQSURzQnlOYW1lJylcbiAgICAgICAgICAuYXRMZWFzdCgxKS53aXRoRXhhY3RBcmdzKCdzY3JlZW5yZWNvcmQnKS5yZXR1cm5zKFtdKTtcbiAgICAgIH0pO1xuICAgICAgYWZ0ZXJFYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbW9ja3MuZHJpdmVyLnZlcmlmeSgpO1xuICAgICAgICBtb2Nrcy5hZGIudmVyaWZ5KCk7XG4gICAgICAgIG1vY2tzLmZzLnZlcmlmeSgpO1xuICAgICAgICBtb2Nrcy50ZW1wLnZlcmlmeSgpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgY2FsbCBhZGIgdG8gc3RhcnQgc2NyZWVuIHJlY29yZGluZycsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbW9ja3MuYWRiLmV4cGVjdHMoJ3NoZWxsJykub25jZSgpLnJldHVybnMobmV3IEIoKCkgPT4ge30pKTtcbiAgICAgICAgbW9ja3MuYWRiLmV4cGVjdHMoJ2ZpbGVTaXplJykub25jZSgpLnJldHVybnMoMzk1NzEpO1xuXG4gICAgICAgIGF3YWl0IGRyaXZlci5zdGFydFJlY29yZGluZ1NjcmVlbigpO1xuICAgICAgICBkcml2ZXIuX3JlY2VudFNjcmVlblJlY29yZGluZ1BhdGguc2hvdWxkLm5vdC5iZS5lbXB0eTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHJldHVybiBwcmV2aW91cyBjYXB0dXJlIGJlZm9yZSBzdGFydGluZyBhIG5ldyByZWNvcmRpbmcnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnN0IHJlbW90ZVBhdGggPSAnL3NkY2FyZC92aWRlby5tcDQnO1xuXG4gICAgICAgIG1vY2tzLmFkYi5leHBlY3RzKCdzaGVsbCcpLnJldHVybnMobmV3IEIoKCkgPT4ge30pKTtcbiAgICAgICAgbW9ja3MuYWRiLmV4cGVjdHMoJ2ZpbGVTaXplJykub25jZSgpLnJldHVybnMoMzk1NzEpO1xuICAgICAgICBtb2Nrcy5hZGIuZXhwZWN0cygncHVsbCcpLm9uY2UoKS53aXRoRXhhY3RBcmdzKHJlbW90ZVBhdGgsIGxvY2FsRmlsZSk7XG4gICAgICAgIG1vY2tzLmZzLmV4cGVjdHMoJ3JlYWRGaWxlJykub25jZSgpLndpdGhFeGFjdEFyZ3MobG9jYWxGaWxlKS5yZXR1cm5zKG1lZGlhQ29udGVudCk7XG4gICAgICAgIG1vY2tzLmFkYi5leHBlY3RzKCdyaW1yYWYnKS5vbmNlKCkud2l0aEV4YWN0QXJncyhyZW1vdGVQYXRoKTtcbiAgICAgICAgbW9ja3MuZnMuZXhwZWN0cygncmltcmFmJykud2l0aEV4YWN0QXJncyhsb2NhbEZpbGUpLm9uY2UoKTtcbiAgICAgICAgbW9ja3MuZnMuZXhwZWN0cygnc3RhdCcpLm9uY2UoKS53aXRoRXhhY3RBcmdzKGxvY2FsRmlsZSkucmV0dXJucyh7c2l6ZTogMTAwfSk7XG4gICAgICAgIG1vY2tzLnRlbXAuZXhwZWN0cygncGF0aCcpLm9uY2UoKS5yZXR1cm5zKGxvY2FsRmlsZSk7XG5cbiAgICAgICAgZHJpdmVyLl9yZWNlbnRTY3JlZW5SZWNvcmRpbmdQYXRoID0gcmVtb3RlUGF0aDtcbiAgICAgICAgKGF3YWl0IGRyaXZlci5zdGFydFJlY29yZGluZ1NjcmVlbigpKVxuICAgICAgICAgIC5zaG91bGQuYmUuZXFsKG1lZGlhQ29udGVudC50b1N0cmluZygnYmFzZTY0JykpO1xuICAgICAgICBkcml2ZXIuX3JlY2VudFNjcmVlblJlY29yZGluZ1BhdGguc2hvdWxkLm5vdC5iZS5lbXB0eTtcbiAgICAgICAgZHJpdmVyLl9yZWNlbnRTY3JlZW5SZWNvcmRpbmdQYXRoLnNob3VsZC5ub3QuYmUuZXFsKGxvY2FsRmlsZSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBmYWlsIGlmIGFkYiBzY3JlZW4gcmVjb3JkaW5nIGVycm9ycyBvdXQnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgIG1vY2tzLmFkYi5leHBlY3RzKCdmaWxlU2l6ZScpLnJldHVybnMoMzEpO1xuICAgICAgICBsZXQgc2hlbGxTdHViID0gc2lub24uc3R1YihhZGIsICdzaGVsbCcpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHNoZWxsU3R1YlxuICAgICAgICAgICAgLnJldHVybnMoQi5yZWplY3QobmV3IEVycm9yKCdzaGVsbCBjb21tYW5kIGZhaWxlZCcpKSk7XG5cbiAgICAgICAgICBhd2FpdCBkcml2ZXIuc3RhcnRSZWNvcmRpbmdTY3JlZW4oKS5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZFdpdGgoL3NoZWxsIGNvbW1hbmQgZmFpbGVkLyk7XG4gICAgICAgIH0gZmluYWxseSB7XG4gICAgICAgICAgc2hlbGxTdHViLnJlc3RvcmUoKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgY2FsbCBscyBtdWx0aXBsZSB0aW1lcyB1bnRpbCBzaXplIGlzIGJpZyBlbm91Z2gnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgIG1vY2tzLmFkYi5leHBlY3RzKCdzaGVsbCcpLm9uY2UoKS5yZXR1cm5zKG5ldyBCKCgpID0+IHt9KSk7XG4gICAgICAgIGxldCBmaWxlU2l6ZVN0dWIgPSBzaW5vbi5zdHViKGFkYiwgJ2ZpbGVTaXplJyk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgZmlsZVNpemVTdHViXG4gICAgICAgICAgICAgIC5vbkNhbGwoMClcbiAgICAgICAgICAgICAgICAucmV0dXJucygzMSlcbiAgICAgICAgICAgICAgLm9uQ2FsbCgxKVxuICAgICAgICAgICAgICAgIC5yZXR1cm5zKDQyKTtcblxuICAgICAgICAgIGF3YWl0IGRyaXZlci5zdGFydFJlY29yZGluZ1NjcmVlbigpO1xuICAgICAgICB9IGZpbmFsbHkge1xuICAgICAgICAgIGZpbGVTaXplU3R1Yi5yZXN0b3JlKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIGNhbGwgbHMgbXVsdGlwbGUgdGltZXMgYW5kIGZhaWwgaWYgc2l6ZSBuZXZlciBnZXRzIGJpZyBlbm91Z2gnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgIG1vY2tzLmFkYi5leHBlY3RzKCdzaGVsbCcpLm9uY2UoKS5yZXR1cm5zKG5ldyBCKCgpID0+IHt9KSk7XG4gICAgICAgIGxldCBmaWxlU2l6ZVN0dWIgPSBzaW5vbi5zdHViKGFkYiwgJ2ZpbGVTaXplJyk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgZmlsZVNpemVTdHViLndpdGhBcmdzKCkucmV0dXJucygzMSk7XG5cbiAgICAgICAgICBhd2FpdCBkcml2ZXIuc3RhcnRSZWNvcmRpbmdTY3JlZW4oKS5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZFdpdGgoL2lzIHN0aWxsIHRvbyBzbWFsbDogMzEgYnl0ZXMvKTtcbiAgICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgICBmaWxlU2l6ZVN0dWIucmVzdG9yZSgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdzdG9wUmVjb3JkaW5nU2NyZWVuJywgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgcHNPdXRwdXQgPSBgXG4gICAgICBVU0VSICAgICAgICAgICBQSUQgIFBQSUQgICAgIFZTWiAgICBSU1MgV0NIQU4gICAgICAgICAgICBBRERSIFMgTkFNRVxuICAgICAgcm9vdCAgICAgICAgICA4Mzg0ICAgICAyICAgICAgIDAgICAgICAwIHdvcmtlcl90aHJlYWQgICAgICAgMCBTIFtrd29ya2VyLzA6MV1cbiAgICAgIHUwX2E0MyAgICAgICAgODQwMCAgMTUxMCAxNDQ5NzcyICA5MDk5MiBlcF9wb2xsICAgICAgICAgICAgIDAgUyBjb20uZ29vZ2xlLmFuZHJvaWQuYXBwcy5tZXNzYWdpbmc6cmNzXG4gICAgICByb290ICAgICAgICAgIDg0MjMgICAgIDIgICAgICAgMCAgICAgIDAgd29ya2VyX3RocmVhZCAgICAgICAwIFMgW2t3b3JrZXIvdTQ6Ml1cbiAgICAgIHUwX2E0MyAgICAgICAgODQzNSAgMTUxMCAxNDUyNTQ0ICA5MzU3NiBlcF9wb2xsICAgICAgICAgICAgIDAgUyBjb20uZ29vZ2xlLmFuZHJvaWQuYXBwcy5tZXNzYWdpbmdcbiAgICAgIHUwX2E3ICAgICAgICAgODQ3MSAgMTUxMCAxNDI3NTM2ICA3OTgwNCBlcF9wb2xsICAgICAgICAgICAgIDAgUyBhbmRyb2lkLnByb2Nlc3MuYWNvcmVcbiAgICAgIHJvb3QgICAgICAgICAgODY2OSAgICAgMiAgICAgICAwICAgICAgMCB3b3JrZXJfdGhyZWFkICAgICAgIDAgUyBba3dvcmtlci91NToxXVxuICAgICAgdTBfYTM1ICAgICAgICA4ODA1ICAxNTEwIDE0MjY0MjggIDYxNTQwIGVwX3BvbGwgICAgICAgICAgICAgMCBTIGNvbS5nb29nbGUuYW5kcm9pZC5hcHBzLndhbGxwYXBlclxuICAgICAgdTBfYTEwICAgICAgICA4ODY0ICAxNTEwIDE0Mjc0MTIgIDY5NzUyIGVwX3BvbGwgICAgICAgICAgICAgMCBTIGFuZHJvaWQucHJvY2Vzcy5tZWRpYVxuICAgICAgcm9vdCAgICAgICAgICA4ODc5ICAgICAyICAgICAgIDAgICAgICAwIHdvcmtlcl90aHJlYWQgICAgICAgMCBTIFtrd29ya2VyLzE6MV1cbiAgICAgIHUwX2E2MCAgICAgICAgODg5NyAgMTUxMCAxNDkwNDIwIDEwODg1MiBlcF9wb2xsICAgICAgICAgICAgIDAgUyBjb20uZ29vZ2xlLmFuZHJvaWQuYXBwcy5waG90b3NcbiAgICAgIHNoZWxsICAgICAgICAgOTEzNiAgMTQyMiAgICA3ODA4ICAgMjc4NCAwICAgICAgICAgICAgZWJkZGZhZjAgUiBwc1xuICAgICAgYDtcblxuICAgICAgYmVmb3JlRWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgIG1vY2tzLmRyaXZlci5leHBlY3RzKCdpc0VtdWxhdG9yJykuYXRMZWFzdCgxKS5yZXR1cm5zKGZhbHNlKTtcbiAgICAgICAgbW9ja3MuYWRiLmV4cGVjdHMoJ2dldEFwaUxldmVsJykuYXRMZWFzdCgxKS5yZXR1cm5zKDE5KTtcbiAgICAgIH0pO1xuICAgICAgYWZ0ZXJFYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbW9ja3MuZHJpdmVyLnZlcmlmeSgpO1xuICAgICAgICBtb2Nrcy5hZGIudmVyaWZ5KCk7XG4gICAgICAgIG1vY2tzLmZzLnZlcmlmeSgpO1xuICAgICAgICBtb2Nrcy50ZW1wLnZlcmlmeSgpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQga2lsbCB0aGUgcHJvY2VzcyBhbmQgZ2V0IHRoZSBjb250ZW50IG9mIHRoZSBjcmVhdGVkIG1wNCBmaWxlIHVzaW5nIGxzb2YnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnN0IHBpZHMgPSBbJzEnXTtcbiAgICAgICAgZHJpdmVyLl9yZWNlbnRTY3JlZW5SZWNvcmRpbmdQYXRoID0gbnVsbDtcbiAgICAgICAgY29uc3QgcmVtb3RlUGF0aCA9ICcvc2RjYXJkL2ZpbGUubXA0JztcbiAgICAgICAgbW9ja3MuYWRiLmV4cGVjdHMoJ2dldFBJRHNCeU5hbWUnKS53aXRoRXhhY3RBcmdzKCdzY3JlZW5yZWNvcmQnKVxuICAgICAgICAgIC5hdExlYXN0KDEpLnJldHVybnMocGlkcyk7XG4gICAgICAgIG1vY2tzLmFkYi5leHBlY3RzKCdzaGVsbCcpLndpdGhFeGFjdEFyZ3MoWydsc29mJywgJy1wJywgcGlkcy5qb2luKCcsJyldKS5yZXR1cm5zKHtvdXRwdXQ6IGBcbiAgICAgICAgICBzY3JlZW5yZWMgMTEzMjggICAgICBzaGVsbCAgbWVtICAgICAgIFJFRyAgICAgICAgICAgICAgMjUzLDAgICAxMzMwMTYwICAgICAgICA1NTQgL3N5c3RlbS9iaW4vbGlua2VyNjRcbiAgICAgICAgICBzY3JlZW5yZWMgMTEzMjggICAgICBzaGVsbCAgICAwdSAgICAgdW5peCAgICAgICAgICAgICAgICAgICAgICAgICAgMHQwICAgICAgOTk5MzUgc29ja2V0XG4gICAgICAgICAgc2NyZWVucmVjIDExMzI4ICAgICAgc2hlbGwgICAgMXUgICAgIHVuaXggICAgICAgICAgICAgICAgICAgICAgICAgIDB0MCAgICAgIDk5OTM1IHNvY2tldFxuICAgICAgICAgIHNjcmVlbnJlYyAxMTMyOCAgICAgIHNoZWxsICAgIDJ1ICAgICB1bml4ICAgICAgICAgICAgICAgICAgICAgICAgICAwdDAgICAgICA5OTkzNyBzb2NrZXRcbiAgICAgICAgICBzY3JlZW5yZWMgMTEzMjggICAgICBzaGVsbCAgICAzdSAgICAgIENIUiAgICAgICAgICAgICAgMTAsNjQgICAgICAgMHQwICAgICAgMTIzMDAgL2Rldi9iaW5kZXJcbiAgICAgICAgICBzY3JlZW5yZWMgMTEzMjggICAgICBzaGVsbCAgICA0dSAgICAgdW5peCAgICAgICAgICAgICAgICAgICAgICAgICAgMHQwICAgICAxMDE4MjUgc29ja2V0XG4gICAgICAgICAgc2NyZWVucmVjIDExMzI4ICAgICAgc2hlbGwgICAgNXcgICAgICBDSFIgICAgICAgICAgICAgIDI1NCwwICAgICAgIDB0MCAgICAgICAyOTIzIC9kZXYvcG1zZzBcbiAgICAgICAgICBzY3JlZW5yZWMgMTEzMjggICAgICBzaGVsbCAgICA2dSAgICAgIENIUiAgICAgICAgICAgICAgMTAsNjIgICAgICAgMHQwICAgICAgMTE2OTAgL2Rldi9hc2htZW1cbiAgICAgICAgICBzY3JlZW5yZWMgMTEzMjggICAgICBzaGVsbCAgICA3dSAgICAgIENIUiAgICAgICAgICAgICAgMTAsNjIgICAgICAgMHQwICAgICAgMTE2OTAgL2Rldi9hc2htZW1cbiAgICAgICAgICBzY3JlZW5yZWMgMTEzMjggICAgICBzaGVsbCAgICA4dyAgICAgIFJFRyAgICAgICAgICAgICAgICAwLDUgICAgICAgICAwICAgICAgIDY3MDYgL3N5cy9rZXJuZWwvZGVidWcvdHJhY2luZy90cmFjZV9tYXJrZXJcbiAgICAgICAgICBzY3JlZW5yZWMgMTEzMjggICAgICBzaGVsbCAgICA5dSAgICAgIFJFRyAgICAgICAgICAgICAgIDAsMTkgICAgIDExNTIxICAgICAyOTQ2NzMgJHtyZW1vdGVQYXRofVxuICAgICAgICBgfSk7XG4gICAgICAgIG1vY2tzLmFkYi5leHBlY3RzKCdzaGVsbCcpLndpdGhFeGFjdEFyZ3MoWydraWxsJywgJy0yJywgLi4ucGlkc10pO1xuICAgICAgICBtb2Nrcy5hZGIuZXhwZWN0cygnc2hlbGwnKS53aXRoRXhhY3RBcmdzKFsncHMnXSkucmV0dXJucyhwc091dHB1dCk7XG4gICAgICAgIG1vY2tzLmFkYi5leHBlY3RzKCdwdWxsJykub25jZSgpLndpdGhFeGFjdEFyZ3MocmVtb3RlUGF0aCwgbG9jYWxGaWxlKTtcbiAgICAgICAgbW9ja3MuZnMuZXhwZWN0cygncmVhZEZpbGUnKS5vbmNlKCkud2l0aEV4YWN0QXJncyhsb2NhbEZpbGUpLnJldHVybnMobWVkaWFDb250ZW50KTtcbiAgICAgICAgbW9ja3MuYWRiLmV4cGVjdHMoJ3JpbXJhZicpLm9uY2UoKS53aXRoRXhhY3RBcmdzKHJlbW90ZVBhdGgpO1xuICAgICAgICBtb2Nrcy5mcy5leHBlY3RzKCdyaW1yYWYnKS5vbmNlKCkud2l0aEV4YWN0QXJncyhsb2NhbEZpbGUpO1xuICAgICAgICBtb2Nrcy5mcy5leHBlY3RzKCdzdGF0Jykub25jZSgpLndpdGhFeGFjdEFyZ3MobG9jYWxGaWxlKS5yZXR1cm5zKHtzaXplOiAxMDB9KTtcbiAgICAgICAgbW9ja3MudGVtcC5leHBlY3RzKCdwYXRoJykub25jZSgpLnJldHVybnMobG9jYWxGaWxlKTtcblxuICAgICAgICAoYXdhaXQgZHJpdmVyLnN0b3BSZWNvcmRpbmdTY3JlZW4oKSkuc2hvdWxkLmVxbChtZWRpYUNvbnRlbnQudG9TdHJpbmcoJ2Jhc2U2NCcpKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHVzZSB0aGUgcmVtZW1iZXJlZCBmaWxlIHBhdGggaWYgcHJlc2VudCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29uc3QgcGlkcyA9IFsnMSddO1xuICAgICAgICBkcml2ZXIuX3JlY2VudFNjcmVlblJlY29yZGluZ1BhdGggPSAnL3NkY2FyZC9maWxlLm1wNCc7XG4gICAgICAgIG1vY2tzLmFkYi5leHBlY3RzKCdnZXRQSURzQnlOYW1lJykud2l0aEV4YWN0QXJncygnc2NyZWVucmVjb3JkJylcbiAgICAgICAgICAuYXRMZWFzdCgxKS5yZXR1cm5zKHBpZHMpO1xuICAgICAgICBtb2Nrcy5hZGIuZXhwZWN0cygnc2hlbGwnKS53aXRoRXhhY3RBcmdzKFsna2lsbCcsICctMicsIC4uLnBpZHNdKTtcbiAgICAgICAgbW9ja3MuYWRiLmV4cGVjdHMoJ3NoZWxsJykud2l0aEV4YWN0QXJncyhbJ3BzJ10pLnJldHVybnMocHNPdXRwdXQpO1xuICAgICAgICBtb2Nrcy5hZGIuZXhwZWN0cygncHVsbCcpLm9uY2UoKS53aXRoRXhhY3RBcmdzKGRyaXZlci5fcmVjZW50U2NyZWVuUmVjb3JkaW5nUGF0aCwgbG9jYWxGaWxlKTtcbiAgICAgICAgbW9ja3MuZnMuZXhwZWN0cygncmVhZEZpbGUnKS5vbmNlKCkud2l0aEV4YWN0QXJncyhsb2NhbEZpbGUpLnJldHVybnMobWVkaWFDb250ZW50KTtcbiAgICAgICAgbW9ja3MuYWRiLmV4cGVjdHMoJ3JpbXJhZicpLm9uY2UoKS53aXRoRXhhY3RBcmdzKGRyaXZlci5fcmVjZW50U2NyZWVuUmVjb3JkaW5nUGF0aCk7XG4gICAgICAgIG1vY2tzLmZzLmV4cGVjdHMoJ3JpbXJhZicpLndpdGhFeGFjdEFyZ3MobG9jYWxGaWxlKS5vbmNlKCk7XG4gICAgICAgIG1vY2tzLmZzLmV4cGVjdHMoJ3N0YXQnKS5vbmNlKCkud2l0aEV4YWN0QXJncyhsb2NhbEZpbGUpLnJldHVybnMoe3NpemU6IDEwMH0pO1xuICAgICAgICBtb2Nrcy50ZW1wLmV4cGVjdHMoJ3BhdGgnKS5vbmNlKCkucmV0dXJucyhsb2NhbEZpbGUpO1xuXG4gICAgICAgIChhd2FpdCBkcml2ZXIuc3RvcFJlY29yZGluZ1NjcmVlbigpKS5zaG91bGQuZXFsKG1lZGlhQ29udGVudC50b1N0cmluZygnYmFzZTY0JykpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgZmFpbCBpZiB0aGUgcmVjb3JkZWQgZmlsZSBpcyB0b28gbGFyZ2UnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnN0IHBpZHMgPSBbJzEnXTtcbiAgICAgICAgZHJpdmVyLl9yZWNlbnRTY3JlZW5SZWNvcmRpbmdQYXRoID0gJy9zZGNhcmQvZmlsZS5tcDQnO1xuICAgICAgICBtb2Nrcy5hZGIuZXhwZWN0cygnZ2V0UElEc0J5TmFtZScpLndpdGhFeGFjdEFyZ3MoJ3NjcmVlbnJlY29yZCcpXG4gICAgICAgICAgLmF0TGVhc3QoMSkucmV0dXJucyhwaWRzKTtcbiAgICAgICAgbW9ja3MuYWRiLmV4cGVjdHMoJ3NoZWxsJykud2l0aEV4YWN0QXJncyhbJ2tpbGwnLCAnLTInLCAuLi5waWRzXSk7XG4gICAgICAgIG1vY2tzLmFkYi5leHBlY3RzKCdzaGVsbCcpLndpdGhFeGFjdEFyZ3MoWydwcyddKS5yZXR1cm5zKHBzT3V0cHV0KTtcbiAgICAgICAgbW9ja3MuYWRiLmV4cGVjdHMoJ3B1bGwnKS5vbmNlKCkud2l0aEV4YWN0QXJncyhkcml2ZXIuX3JlY2VudFNjcmVlblJlY29yZGluZ1BhdGgsIGxvY2FsRmlsZSk7XG4gICAgICAgIG1vY2tzLmFkYi5leHBlY3RzKCdyaW1yYWYnKS5vbmNlKCkud2l0aEV4YWN0QXJncyhkcml2ZXIuX3JlY2VudFNjcmVlblJlY29yZGluZ1BhdGgpO1xuICAgICAgICBtb2Nrcy5mcy5leHBlY3RzKCdyaW1yYWYnKS53aXRoRXhhY3RBcmdzKGxvY2FsRmlsZSkub25jZSgpO1xuICAgICAgICBtb2Nrcy5mcy5leHBlY3RzKCdzdGF0Jykub25jZSgpLndpdGhFeGFjdEFyZ3MobG9jYWxGaWxlKVxuICAgICAgICAgIC5yZXR1cm5zKHtzaXplOiBwcm9jZXNzLm1lbW9yeVVzYWdlKCkuaGVhcFRvdGFsfSk7XG4gICAgICAgIG1vY2tzLnRlbXAuZXhwZWN0cygncGF0aCcpLm9uY2UoKS5yZXR1cm5zKGxvY2FsRmlsZSk7XG5cbiAgICAgICAgYXdhaXQgZHJpdmVyLnN0b3BSZWNvcmRpbmdTY3JlZW4oKS5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZFdpdGgoL2lzIHRvbyBsYXJnZS8pO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGVtcHR5IHN0cmluZyBpZiBubyByZWNvcmRpbmcgcHJvY2Vzc2VzIGFyZSBydW5uaW5nJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgICBkcml2ZXIuX3JlY2VudFNjcmVlblJlY29yZGluZ1BhdGggPSBudWxsO1xuICAgICAgICBtb2Nrcy5hZGIuZXhwZWN0cygnZ2V0UElEc0J5TmFtZScpXG4gICAgICAgICAgLmF0TGVhc3QoMSkud2l0aEV4YWN0QXJncygnc2NyZWVucmVjb3JkJykucmV0dXJucyhbXSk7XG5cbiAgICAgICAgKGF3YWl0IGRyaXZlci5zdG9wUmVjb3JkaW5nU2NyZWVuKCkpLnNob3VsZC5lcWwoJycpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pKTtcbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIuLi8uLi8uLi8uLiJ9
