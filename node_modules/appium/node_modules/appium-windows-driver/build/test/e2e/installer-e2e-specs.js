/* eslint-disable no-console */

'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _this = this;

var _libInstaller = require('../../lib/installer');

var _teen_process = require('teen_process');

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

_chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

describe('downloading WAD', function () {
  before(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.prev = 0;
          context$2$0.next = 3;
          return _regeneratorRuntime.awrap((0, _teen_process.exec)('msiexec', ['/X{' + _libInstaller.WAD_GUID + '}', '/q']));

        case 3:
          context$2$0.next = 10;
          break;

        case 5:
          context$2$0.prev = 5;
          context$2$0.t0 = context$2$0['catch'](0);

          // if we get a 1605 error, that's ok, that means nothing was installed
          // if we get some other kind of error, we should fail this test
          if (context$2$0.t0.code === 1603) {
            console.log("You need to be an admin to run this test");
          }

          if (!(context$2$0.t0.code !== 1605)) {
            context$2$0.next = 10;
            break;
          }

          throw context$2$0.t0;

        case 10:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this, [[0, 5]]);
  });

  it('should download and validate WinAppDriver', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap((0, _libInstaller.setupWAD)());

        case 2:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
});

// uninstall WAD first
// contains its own verification of md5 so not much to do
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZTJlL2luc3RhbGxlci1lMmUtc3BlY3MuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs0QkFFbUMscUJBQXFCOzs0QkFDbkMsY0FBYzs7b0JBQ2xCLE1BQU07Ozs7OEJBQ0ksa0JBQWtCOzs7O0FBRTdDLGtCQUFLLE1BQU0sRUFBRSxDQUFDO0FBQ2Qsa0JBQUssR0FBRyw2QkFBZ0IsQ0FBQzs7QUFFekIsUUFBUSxDQUFDLGlCQUFpQixFQUFFLFlBQU07QUFDaEMsUUFBTSxDQUFDOzs7Ozs7MkNBR0csd0JBQUssU0FBUyxFQUFFLHVDQUFvQixJQUFJLENBQUMsQ0FBQzs7Ozs7Ozs7Ozs7O0FBSWhELGNBQUksZUFBSSxJQUFJLEtBQUssSUFBSSxFQUFFO0FBQ3JCLG1CQUFPLENBQUMsR0FBRyxDQUFDLDBDQUEwQyxDQUFDLENBQUM7V0FDekQ7O2dCQUNHLGVBQUksSUFBSSxLQUFLLElBQUksQ0FBQTs7Ozs7Ozs7Ozs7O0dBSXhCLENBQUMsQ0FBQzs7QUFFSCxJQUFFLENBQUMsMkNBQTJDLEVBQUU7Ozs7OzJDQUN4Qyw2QkFBVTs7Ozs7OztHQUNqQixDQUFDLENBQUM7Q0FDSixDQUFDLENBQUMiLCJmaWxlIjoidGVzdC9lMmUvaW5zdGFsbGVyLWUyZS1zcGVjcy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIG5vLWNvbnNvbGUgKi9cblxuaW1wb3J0IHsgc2V0dXBXQUQsIFdBRF9HVUlEIH0gZnJvbSAnLi4vLi4vbGliL2luc3RhbGxlcic7XG5pbXBvcnQgeyBleGVjIH0gZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCBjaGFpIGZyb20gJ2NoYWknO1xuaW1wb3J0IGNoYWlBc1Byb21pc2VkIGZyb20gJ2NoYWktYXMtcHJvbWlzZWQnO1xuXG5jaGFpLnNob3VsZCgpO1xuY2hhaS51c2UoY2hhaUFzUHJvbWlzZWQpO1xuXG5kZXNjcmliZSgnZG93bmxvYWRpbmcgV0FEJywgKCkgPT4ge1xuICBiZWZvcmUoYXN5bmMgKCkgPT4ge1xuICAgIC8vIHVuaW5zdGFsbCBXQUQgZmlyc3RcbiAgICB0cnkge1xuICAgICAgYXdhaXQgZXhlYygnbXNpZXhlYycsIFtgL1h7JHtXQURfR1VJRH19YCwgJy9xJ10pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgLy8gaWYgd2UgZ2V0IGEgMTYwNSBlcnJvciwgdGhhdCdzIG9rLCB0aGF0IG1lYW5zIG5vdGhpbmcgd2FzIGluc3RhbGxlZFxuICAgICAgLy8gaWYgd2UgZ2V0IHNvbWUgb3RoZXIga2luZCBvZiBlcnJvciwgd2Ugc2hvdWxkIGZhaWwgdGhpcyB0ZXN0XG4gICAgICBpZiAoZXJyLmNvZGUgPT09IDE2MDMpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJZb3UgbmVlZCB0byBiZSBhbiBhZG1pbiB0byBydW4gdGhpcyB0ZXN0XCIpO1xuICAgICAgfVxuICAgICAgaWYgKGVyci5jb2RlICE9PSAxNjA1KSB7XG4gICAgICAgIHRocm93IGVycjtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgZG93bmxvYWQgYW5kIHZhbGlkYXRlIFdpbkFwcERyaXZlcicsIGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBzZXR1cFdBRCgpOyAvLyBjb250YWlucyBpdHMgb3duIHZlcmlmaWNhdGlvbiBvZiBtZDUgc28gbm90IG11Y2ggdG8gZG9cbiAgfSk7XG59KTsiXSwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
