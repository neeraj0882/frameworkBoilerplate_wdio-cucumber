'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _Object$assign = require('babel-runtime/core-js/object/assign')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

Object.defineProperty(exports, '__esModule', {
  value: true
});

var _appiumBaseDriver = require('appium-base-driver');

var _logger = require('../logger');

var _logger2 = _interopRequireDefault(_logger);

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var GET = 'GET';
var POST = 'POST';
var DELETE = 'DELETE';
var SUPPORTED_METHODS = [GET, POST, DELETE];

var helpers = {},
    extensions = {};

var WDA_ROUTES = {
  '/wda/touch/perform': {
    POST: 'performTouch'
  },
  '/wda/touch/multi/perform': {
    POST: 'performMultiAction'
  },
  '/wda/screen': {
    GET: 'getScreenInfo'
  },
  '/wda/alert/buttons': {
    GET: 'getAlertButtons'
  },
  '/wda/apps/launch': {
    POST: 'mobileLaunchApp'
  },
  '/wda/apps/terminate': {
    POST: 'mobileTerminateApp'
  },
  '/wda/apps/activate': {
    POST: 'mobileActivateApp'
  },
  '/wda/apps/state': {
    POST: 'mobileQueryAppState'
  },
  '/wda/keys': {
    POST: 'keys'
  },
  '/wda/touch_id': {
    POST: 'touchId'
  },
  '/wda/keyboard/dismiss': {
    POST: 'hideKeyboard'
  },
  '/wda/lock': {
    POST: 'lock'
  },
  '/wda/unlock': {
    POST: 'unlock'
  },
  '/wda/locked': {
    GET: 'isLocked'
  },
  '/wda/tap/nil': {
    POST: 'clickCoords'
  },
  '/window/size': {
    GET: 'getWindowSize'
  }
};

function wdaRouteToCommandName(endpoint, method) {
  return WDA_ROUTES[endpoint] ? WDA_ROUTES[endpoint][method] : null;
}

helpers.proxyCommand = function callee$0$0(endpoint, method, body) {
  var isSessionCommand = arguments.length <= 3 || arguments[3] === undefined ? true : arguments[3];
  var proxy, cmdName, timeout, res, isCommandExpired, errMsg;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        if (!this.shutdownUnexpectedly) {
          context$1$0.next = 2;
          break;
        }

        return context$1$0.abrupt('return');

      case 2:

        if (!endpoint) {
          _logger2['default'].errorAndThrow('Proxying requires an endpoint');
        } else if (SUPPORTED_METHODS.indexOf(method) === -1) {
          _logger2['default'].errorAndThrow('Proxying only works for the following requests: ' + SUPPORTED_METHODS.join(', '));
        }

        if (this.wda) {
          context$1$0.next = 5;
          break;
        }

        throw new Error('Cannot call proxyCommand without WDA driver active');

      case 5:
        proxy = isSessionCommand ? this.wda.jwproxy : this.wda.noSessionProxy;

        if (proxy) {
          context$1$0.next = 8;
          break;
        }

        throw new Error('Cannot call proxyCommand without WDA proxy active');

      case 8:
        cmdName = wdaRouteToCommandName(endpoint, method) || (0, _appiumBaseDriver.routeToCommandName)(endpoint, method);
        timeout = this._getCommandTimeout(cmdName);

        if (!cmdName) {
          // this should never happen except when adding new routes
          cmdName = 'Unknown'; // just for logging purposes below
          _logger2['default'].warn('Proxying to WDA with an unknown route: ' + method + ' ' + endpoint);
        }

        res = null;

        if (!timeout) {
          context$1$0.next = 26;
          break;
        }

        _logger2['default'].debug('Setting custom timeout to ' + timeout + ' ms for \'' + cmdName + '\' command');
        isCommandExpired = false;
        context$1$0.next = 17;
        return _regeneratorRuntime.awrap(_bluebird2['default'].resolve(proxy.command(endpoint, method, body)).timeout(timeout)['catch'](_bluebird2['default'].Promise.TimeoutError, function () {
          isCommandExpired = true;
        }));

      case 17:
        res = context$1$0.sent;

        if (!isCommandExpired) {
          context$1$0.next = 24;
          break;
        }

        proxy.cancelActiveRequests();
        errMsg = 'Appium did not get any response from \'' + cmdName + '\' command in ' + timeout + ' ms';
        context$1$0.next = 23;
        return _regeneratorRuntime.awrap(this.startUnexpectedShutdown(new _appiumBaseDriver.errors.TimeoutError(errMsg)));

      case 23:
        _logger2['default'].errorAndThrow(errMsg);

      case 24:
        context$1$0.next = 29;
        break;

      case 26:
        context$1$0.next = 28;
        return _regeneratorRuntime.awrap(proxy.command(endpoint, method, body));

      case 28:
        res = context$1$0.sent;

      case 29:
        if (!(res && res.status && parseInt(res.status, 10) !== 0)) {
          context$1$0.next = 31;
          break;
        }

        throw (0, _appiumBaseDriver.errorFromCode)(res.status, res.value);

      case 31:
        return context$1$0.abrupt('return', res);

      case 32:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

_Object$assign(extensions, helpers);
exports.helpers = helpers;
exports['default'] = extensions;

// temporarily handle errors that can be returned
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9wcm94eS1oZWxwZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O2dDQUEwRCxvQkFBb0I7O3NCQUM5RCxXQUFXOzs7O3dCQUNiLFVBQVU7Ozs7QUFHeEIsSUFBTSxHQUFHLEdBQUcsS0FBSyxDQUFDO0FBQ2xCLElBQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQztBQUNwQixJQUFNLE1BQU0sR0FBRyxRQUFRLENBQUM7QUFDeEIsSUFBTSxpQkFBaUIsR0FBRyxDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7O0FBRTlDLElBQUksT0FBTyxHQUFHLEVBQUU7SUFBRSxVQUFVLEdBQUcsRUFBRSxDQUFDOztBQUVsQyxJQUFNLFVBQVUsR0FBRztBQUNqQixzQkFBb0IsRUFBRTtBQUNwQixRQUFJLEVBQUUsY0FBYztHQUNyQjtBQUNELDRCQUEwQixFQUFFO0FBQzFCLFFBQUksRUFBRSxvQkFBb0I7R0FDM0I7QUFDRCxlQUFhLEVBQUU7QUFDYixPQUFHLEVBQUUsZUFBZTtHQUNyQjtBQUNELHNCQUFvQixFQUFFO0FBQ3BCLE9BQUcsRUFBRSxpQkFBaUI7R0FDdkI7QUFDRCxvQkFBa0IsRUFBRTtBQUNsQixRQUFJLEVBQUUsaUJBQWlCO0dBQ3hCO0FBQ0QsdUJBQXFCLEVBQUU7QUFDckIsUUFBSSxFQUFFLG9CQUFvQjtHQUMzQjtBQUNELHNCQUFvQixFQUFFO0FBQ3BCLFFBQUksRUFBRSxtQkFBbUI7R0FDMUI7QUFDRCxtQkFBaUIsRUFBRTtBQUNqQixRQUFJLEVBQUUscUJBQXFCO0dBQzVCO0FBQ0QsYUFBVyxFQUFFO0FBQ1gsUUFBSSxFQUFFLE1BQU07R0FDYjtBQUNELGlCQUFlLEVBQUU7QUFDZixRQUFJLEVBQUUsU0FBUztHQUNoQjtBQUNELHlCQUF1QixFQUFFO0FBQ3ZCLFFBQUksRUFBRSxjQUFjO0dBQ3JCO0FBQ0QsYUFBVyxFQUFFO0FBQ1gsUUFBSSxFQUFFLE1BQU07R0FDYjtBQUNELGVB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LENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxLQUFLLENBQUM7Ozs0Q0FHckMsR0FBRzs7Ozs7OztDQUNYLENBQUM7O0FBRUYsZUFBYyxVQUFVLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDMUIsT0FBTyxHQUFQLE9BQU87cUJBQ0QsVUFBVSIsImZpbGUiOiJsaWIvY29tbWFuZHMvcHJveHktaGVscGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXJyb3JGcm9tQ29kZSwgZXJyb3JzLCByb3V0ZVRvQ29tbWFuZE5hbWUgfSBmcm9tICdhcHBpdW0tYmFzZS1kcml2ZXInO1xuaW1wb3J0IGxvZyBmcm9tICcuLi9sb2dnZXInO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuXG5cbmNvbnN0IEdFVCA9ICdHRVQnO1xuY29uc3QgUE9TVCA9ICdQT1NUJztcbmNvbnN0IERFTEVURSA9ICdERUxFVEUnO1xuY29uc3QgU1VQUE9SVEVEX01FVEhPRFMgPSBbR0VULCBQT1NULCBERUxFVEVdO1xuXG5sZXQgaGVscGVycyA9IHt9LCBleHRlbnNpb25zID0ge307XG5cbmNvbnN0IFdEQV9ST1VURVMgPSB7XG4gICcvd2RhL3RvdWNoL3BlcmZvcm0nOiB7XG4gICAgUE9TVDogJ3BlcmZvcm1Ub3VjaCcsXG4gIH0sXG4gICcvd2RhL3RvdWNoL211bHRpL3BlcmZvcm0nOiB7XG4gICAgUE9TVDogJ3BlcmZvcm1NdWx0aUFjdGlvbicsXG4gIH0sXG4gICcvd2RhL3NjcmVlbic6IHtcbiAgICBHRVQ6ICdnZXRTY3JlZW5JbmZvJyxcbiAgfSxcbiAgJy93ZGEvYWxlcnQvYnV0dG9ucyc6IHtcbiAgICBHRVQ6ICdnZXRBbGVydEJ1dHRvbnMnLFxuICB9LFxuICAnL3dkYS9hcHBzL2xhdW5jaCc6IHtcbiAgICBQT1NUOiAnbW9iaWxlTGF1bmNoQXBwJyxcbiAgfSxcbiAgJy93ZGEvYXBwcy90ZXJtaW5hdGUnOiB7XG4gICAgUE9TVDogJ21vYmlsZVRlcm1pbmF0ZUFwcCcsXG4gIH0sXG4gICcvd2RhL2FwcHMvYWN0aXZhdGUnOiB7XG4gICAgUE9TVDogJ21vYmlsZUFjdGl2YXRlQXBwJyxcbiAgfSxcbiAgJy93ZGEvYXBwcy9zdGF0ZSc6IHtcbiAgICBQT1NUOiAnbW9iaWxlUXVlcnlBcHBTdGF0ZScsXG4gIH0sXG4gICcvd2RhL2tleXMnOiB7XG4gICAgUE9TVDogJ2tleXMnLFxuICB9LFxuICAnL3dkYS90b3VjaF9pZCc6IHtcbiAgICBQT1NUOiAndG91Y2hJZCcsXG4gIH0sXG4gICcvd2RhL2tleWJvYXJkL2Rpc21pc3MnOiB7XG4gICAgUE9TVDogJ2hpZGVLZXlib2FyZCcsXG4gIH0sXG4gICcvd2RhL2xvY2snOiB7XG4gICAgUE9TVDogJ2xvY2snLFxuICB9LFxuICAnL3dkYS91bmxvY2snOiB7XG4gICAgUE9TVDogJ3VubG9jaycsXG4gIH0sXG4gICcvd2RhL2xvY2tlZCc6IHtcbiAgICBHRVQ6ICdpc0xvY2tlZCcsXG4gIH0sXG4gICcvd2RhL3RhcC9uaWwnOiB7XG4gICAgUE9TVDogJ2NsaWNrQ29vcmRzJyxcbiAgfSxcbiAgJy93aW5kb3cvc2l6ZSc6IHtcbiAgICBHRVQ6ICdnZXRXaW5kb3dTaXplJyxcbiAgfSxcbn07XG5cbmZ1bmN0aW9uIHdkYVJvdXRlVG9Db21tYW5kTmFtZSAoZW5kcG9pbnQsIG1ldGhvZCkge1xuICByZXR1cm4gV0RBX1JPVVRFU1tlbmRwb2ludF0gPyBXREFfUk9VVEVTW2VuZHBvaW50XVttZXRob2RdIDogbnVsbDtcbn1cblxuaGVscGVycy5wcm94eUNvbW1hbmQgPSBhc3luYyBmdW5jdGlvbiAoZW5kcG9pbnQsIG1ldGhvZCwgYm9keSwgaXNTZXNzaW9uQ29tbWFuZCA9IHRydWUpIHtcbiAgaWYgKHRoaXMuc2h1dGRvd25VbmV4cGVjdGVkbHkpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAoIWVuZHBvaW50KSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coJ1Byb3h5aW5nIHJlcXVpcmVzIGFuIGVuZHBvaW50Jyk7XG4gIH0gZWxzZSBpZiAoU1VQUE9SVEVEX01FVEhPRFMuaW5kZXhPZihtZXRob2QpID09PSAtMSkge1xuICAgIGxvZy5lcnJvckFuZFRocm93KGBQcm94eWluZyBvbmx5IHdvcmtzIGZvciB0aGUgZm9sbG93aW5nIHJlcXVlc3RzOiAke1NVUFBPUlRFRF9NRVRIT0RTLmpvaW4oJywgJyl9YCk7XG4gIH1cblxuICBpZiAoIXRoaXMud2RhKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgY2FsbCBwcm94eUNvbW1hbmQgd2l0aG91dCBXREEgZHJpdmVyIGFjdGl2ZScpO1xuICB9XG4gIGNvbnN0IHByb3h5ID0gaXNTZXNzaW9uQ29tbWFuZCA/IHRoaXMud2RhLmp3cHJveHkgOiB0aGlzLndkYS5ub1Nlc3Npb25Qcm94eTtcbiAgaWYgKCFwcm94eSkge1xuICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IGNhbGwgcHJveHlDb21tYW5kIHdpdGhvdXQgV0RBIHByb3h5IGFjdGl2ZScpO1xuICB9XG5cbiAgbGV0IGNtZE5hbWUgPSB3ZGFSb3V0ZVRvQ29tbWFuZE5hbWUoZW5kcG9pbnQsIG1ldGhvZCkgfHwgcm91dGVUb0NvbW1hbmROYW1lKGVuZHBvaW50LCBtZXRob2QpO1xuICBjb25zdCB0aW1lb3V0ID0gdGhpcy5fZ2V0Q29tbWFuZFRpbWVvdXQoY21kTmFtZSk7XG4gIGlmICghY21kTmFtZSkge1xuICAgIC8vIHRoaXMgc2hvdWxkIG5ldmVyIGhhcHBlbiBleGNlcHQgd2hlbiBhZGRpbmcgbmV3IHJvdXRlc1xuICAgIGNtZE5hbWUgPSAnVW5rbm93bic7IC8vIGp1c3QgZm9yIGxvZ2dpbmcgcHVycG9zZXMgYmVsb3dcbiAgICBsb2cud2FybihgUHJveHlpbmcgdG8gV0RBIHdpdGggYW4gdW5rbm93biByb3V0ZTogJHttZXRob2R9ICR7ZW5kcG9pbnR9YCk7XG4gIH1cblxuICBsZXQgcmVzID0gbnVsbDtcbiAgaWYgKHRpbWVvdXQpIHtcbiAgICBsb2cuZGVidWcoYFNldHRpbmcgY3VzdG9tIHRpbWVvdXQgdG8gJHt0aW1lb3V0fSBtcyBmb3IgJyR7Y21kTmFtZX0nIGNvbW1hbmRgKTtcbiAgICBsZXQgaXNDb21tYW5kRXhwaXJlZCA9IGZhbHNlO1xuICAgIHJlcyA9IGF3YWl0IEIucmVzb2x2ZShwcm94eS5jb21tYW5kKGVuZHBvaW50LCBtZXRob2QsIGJvZHkpKVxuICAgICAgICAgICAgICAgICAgLnRpbWVvdXQodGltZW91dClcbiAgICAgICAgICAgICAgICAgIC5jYXRjaChCLlByb21pc2UuVGltZW91dEVycm9yLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlzQ29tbWFuZEV4cGlyZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgaWYgKGlzQ29tbWFuZEV4cGlyZWQpIHtcbiAgICAgIHByb3h5LmNhbmNlbEFjdGl2ZVJlcXVlc3RzKCk7XG4gICAgICBjb25zdCBlcnJNc2cgPSBgQXBwaXVtIGRpZCBub3QgZ2V0IGFueSByZXNwb25zZSBmcm9tICcke2NtZE5hbWV9JyBjb21tYW5kIGluICR7dGltZW91dH0gbXNgO1xuICAgICAgYXdhaXQgdGhpcy5zdGFydFVuZXhwZWN0ZWRTaHV0ZG93bihuZXcgZXJyb3JzLlRpbWVvdXRFcnJvcihlcnJNc2cpKTtcbiAgICAgIGxvZy5lcnJvckFuZFRocm93KGVyck1zZyk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHJlcyA9IGF3YWl0IHByb3h5LmNvbW1hbmQoZW5kcG9pbnQsIG1ldGhvZCwgYm9keSk7XG4gIH1cblxuICAvLyB0ZW1wb3JhcmlseSBoYW5kbGUgZXJyb3JzIHRoYXQgY2FuIGJlIHJldHVybmVkXG4gIGlmIChyZXMgJiYgcmVzLnN0YXR1cyAmJiBwYXJzZUludChyZXMuc3RhdHVzLCAxMCkgIT09IDApIHtcbiAgICB0aHJvdyBlcnJvckZyb21Db2RlKHJlcy5zdGF0dXMsIHJlcy52YWx1ZSk7XG4gIH1cblxuICByZXR1cm4gcmVzO1xufTtcblxuT2JqZWN0LmFzc2lnbihleHRlbnNpb25zLCBoZWxwZXJzKTtcbmV4cG9ydCB7IGhlbHBlcnMgfTtcbmV4cG9ydCBkZWZhdWx0IGV4dGVuc2lvbnM7XG4iXSwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
