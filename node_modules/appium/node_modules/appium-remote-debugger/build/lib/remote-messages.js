"use strict";

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

Object.defineProperty(exports, '__esModule', {
  value: true
});
exports['default'] = getRemoteCommand;

var _remoteDebugger = require('./remote-debugger');

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

/*
 * Connection functions
 */

function setConnectionKey(connId) {
  return {
    __argument: {
      WIRConnectionIdentifierKey: connId
    },
    __selector: '_rpc_reportIdentifier:'
  };
}

function connectToApp(connId, appIdKey) {
  return {
    __argument: {
      WIRConnectionIdentifierKey: connId,
      WIRApplicationIdentifierKey: appIdKey
    },
    __selector: '_rpc_forwardGetListing:'
  };
}

function setSenderKey(connId, senderId, appIdKey, pageIdKey) {
  return {
    __argument: {
      WIRApplicationIdentifierKey: appIdKey,
      WIRConnectionIdentifierKey: connId,
      WIRSenderKey: senderId,
      WIRPageIdentifierKey: pageIdKey,
      WIRAutomaticallyPause: false
    },
    __selector: '_rpc_forwardSocketSetup:'
  };
}

/*
 * Action functions
 */

function indicateWebView(connId, appIdKey, pageIdKey, enabled) {
  return {
    __argument: {
      WIRApplicationIdentifierKey: appIdKey,
      WIRIndicateEnabledKey: _lodash2['default'].isUndefined(enabled) ? true : enabled,
      WIRConnectionIdentifierKey: connId,
      WIRPageIdentifierKey: pageIdKey
    },
    __selector: '_rpc_forwardIndicateWebView:'
  };
}

function sendJSCommand(connId, senderId, appIdKey, pageIdKey, debuggerType, js) {
  return command('Runtime.evaluate', { expression: js, returnByValue: true }, appIdKey, connId, senderId, pageIdKey, debuggerType);
}

function callJSFunction(connId, senderId, appIdKey, pageIdKey, debuggerType, objId, fn, args) {
  return command('Runtime.callFunctionOn', { objectId: objId, functionDeclaration: fn, arguments: args, returnByValue: true }, appIdKey, connId, senderId, pageIdKey, debuggerType);
}

function setUrl(connId, senderId, appIdKey, pageIdKey, debuggerType, url) {
  return command('Page.navigate', { url: url }, appIdKey, connId, senderId, pageIdKey, debuggerType);
}

function enablePage(connId, senderId, appIdKey, pageIdKey, debuggerType) {
  return command('Page.enable', {}, appIdKey, connId, senderId, pageIdKey, debuggerType);
}

function startTimeline(connId, senderId, appIdKey, pageIdKey, debuggerType) {
  return command('Timeline.start', {}, appIdKey, connId, senderId, pageIdKey, debuggerType);
}

function stopTimeline(connId, senderId, appIdKey, pageIdKey, debuggerType) {
  return command('Timeline.stop', {}, appIdKey, connId, senderId, pageIdKey, debuggerType);
}

function startConsole(connId, senderId, appIdKey, pageIdKey, debuggerType) {
  return command('Console.enable', {}, appIdKey, connId, senderId, pageIdKey, debuggerType);
}

function stopConsole(connId, senderId, appIdKey, pageIdKey, debuggerType) {
  return command('Console.disable', {}, appIdKey, connId, senderId, pageIdKey, debuggerType);
}

function startNetwork(connId, senderId, appIdKey, pageIdKey, debuggerType) {
  return command('Network.enable', {}, appIdKey, connId, senderId, pageIdKey, debuggerType);
}

function stopNetwork(connId, senderId, appIdKey, pageIdKey, debuggerType) {
  return command('Network.disable', {}, appIdKey, connId, senderId, pageIdKey, debuggerType);
}

/*
 * Internal functions
 */

function command(method, params, appIdKey, connId, senderId, pageIdKey, debuggerType) {
  if (debuggerType !== null && debuggerType === _remoteDebugger.DEBUGGER_TYPES.webkit) {
    return commandWebKit(method, params);
  } else {
    return commandWebInspector(method, params, appIdKey, connId, senderId, pageIdKey);
  }
}

function commandWebInspector(method, params, appIdKey, connId, senderId, pageIdKey) {
  var plist = {
    __argument: {
      WIRApplicationIdentifierKey: appIdKey,
      WIRSocketDataKey: {
        method: method,
        params: {
          objectGroup: 'console',
          includeCommandLineAPI: true,
          doNotPauseOnExceptionsAndMuteConsole: true
        }
      },
      WIRConnectionIdentifierKey: connId,
      WIRSenderKey: senderId,
      WIRPageIdentifierKey: pageIdKey
    },
    __selector: '_rpc_forwardSocketData:'
  };
  if (params) {
    plist.__argument.WIRSocketDataKey.params = _lodash2['default'].extend(plist.__argument.WIRSocketDataKey.params, params);
  }
  return plist;
}

//generate a json request using the webkit protocol
function commandWebKit(method, params) {
  var jsonRequest = {
    method: method,
    params: {
      objectGroup: 'console',
      includeCommandLineAPI: true,
      doNotPauseOnExceptionsAndMuteConsole: true
    }
  };
  if (params) {
    //if there any parameters add them
    jsonRequest.params = _lodash2['default'].extend(jsonRequest.params, params);
  }
  return jsonRequest;
}

function getRemoteCommand(command, opts) {
  var cmd = undefined;

  switch (command) {
    case 'setConnectionKey':
      cmd = setConnectionKey(opts.connId);
      break;
    case 'connectToApp':
      cmd = connectToApp(opts.connId, opts.appIdKey);
      break;
    case 'setSenderKey':
      cmd = setSenderKey(opts.connId, opts.senderId, opts.appIdKey, opts.pageIdKey);
      break;
    case 'indicateWebView':
      cmd = indicateWebView(opts.connId, opts.appIdKey, opts.pageIdKey, opts.enabled);
      break;
    case 'sendJSCommand':
      cmd = sendJSCommand(opts.connId, opts.senderId, opts.appIdKey, opts.pageIdKey, opts.debuggerType, opts.command);
      break;
    case 'callJSFunction':
      cmd = callJSFunction(opts.connId, opts.senderId, opts.appIdKey, opts.pageIdKey, opts.debuggerType, opts.objId, opts.fn, opts.args);
      break;
    case 'setUrl':
      cmd = setUrl(opts.connId, opts.senderId, opts.appIdKey, opts.pageIdKey, opts.debuggerType, opts.url);
      break;
    case 'enablePage':
      cmd = enablePage(opts.connId, opts.senderId, opts.appIdKey, opts.pageIdKey, opts.debuggerType);
      break;
    case 'startTimeline':
      cmd = startTimeline(opts.connId, opts.senderId, opts.appIdKey, opts.pageIdKey, opts.debuggerType);
      break;
    case 'stopTimeline':
      cmd = stopTimeline(opts.connId, opts.senderId, opts.appIdKey, opts.pageIdKey, opts.debuggerType);
      break;
    case 'startConsole':
      cmd = startConsole(opts.connId, opts.senderId, opts.appIdKey, opts.pageIdKey, opts.debuggerType);
      break;
    case 'stopConsole':
      cmd = stopConsole(opts.connId, opts.senderId, opts.appIdKey, opts.pageIdKey, opts.debuggerType);
      break;
    case 'startNetwork':
      cmd = startNetwork(opts.connId, opts.senderId, opts.appIdKey, opts.pageIdKey, opts.debuggerType);
      break;
    case 'stopNetwork':
      cmd = stopNetwork(opts.connId, opts.senderId, opts.appIdKey, opts.pageIdKey, opts.debuggerType);
      break;
    default:
      throw new Error('Unknown command: ' + command);
  }

  return cmd;
}

module.exports = exports['default'];
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9yZW1vdGUtbWVzc2FnZXMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDOzs7Ozs7O3FCQW1LVyxnQkFBZ0I7OzhCQWpLVCxtQkFBbUI7O3NCQUNwQyxRQUFROzs7Ozs7OztBQU10QixTQUFTLGdCQUFnQixDQUFFLE1BQU0sRUFBRTtBQUNqQyxTQUFPO0FBQ0wsY0FBVSxFQUFFO0FBQ1YsZ0NBQTBCLEVBQUUsTUFBTTtLQUNuQztBQUNELGNBQVUsRUFBRyx3QkFBd0I7R0FDdEMsQ0FBQztDQUNIOztBQUVELFNBQVMsWUFBWSxDQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUU7QUFDdkMsU0FBTztBQUNMLGNBQVUsRUFBRTtBQUNWLGdDQUEwQixFQUFFLE1BQU07QUFDbEMsaUNBQTJCLEVBQUUsUUFBUTtLQUN0QztBQUNELGNBQVUsRUFBRyx5QkFBeUI7R0FDdkMsQ0FBQztDQUNIOztBQUVELFNBQVMsWUFBWSxDQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRTtBQUM1RCxTQUFPO0FBQ0wsY0FBVSxFQUFFO0FBQ1YsaUNBQTJCLEVBQUUsUUFBUTtBQUNyQyxnQ0FBMEIsRUFBRSxNQUFNO0FBQ2xDLGtCQUFZLEVBQUUsUUFBUTtBQUN0QiwwQkFBb0IsRUFBRSxTQUFTO0FBQy9CLDJCQUFxQixFQUFFLEtBQUs7S0FDN0I7QUFDRCxjQUFVLEVBQUUsMEJBQTBCO0dBQ3ZDLENBQUM7Q0FDSDs7Ozs7O0FBTUQsU0FBUyxlQUFlLENBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFO0FBQzlELFNBQU87QUFDTCxjQUFVLEVBQUU7QUFDVixpQ0FBMkIsRUFBRSxRQUFRO0FBQ3JDLDJCQUFxQixFQUFFLG9CQUFFLFdBQVcsQ0FBQyxPQUFPLENBQUMsR0FBRyxJQUFJLEdBQUcsT0FBTztBQUM5RCxnQ0FBMEIsRUFBRSxNQUFNO0FBQ2xDLDBCQUFvQixFQUFFLFNBQVM7S0FDaEM7QUFD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RSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7QUFDM0MsWUFBTTtBQUFBLEFBQ1I7QUFDRSxZQUFNLElBQUksS0FBSyx1QkFBcUIsT0FBTyxDQUFHLENBQUM7QUFBQSxHQUNsRDs7QUFFRCxTQUFPLEdBQUcsQ0FBQztDQUNaIiwiZmlsZSI6ImxpYi9yZW1vdGUtbWVzc2FnZXMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuaW1wb3J0IHsgREVCVUdHRVJfVFlQRVMgfSBmcm9tICcuL3JlbW90ZS1kZWJ1Z2dlcic7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuXG4vKlxuICogQ29ubmVjdGlvbiBmdW5jdGlvbnNcbiAqL1xuXG5mdW5jdGlvbiBzZXRDb25uZWN0aW9uS2V5IChjb25uSWQpIHtcbiAgcmV0dXJuIHtcbiAgICBfX2FyZ3VtZW50OiB7XG4gICAgICBXSVJDb25uZWN0aW9uSWRlbnRpZmllcktleTogY29ubklkXG4gICAgfSxcbiAgICBfX3NlbGVjdG9yIDogJ19ycGNfcmVwb3J0SWRlbnRpZmllcjonXG4gIH07XG59XG5cbmZ1bmN0aW9uIGNvbm5lY3RUb0FwcCAoY29ubklkLCBhcHBJZEtleSkge1xuICByZXR1cm4ge1xuICAgIF9fYXJndW1lbnQ6IHtcbiAgICAgIFdJUkNvbm5lY3Rpb25JZGVudGlmaWVyS2V5OiBjb25uSWQsXG4gICAgICBXSVJBcHBsaWNhdGlvbklkZW50aWZpZXJLZXk6IGFwcElkS2V5XG4gICAgfSxcbiAgICBfX3NlbGVjdG9yIDogJ19ycGNfZm9yd2FyZEdldExpc3Rpbmc6J1xuICB9O1xufVxuXG5mdW5jdGlvbiBzZXRTZW5kZXJLZXkgKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXkpIHtcbiAgcmV0dXJuIHtcbiAgICBfX2FyZ3VtZW50OiB7XG4gICAgICBXSVJBcHBsaWNhdGlvbklkZW50aWZpZXJLZXk6IGFwcElkS2V5LFxuICAgICAgV0lSQ29ubmVjdGlvbklkZW50aWZpZXJLZXk6IGNvbm5JZCxcbiAgICAgIFdJUlNlbmRlcktleTogc2VuZGVySWQsXG4gICAgICBXSVJQYWdlSWRlbnRpZmllcktleTogcGFnZUlkS2V5LFxuICAgICAgV0lSQXV0b21hdGljYWxseVBhdXNlOiBmYWxzZVxuICAgIH0sXG4gICAgX19zZWxlY3RvcjogJ19ycGNfZm9yd2FyZFNvY2tldFNldHVwOidcbiAgfTtcbn1cblxuLypcbiAqIEFjdGlvbiBmdW5jdGlvbnNcbiAqL1xuXG5mdW5jdGlvbiBpbmRpY2F0ZVdlYlZpZXcgKGNvbm5JZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgZW5hYmxlZCkge1xuICByZXR1cm4ge1xuICAgIF9fYXJndW1lbnQ6IHtcbiAgICAgIFdJUkFwcGxpY2F0aW9uSWRlbnRpZmllcktleTogYXBwSWRLZXksXG4gICAgICBXSVJJbmRpY2F0ZUVuYWJsZWRLZXk6IF8uaXNVbmRlZmluZWQoZW5hYmxlZCkgPyB0cnVlIDogZW5hYmxlZCxcbiAgICAgIFdJUkNvbm5lY3Rpb25JZGVudGlmaWVyS2V5OiBjb25uSWQsXG4gICAgICBXSVJQYWdlSWRlbnRpZmllcktleTogcGFnZUlkS2V5XG4gICAgfSxcbiAgICBfX3NlbGVjdG9yOiAnX3JwY19mb3J3YXJkSW5kaWNhdGVXZWJWaWV3OidcbiAgfTtcbn1cblxuZnVuY3Rpb24gc2VuZEpTQ29tbWFuZCAoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgZGVidWdnZXJUeXBlLCBqcykge1xuICByZXR1cm4gY29tbWFuZCgnUnVudGltZS5ldmFsdWF0ZScsXG4gICAgICB7ZXhwcmVzc2lvbjoganMsIHJldHVybkJ5VmFsdWU6IHRydWV9LCBhcHBJZEtleSwgY29ubklkLCBzZW5kZXJJZCwgcGFnZUlkS2V5LCBkZWJ1Z2dlclR5cGUpO1xufVxuXG5mdW5jdGlvbiBjYWxsSlNGdW5jdGlvbiAoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgZGVidWdnZXJUeXBlLCBvYmpJZCwgZm4sIGFyZ3MpIHtcbiAgcmV0dXJuIGNvbW1hbmQoJ1J1bnRpbWUuY2FsbEZ1bmN0aW9uT24nLFxuICAgICAge29iamVjdElkOiBvYmpJZCwgZnVuY3Rpb25EZWNsYXJhdGlvbjogZm4sIGFyZ3VtZW50czogYXJncywgcmV0dXJuQnlWYWx1ZTogdHJ1ZX0sXG4gICAgICBhcHBJZEtleSwgY29ubklkLCBzZW5kZXJJZCwgcGFnZUlkS2V5LCBkZWJ1Z2dlclR5cGUpO1xufVxuXG5mdW5jdGlvbiBzZXRVcmwgKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIGRlYnVnZ2VyVHlwZSwgdXJsKSB7XG4gIHJldHVybiBjb21tYW5kKCdQYWdlLm5hdmlnYXRlJywge3VybH0sIGFwcElkS2V5LCBjb25uSWQsXG4gICAgICBzZW5kZXJJZCwgcGFnZUlkS2V5LCBkZWJ1Z2dlclR5cGUpO1xufVxuXG5mdW5jdGlvbiBlbmFibGVQYWdlIChjb25uSWQsIHNlbmRlcklkLCBhcHBJZEtleSwgcGFnZUlkS2V5LCBkZWJ1Z2dlclR5cGUpIHtcbiAgcmV0dXJuIGNvbW1hbmQoJ1BhZ2UuZW5hYmxlJywge30sIGFwcElkS2V5LCBjb25uSWQsIHNlbmRlcklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VJZEtleSwgZGVidWdnZXJUeXBlKTtcbn1cblxuZnVuY3Rpb24gc3RhcnRUaW1lbGluZSAoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgZGVidWdnZXJUeXBlKSB7XG4gIHJldHVybiBjb21tYW5kKCdUaW1lbGluZS5zdGFydCcsIHt9LCBhcHBJZEtleSwgY29ubklkLCBzZW5kZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICBwYWdlSWRLZXksIGRlYnVnZ2VyVHlwZSk7XG59XG5cbmZ1bmN0aW9uIHN0b3BUaW1lbGluZSAoY29ubklkLCBzZW5kZXJJZCwgYXBwSWRLZXksIHBhZ2VJZEtleSwgZGVidWdnZXJUeXBlKSB7XG4gIHJldHVybiBjb21tYW5kKCdUaW1lbGluZS5zdG9wJywge30sIGFwcElkS2V5LCBjb25uSWQsIHNlbmRlcklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VJZEtleSwgZGVidWdnZXJUeXBlKTtcbn1cblxuZnVuY3Rpb24gc3RhcnRDb25zb2xlIChjb25uSWQsIHNlbmRlcklkLCBhcHBJZEtleSwgcGFnZUlkS2V5LCBkZWJ1Z2dlclR5cGUpIHtcbiAgcmV0dXJuIGNvbW1hbmQoJ0NvbnNvbGUuZW5hYmxlJywge30sIGFwcElkS2V5LCBjb25uSWQsIHNlbmRlcklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VJZEtleSwgZGVidWdnZXJUeXBlKTtcbn1cblxuZnVuY3Rpb24gc3RvcENvbnNvbGUgKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIGRlYnVnZ2VyVHlwZSkge1xuICByZXR1cm4gY29tbWFuZCgnQ29uc29sZS5kaXNhYmxlJywge30sIGFwcElkS2V5LCBjb25uSWQsIHNlbmRlcklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VJZEtleSwgZGVidWdnZXJUeXBlKTtcbn1cblxuZnVuY3Rpb24gc3RhcnROZXR3b3JrIChjb25uSWQsIHNlbmRlcklkLCBhcHBJZEtleSwgcGFnZUlkS2V5LCBkZWJ1Z2dlclR5cGUpIHtcbiAgcmV0dXJuIGNvbW1hbmQoJ05ldHdvcmsuZW5hYmxlJywge30sIGFwcElkS2V5LCBjb25uSWQsIHNlbmRlcklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VJZEtleSwgZGVidWdnZXJUeXBlKTtcbn1cblxuZnVuY3Rpb24gc3RvcE5ldHdvcmsgKGNvbm5JZCwgc2VuZGVySWQsIGFwcElkS2V5LCBwYWdlSWRLZXksIGRlYnVnZ2VyVHlwZSkge1xuICByZXR1cm4gY29tbWFuZCgnTmV0d29yay5kaXNhYmxlJywge30sIGFwcElkS2V5LCBjb25uSWQsIHNlbmRlcklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VJZEtleSwgZGVidWdnZXJUeXBlKTtcbn1cblxuXG4vKlxuICogSW50ZXJuYWwgZnVuY3Rpb25zXG4gKi9cblxuZnVuY3Rpb24gY29tbWFuZCAobWV0aG9kLCBwYXJhbXMsIGFwcElkS2V5LCBjb25uSWQsIHNlbmRlcklkLCBwYWdlSWRLZXksIGRlYnVnZ2VyVHlwZSkge1xuICBpZiAoZGVidWdnZXJUeXBlICE9PSBudWxsICYmIGRlYnVnZ2VyVHlwZSA9PT0gREVCVUdHRVJfVFlQRVMud2Via2l0KSB7XG4gICAgcmV0dXJuIGNvbW1hbmRXZWJLaXQobWV0aG9kLCBwYXJhbXMpO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBjb21tYW5kV2ViSW5zcGVjdG9yKG1ldGhvZCwgcGFyYW1zLCBhcHBJZEtleSwgY29ubklkLCBzZW5kZXJJZCwgcGFnZUlkS2V5KTtcbiAgfVxufVxuXG5mdW5jdGlvbiBjb21tYW5kV2ViSW5zcGVjdG9yIChtZXRob2QsIHBhcmFtcywgYXBwSWRLZXksIGNvbm5JZCwgc2VuZGVySWQsIHBhZ2VJZEtleSkge1xuICBsZXQgcGxpc3QgPSB7XG4gICAgX19hcmd1bWVudDoge1xuICAgICAgV0lSQXBwbGljYXRpb25JZGVudGlmaWVyS2V5OiBhcHBJZEtleSxcbiAgICAgIFdJUlNvY2tldERhdGFLZXk6IHtcbiAgICAgICAgbWV0aG9kLFxuICAgICAgICBwYXJhbXM6IHtcbiAgICAgICAgICBvYmplY3RHcm91cDogJ2NvbnNvbGUnLFxuICAgICAgICAgIGluY2x1ZGVDb21tYW5kTGluZUFQSTogdHJ1ZSxcbiAgICAgICAgICBkb05vdFBhdXNlT25FeGNlcHRpb25zQW5kTXV0ZUNvbnNvbGU6IHRydWUsXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBXSVJDb25uZWN0aW9uSWRlbnRpZmllcktleTogY29ubklkLFxuICAgICAgV0lSU2VuZGVyS2V5OiBzZW5kZXJJZCxcbiAgICAgIFdJUlBhZ2VJZGVudGlmaWVyS2V5OiBwYWdlSWRLZXlcbiAgICB9LFxuICAgIF9fc2VsZWN0b3I6ICdfcnBjX2ZvcndhcmRTb2NrZXREYXRhOidcbiAgfTtcbiAgaWYgKHBhcmFtcykge1xuICAgIHBsaXN0Ll9fYXJndW1lbnQuV0lSU29ja2V0RGF0YUtleS5wYXJhbXMgPVxuICAgICAgXy5leHRlbmQocGxpc3QuX19hcmd1bWVudC5XSVJTb2NrZXREYXRhS2V5LnBhcmFtcywgcGFyYW1zKTtcbiAgfVxuICByZXR1cm4gcGxpc3Q7XG59XG5cbi8vZ2VuZXJhdGUgYSBqc29uIHJlcXVlc3QgdXNpbmcgdGhlIHdlYmtpdCBwcm90b2NvbFxuZnVuY3Rpb24gY29tbWFuZFdlYktpdCAobWV0aG9kLCBwYXJhbXMpIHtcbiAgbGV0IGpzb25SZXF1ZXN0ID0ge1xuICAgIG1ldGhvZCxcbiAgICBwYXJhbXM6IHtcbiAgICAgIG9iamVjdEdyb3VwOiAnY29uc29sZScsXG4gICAgICBpbmNsdWRlQ29tbWFuZExpbmVBUEk6IHRydWUsXG4gICAgICBkb05vdFBhdXNlT25FeGNlcHRpb25zQW5kTXV0ZUNvbnNvbGU6IHRydWVcbiAgICB9XG4gIH07XG4gIGlmIChwYXJhbXMpIHtcbiAgICAvL2lmIHRoZXJlIGFueSBwYXJhbWV0ZXJzIGFkZCB0aGVtXG4gICAganNvblJlcXVlc3QucGFyYW1zID0gXy5leHRlbmQoanNvblJlcXVlc3QucGFyYW1zLCBwYXJhbXMpO1xuICB9XG4gIHJldHVybiBqc29uUmVxdWVzdDtcbn1cblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gZ2V0UmVtb3RlQ29tbWFuZCAoY29tbWFuZCwgb3B0cykge1xuICBsZXQgY21kO1xuXG4gIHN3aXRjaCAoY29tbWFuZCkge1xuICAgIGNhc2UgJ3NldENvbm5lY3Rpb25LZXknOlxuICAgICAgY21kID0gc2V0Q29ubmVjdGlvbktleShvcHRzLmNvbm5JZCk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdjb25uZWN0VG9BcHAnOlxuICAgICAgY21kID0gY29ubmVjdFRvQXBwKG9wdHMuY29ubklkLCBvcHRzLmFwcElkS2V5KTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ3NldFNlbmRlcktleSc6XG4gICAgICBjbWQgPSBzZXRTZW5kZXJLZXkob3B0cy5jb25uSWQsIG9wdHMuc2VuZGVySWQsIG9wdHMuYXBwSWRLZXksXG4gICAgICAgICAgICAgIG9wdHMucGFnZUlkS2V5KTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ2luZGljYXRlV2ViVmlldyc6XG4gICAgICBjbWQgPSBpbmRpY2F0ZVdlYlZpZXcob3B0cy5jb25uSWQsIG9wdHMuYXBwSWRLZXksIG9wdHMucGFnZUlkS2V5LFxuICAgICAgICAgICAgICBvcHRzLmVuYWJsZWQpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnc2VuZEpTQ29tbWFuZCc6XG4gICAgICBjbWQgPSBzZW5kSlNDb21tYW5kKG9wdHMuY29ubklkLCBvcHRzLnNlbmRlcklkLCBvcHRzLmFwcElkS2V5LFxuICAgICAgICAgICAgICBvcHRzLnBhZ2VJZEtleSwgb3B0cy5kZWJ1Z2dlclR5cGUsIG9wdHMuY29tbWFuZCk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdjYWxsSlNGdW5jdGlvbic6XG4gICAgICBjbWQgPSBjYWxsSlNGdW5jdGlvbihvcHRzLmNvbm5JZCwgb3B0cy5zZW5kZXJJZCwgb3B0cy5hcHBJZEtleSxcbiAgICAgICAgICAgICAgb3B0cy5wYWdlSWRLZXksIG9wdHMuZGVidWdnZXJUeXBlLCBvcHRzLm9iaklkLCBvcHRzLmZuLFxuICAgICAgICAgICAgICBvcHRzLmFyZ3MpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnc2V0VXJsJzpcbiAgICAgIGNtZCA9IHNldFVybChvcHRzLmNvbm5JZCwgb3B0cy5zZW5kZXJJZCwgb3B0cy5hcHBJZEtleSwgb3B0cy5wYWdlSWRLZXksXG4gICAgICAgICAgICAgIG9wdHMuZGVidWdnZXJUeXBlLCBvcHRzLnVybCk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdlbmFibGVQYWdlJzpcbiAgICAgIGNtZCA9IGVuYWJsZVBhZ2Uob3B0cy5jb25uSWQsIG9wdHMuc2VuZGVySWQsIG9wdHMuYXBwSWRLZXksXG4gICAgICAgICAgICAgIG9wdHMucGFnZUlkS2V5LCBvcHRzLmRlYnVnZ2VyVHlwZSk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdzdGFydFRpbWVsaW5lJzpcbiAgICAgIGNtZCA9IHN0YXJ0VGltZWxpbmUob3B0cy5jb25uSWQsIG9wdHMuc2VuZGVySWQsIG9wdHMuYXBwSWRLZXksXG4gICAgICAgICAgICAgIG9wdHMucGFnZUlkS2V5LCBvcHRzLmRlYnVnZ2VyVHlwZSk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdzdG9wVGltZWxpbmUnOlxuICAgICAgY21kID0gc3RvcFRpbWVsaW5lKG9wdHMuY29ubklkLCBvcHRzLnNlbmRlcklkLCBvcHRzLmFwcElkS2V5LFxuICAgICAgICAgICAgICBvcHRzLnBhZ2VJZEtleSwgb3B0cy5kZWJ1Z2dlclR5cGUpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnc3RhcnRDb25zb2xlJzpcbiAgICAgIGNtZCA9IHN0YXJ0Q29uc29sZShvcHRzLmNvbm5JZCwgb3B0cy5zZW5kZXJJZCwgb3B0cy5hcHBJZEtleSxcbiAgICAgICAgICAgICAgb3B0cy5wYWdlSWRLZXksIG9wdHMuZGVidWdnZXJUeXBlKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ3N0b3BDb25zb2xlJzpcbiAgICAgIGNtZCA9IHN0b3BDb25zb2xlKG9wdHMuY29ubklkLCBvcHRzLnNlbmRlcklkLCBvcHRzLmFwcElkS2V5LFxuICAgICAgICAgICAgICBvcHRzLnBhZ2VJZEtleSwgb3B0cy5kZWJ1Z2dlclR5cGUpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnc3RhcnROZXR3b3JrJzpcbiAgICAgIGNtZCA9IHN0YXJ0TmV0d29yayhvcHRzLmNvbm5JZCwgb3B0cy5zZW5kZXJJZCwgb3B0cy5hcHBJZEtleSxcbiAgICAgICAgICAgICAgb3B0cy5wYWdlSWRLZXksIG9wdHMuZGVidWdnZXJUeXBlKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ3N0b3BOZXR3b3JrJzpcbiAgICAgIGNtZCA9IHN0b3BOZXR3b3JrKG9wdHMuY29ubklkLCBvcHRzLnNlbmRlcklkLCBvcHRzLmFwcElkS2V5LFxuICAgICAgICAgICAgICBvcHRzLnBhZ2VJZEtleSwgb3B0cy5kZWJ1Z2dlclR5cGUpO1xuICAgICAgYnJlYWs7XG4gICAgZGVmYXVsdDpcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVW5rbm93biBjb21tYW5kOiAke2NvbW1hbmR9YCk7XG4gIH1cblxuICByZXR1cm4gY21kO1xufVxuIl0sInNvdXJjZVJvb3QiOiIuLi8uLiJ9
