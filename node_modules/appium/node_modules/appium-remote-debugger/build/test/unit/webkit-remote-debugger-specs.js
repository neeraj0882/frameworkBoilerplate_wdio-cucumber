require('source-map-support').install();

'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _indexJs = require('../../index.js');

var _helpersWebkitRemoteDebuggerServer = require('../helpers/webkit-remote-debugger-server');

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

_chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

describe('WebKitRemoteDebugger', function () {
  var wrd = new _indexJs.WebKitRemoteDebugger({ host: 'localhost', port: 1337 });

  describe('websocket methods', function () {
    describe('#connect', function () {
      var server = new _helpersWebkitRemoteDebuggerServer.WebKitRemoteDebuggerServer();
      it('should instantiate an rpc client', function callee$3$0() {
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap(server.start(true));

            case 2:
              context$4$0.next = 4;
              return _regeneratorRuntime.awrap(wrd.connect(1));

            case 4:
              wrd.rpcClient.should.exist;
              context$4$0.next = 7;
              return _regeneratorRuntime.awrap(server.stop());

            case 7:
            case 'end':
              return context$4$0.stop();
          }
        }, null, this);
      });
    });
    describe('#disconnect', function () {
      var server = new _helpersWebkitRemoteDebuggerServer.WebKitRemoteDebuggerServer();
      it('should call close on websocket', function callee$3$0() {
        var spy;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap(server.start(true));

            case 2:
              context$4$0.next = 4;
              return _regeneratorRuntime.awrap(wrd.connect());

            case 4:

              wrd.rpcClient.should.exist;
              spy = _sinon2['default'].spy(wrd.rpcClient, 'disconnect');

              wrd.rpcClient.socket.disconnect = spy;
              wrd.disconnect();
              spy.calledOnce.should.be['true'];

              context$4$0.next = 11;
              return _regeneratorRuntime.awrap(server.stop());

            case 11:
            case 'end':
              return context$4$0.stop();
          }
        }, null, this);
      });
    });
  });
  describe('http methods', function () {
    var server = new _helpersWebkitRemoteDebuggerServer.WebKitRemoteDebuggerServer();
    beforeEach(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(server.start());

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    afterEach(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(server.stop());

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    describe('#pageArrayFromJson', function () {
      var data = [{
        webSocketDebuggerUrl: 'webkit/url/app/42',
        title: 'first page title',
        url: '/path/to/page.html'
      }, {
        webSocketDebuggerUrl: 'webkit/url/app/43',
        title: 'second page title',
        url: '/path/to/other_page.html'
      }];
      beforeEach(function callee$3$0() {
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              server.respondWith(data);

            case 1:
            case 'end':
              return context$4$0.stop();
          }
        }, null, this);
      });

      it('should get a page array', function callee$3$0() {
        var r;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap(wrd.pageArrayFromJson());

            case 2:
              r = context$4$0.sent;

              r.should.be['instanceof'](Array);
              r.should.have.length(2);

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, this);
      });
      it('should correctly map webSocketDebuggerUrl to id', function callee$3$0() {
        var r;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap(wrd.pageArrayFromJson());

            case 2:
              r = context$4$0.sent;

              _lodash2['default'].map(r, 'id').should.eql(['42', '43']);

            case 4:
            case 'end':
              return context$4$0.stop();
          }
        }, null, this);
      });
    });
    describe('#getJsonFromUrl', function () {
      it('should get an object', function callee$3$0() {
        var r;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              server.respondWith({ id: 42, type: 'fake' });

              context$4$0.next = 3;
              return _regeneratorRuntime.awrap(wrd.getJsonFromUrl('localhost', 1337, '/json'));

            case 3:
              r = context$4$0.sent;

              r.should.be.an['instanceof'](Object);
              r.id.should.equal(42);

            case 6:
            case 'end':
              return context$4$0.stop();
          }
        }, null, this);
      });
    });
  });

  describe('utility methods', function () {
    describe('#isConnected', function () {
      it('should return false if there is no rpc client', function () {
        wrd.isConnected().should.be['false'];
      });
      it('should return false if there is an rpc client that is not connected', function () {
        var stub = _sinon2['default'].stub();
        stub.returns(false);
        wrd.rpcClient = {
          isConnected: stub
        };
        wrd.isConnected().should.be['false'];
      });
      it('should return true if there is an rpc client that is connected', function () {
        var stub = _sinon2['default'].stub();
        stub.returns(true);
        wrd.rpcClient = {
          isConnected: stub
        };
        wrd.isConnected().should.be['true'];
      });
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvdW5pdC93ZWJraXQtcmVtb3RlLWRlYnVnZ2VyLXNwZWNzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O3VCQUVxQyxnQkFBZ0I7O2lEQUNWLDBDQUEwQzs7b0JBQ3BFLE1BQU07Ozs7OEJBQ0ksa0JBQWtCOzs7O3NCQUMvQixRQUFROzs7O3FCQUNKLE9BQU87Ozs7QUFFekIsa0JBQUssTUFBTSxFQUFFLENBQUM7QUFDZCxrQkFBSyxHQUFHLDZCQUFnQixDQUFDOztBQUd6QixRQUFRLENBQUMsc0JBQXNCLEVBQUUsWUFBWTtBQUMzQyxNQUFJLEdBQUcsR0FBRyxrQ0FBeUIsRUFBQyxJQUFJLEVBQUUsV0FBVyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUMsQ0FBQyxDQUFDOztBQUVwRSxVQUFRLENBQUMsbUJBQW1CLEVBQUUsWUFBWTtBQUN4QyxZQUFRLENBQUMsVUFBVSxFQUFFLFlBQVk7QUFDL0IsVUFBSSxNQUFNLEdBQUcsbUVBQWdDLENBQUM7QUFDOUMsUUFBRSxDQUFDLGtDQUFrQyxFQUFFOzs7OzsrQ0FDL0IsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUM7Ozs7K0NBQ2xCLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDOzs7QUFDcEIsaUJBQUcsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQzs7K0NBQ3JCLE1BQU0sQ0FBQyxJQUFJLEVBQUU7Ozs7Ozs7T0FDcEIsQ0FBQyxDQUFDO0tBQ0osQ0FBQyxDQUFDO0FBQ0gsWUFBUSxDQUFDLGFBQWEsRUFBRSxZQUFZO0FBQ2xDLFVBQUksTUFBTSxHQUFHLG1FQUFnQyxDQUFDO0FBQzlDLFFBQUUsQ0FBQyxnQ0FBZ0MsRUFBRTtZQUsvQixHQUFHOzs7OzsrQ0FKRCxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQzs7OzsrQ0FDbEIsR0FBRyxDQUFDLE9BQU8sRUFBRTs7OztBQUVuQixpQkFBRyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsS0FBSyxD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T0FDbkMsQ0FBQyxDQUFDO0FBQ0gsUUFBRSxDQUFDLHFFQUFxRSxFQUFFLFlBQVk7QUFDcEYsWUFBSSxJQUFJLEdBQUcsbUJBQU0sSUFBSSxFQUFFLENBQUM7QUFDeEIsWUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUNwQixXQUFHLENBQUMsU0FBUyxHQUFHO0FBQ2QscUJBQVcsRUFBRSxJQUFJO1NBQ2xCLENBQUM7QUFDRixXQUFHLENBQUMsV0FBVyxFQUFFLENBQUMsTUFBTSxDQUFDLEVBQUUsU0FBTSxDQUFDO09BQ25DLENBQUMsQ0FBQztBQUNILFFBQUUsQ0FBQyxnRUFBZ0UsRUFBRSxZQUFZO0FBQy9FLFlBQUksSUFBSSxHQUFHLG1CQUFNLElBQUksRUFBRSxDQUFDO0FBQ3hCLFlBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDbkIsV0FBRyxDQUFDLFNBQVMsR0FBRztBQUNkLHFCQUFXLEVBQUUsSUFBSTtTQUNsQixDQUFDO0FBQ0YsV0FBRyxDQUFDLFdBQVcsRUFBRSxDQUFDLE1BQU0sQ0FBQyxFQUFFLFFBQUssQ0FBQztPQUNsQyxDQUFDLENBQUM7S0FDSixDQUFDLENBQUM7R0FDSixDQUFDLENBQUM7Q0FDSixDQUFDLENBQUMiLCJmaWxlIjoidGVzdC91bml0L3dlYmtpdC1yZW1vdGUtZGVidWdnZXItc3BlY3MuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyB0cmFuc3BpbGU6bW9jaGFcblxuaW1wb3J0IHsgV2ViS2l0UmVtb3RlRGVidWdnZXIgfSBmcm9tICcuLi8uLi9pbmRleC5qcyc7XG5pbXBvcnQgeyBXZWJLaXRSZW1vdGVEZWJ1Z2dlclNlcnZlciB9IGZyb20gJy4uL2hlbHBlcnMvd2Via2l0LXJlbW90ZS1kZWJ1Z2dlci1zZXJ2ZXInO1xuaW1wb3J0IGNoYWkgZnJvbSAnY2hhaSc7XG5pbXBvcnQgY2hhaUFzUHJvbWlzZWQgZnJvbSAnY2hhaS1hcy1wcm9taXNlZCc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHNpbm9uIGZyb20gJ3Npbm9uJztcblxuY2hhaS5zaG91bGQoKTtcbmNoYWkudXNlKGNoYWlBc1Byb21pc2VkKTtcblxuXG5kZXNjcmliZSgnV2ViS2l0UmVtb3RlRGVidWdnZXInLCBmdW5jdGlvbiAoKSB7XG4gIGxldCB3cmQgPSBuZXcgV2ViS2l0UmVtb3RlRGVidWdnZXIoe2hvc3Q6ICdsb2NhbGhvc3QnLCBwb3J0OiAxMzM3fSk7XG5cbiAgZGVzY3JpYmUoJ3dlYnNvY2tldCBtZXRob2RzJywgZnVuY3Rpb24gKCkge1xuICAgIGRlc2NyaWJlKCcjY29ubmVjdCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBzZXJ2ZXIgPSBuZXcgV2ViS2l0UmVtb3RlRGVidWdnZXJTZXJ2ZXIoKTtcbiAgICAgIGl0KCdzaG91bGQgaW5zdGFudGlhdGUgYW4gcnBjIGNsaWVudCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgYXdhaXQgc2VydmVyLnN0YXJ0KHRydWUpO1xuICAgICAgICBhd2FpdCB3cmQuY29ubmVjdCgxKTtcbiAgICAgICAgd3JkLnJwY0NsaWVudC5zaG91bGQuZXhpc3Q7XG4gICAgICAgIGF3YWl0IHNlcnZlci5zdG9wKCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBkZXNjcmliZSgnI2Rpc2Nvbm5lY3QnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBsZXQgc2VydmVyID0gbmV3IFdlYktpdFJlbW90ZURlYnVnZ2VyU2VydmVyKCk7XG4gICAgICBpdCgnc2hvdWxkIGNhbGwgY2xvc2Ugb24gd2Vic29ja2V0JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgICBhd2FpdCBzZXJ2ZXIuc3RhcnQodHJ1ZSk7XG4gICAgICAgIGF3YWl0IHdyZC5jb25uZWN0KCk7XG5cbiAgICAgICAgd3JkLnJwY0NsaWVudC5zaG91bGQuZXhpc3Q7XG4gICAgICAgIGxldCBzcHkgPSBzaW5vbi5zcHkod3JkLnJwY0NsaWVudCwgJ2Rpc2Nvbm5lY3QnKTtcbiAgICAgICAgd3JkLnJwY0NsaWVudC5zb2NrZXQuZGlzY29ubmVjdCA9IHNweTtcbiAgICAgICAgd3JkLmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgc3B5LmNhbGxlZE9uY2Uuc2hvdWxkLmJlLnRydWU7XG5cbiAgICAgICAgYXdhaXQgc2VydmVyLnN0b3AoKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbiAgZGVzY3JpYmUoJ2h0dHAgbWV0aG9kcycsIGZ1bmN0aW9uICgpIHtcbiAgICBsZXQgc2VydmVyID0gbmV3IFdlYktpdFJlbW90ZURlYnVnZ2VyU2VydmVyKCk7XG4gICAgYmVmb3JlRWFjaChhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBhd2FpdCBzZXJ2ZXIuc3RhcnQoKTtcbiAgICB9KTtcbiAgICBhZnRlckVhY2goYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgYXdhaXQgc2VydmVyLnN0b3AoKTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCcjcGFnZUFycmF5RnJvbUpzb24nLCBmdW5jdGlvbiAoKSB7XG4gICAgICBsZXQgZGF0YSA9IFtcbiAgICAgICAge1xuICAgICAgICAgIHdlYlNvY2tldERlYnVnZ2VyVXJsOiAnd2Via2l0L3VybC9hcHAvNDInLFxuICAgICAgICAgIHRpdGxlOiAnZmlyc3QgcGFnZSB0aXRsZScsXG4gICAgICAgICAgdXJsOiAnL3BhdGgvdG8vcGFnZS5odG1sJ1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgd2ViU29ja2V0RGVidWdnZXJVcmw6ICd3ZWJraXQvdXJsL2FwcC80MycsXG4gICAgICAgICAgdGl0bGU6ICdzZWNvbmQgcGFnZSB0aXRsZScsXG4gICAgICAgICAgdXJsOiAnL3BhdGgvdG8vb3RoZXJfcGFnZS5odG1sJ1xuICAgICAgICB9XG4gICAgICBdO1xuICAgICAgYmVmb3JlRWFjaChhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNlcnZlci5yZXNwb25kV2l0aChkYXRhKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIGdldCBhIHBhZ2UgYXJyYXknLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxldCByID0gYXdhaXQgd3JkLnBhZ2VBcnJheUZyb21Kc29uKCk7XG4gICAgICAgIHIuc2hvdWxkLmJlLmluc3RhbmNlb2YoQXJyYXkpO1xuICAgICAgICByLnNob3VsZC5oYXZlLmxlbmd0aCgyKTtcbiAgICAgIH0pO1xuICAgICAgaXQoJ3Nob3VsZCBjb3JyZWN0bHkgbWFwIHdlYlNvY2tldERlYnVnZ2VyVXJsIHRvIGlkJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgICBsZXQgciA9IGF3YWl0IHdyZC5wYWdlQXJyYXlGcm9tSnNvbigpO1xuICAgICAgICBfLm1hcChyLCAnaWQnKS5zaG91bGQuZXFsKFsnNDInLCAnNDMnXSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBkZXNjcmliZSgnI2dldEpzb25Gcm9tVXJsJywgZnVuY3Rpb24gKCkge1xuICAgICAgaXQoJ3Nob3VsZCBnZXQgYW4gb2JqZWN0JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgICBzZXJ2ZXIucmVzcG9uZFdpdGgoe2lkOiA0MiwgdHlwZTogJ2Zha2UnfSk7XG5cbiAgICAgICAgbGV0IHIgPSBhd2FpdCB3cmQuZ2V0SnNvbkZyb21VcmwoJ2xvY2FsaG9zdCcsIDEzMzcsICcvanNvbicpO1xuICAgICAgICByLnNob3VsZC5iZS5hbi5pbnN0YW5jZW9mKE9iamVjdCk7XG4gICAgICAgIHIuaWQuc2hvdWxkLmVxdWFsKDQyKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndXRpbGl0eSBtZXRob2RzJywgZnVuY3Rpb24gKCkge1xuICAgIGRlc2NyaWJlKCcjaXNDb25uZWN0ZWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpdCgnc2hvdWxkIHJldHVybiBmYWxzZSBpZiB0aGVyZSBpcyBubyBycGMgY2xpZW50JywgZnVuY3Rpb24gKCkge1xuICAgICAgICB3cmQuaXNDb25uZWN0ZWQoKS5zaG91bGQuYmUuZmFsc2U7XG4gICAgICB9KTtcbiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGZhbHNlIGlmIHRoZXJlIGlzIGFuIHJwYyBjbGllbnQgdGhhdCBpcyBub3QgY29ubmVjdGVkJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBsZXQgc3R1YiA9IHNpbm9uLnN0dWIoKTtcbiAgICAgICAgc3R1Yi5yZXR1cm5zKGZhbHNlKTtcbiAgICAgICAgd3JkLnJwY0NsaWVudCA9IHtcbiAgICAgICAgICBpc0Nvbm5lY3RlZDogc3R1YlxuICAgICAgICB9O1xuICAgICAgICB3cmQuaXNDb25uZWN0ZWQoKS5zaG91bGQuYmUuZmFsc2U7XG4gICAgICB9KTtcbiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIHRydWUgaWYgdGhlcmUgaXMgYW4gcnBjIGNsaWVudCB0aGF0IGlzIGNvbm5lY3RlZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbGV0IHN0dWIgPSBzaW5vbi5zdHViKCk7XG4gICAgICAgIHN0dWIucmV0dXJucyh0cnVlKTtcbiAgICAgICAgd3JkLnJwY0NsaWVudCA9IHtcbiAgICAgICAgICBpc0Nvbm5lY3RlZDogc3R1YlxuICAgICAgICB9O1xuICAgICAgICB3cmQuaXNDb25uZWN0ZWQoKS5zaG91bGQuYmUudHJ1ZTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIuLi8uLi8uLiJ9
