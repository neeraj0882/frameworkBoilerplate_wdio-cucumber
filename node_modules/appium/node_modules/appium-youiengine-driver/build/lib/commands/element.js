'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

Object.defineProperty(exports, '__esModule', {
  value: true
});

var _appiumBaseDriver = require('appium-base-driver');

var _utils = require('../utils');

var _appiumSupport = require('appium-support');

var commands = {};

commands.getAttribute = function callee$0$0(attribute, el) {
  var commandObject, commandJSON, data, result;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        el = (0, _utils.unwrapEl)(el);

        commandObject = {
          name: 'getAttribute',
          args: ['' + el, '' + attribute]
        };
        commandJSON = JSON.stringify(commandObject);
        context$1$0.next = 5;
        return _regeneratorRuntime.awrap(this.executeSocketCommand(commandJSON));

      case 5:
        data = context$1$0.sent;
        result = undefined;
        context$1$0.prev = 7;

        result = JSON.parse(data);
        context$1$0.next = 14;
        break;

      case 11:
        context$1$0.prev = 11;
        context$1$0.t0 = context$1$0['catch'](7);
        throw new Error("Bad response from getAttribute");

      case 14:
        if (!(result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_STALE_ELEMENT)) {
          context$1$0.next = 16;
          break;
        }

        throw new _appiumBaseDriver.errors.StaleElementReferenceError(result.value);

      case 16:
        if (!(result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_INVALID_SELECTOR)) {
          context$1$0.next = 18;
          break;
        }

        throw new _appiumBaseDriver.errors.InvalidSelectorError(result.value);

      case 18:
        return context$1$0.abrupt('return', result.value);

      case 19:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this, [[7, 11]]);
};

commands.setValue = function callee$0$0(value, el) {
  var commandObject, commandJSON, data, result;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        el = (0, _utils.unwrapEl)(el);

        if (value instanceof Array) {
          value = value.join("");
        }
        if (typeof value !== 'string') {
          value = '' + value;
        }
        value = _appiumSupport.util.escapeSpecialChars(value, "'");
        // de-escape \n so it can be used specially
        value = value.replace(/\\\\n/g, "\\n");

        commandObject = {
          name: 'sendkeys',
          args: ['' + el, '' + value]
        };
        commandJSON = JSON.stringify(commandObject);
        context$1$0.next = 9;
        return _regeneratorRuntime.awrap(this.executeSocketCommand(commandJSON));

      case 9:
        data = context$1$0.sent;
        result = undefined;
        context$1$0.prev = 11;

        result = JSON.parse(data);
        context$1$0.next = 18;
        break;

      case 15:
        context$1$0.prev = 15;
        context$1$0.t0 = context$1$0['catch'](11);
        throw new Error("Bad response from setValue");

      case 18:
        if (!(result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_STALE_ELEMENT)) {
          context$1$0.next = 20;
          break;
        }

        throw new _appiumBaseDriver.errors.StaleElementReferenceError(result.value);

      case 20:
        return context$1$0.abrupt('return', result.value);

      case 21:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this, [[11, 15]]);
};

commands.getText = function callee$0$0(el) {
  var commandObject, commandJSON, data, result;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        el = (0, _utils.unwrapEl)(el);

        commandObject = {
          name: 'getText',
          args: ['' + el]
        };
        commandJSON = JSON.stringify(commandObject);
        context$1$0.next = 5;
        return _regeneratorRuntime.awrap(this.executeSocketCommand(commandJSON));

      case 5:
        data = context$1$0.sent;
        result = undefined;
        context$1$0.prev = 7;

        result = JSON.parse(data);
        context$1$0.next = 14;
        break;

      case 11:
        context$1$0.prev = 11;
        context$1$0.t0 = context$1$0['catch'](7);
        throw new Error("Bad response from getText");

      case 14:
        if (!(result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_STALE_ELEMENT)) {
          context$1$0.next = 16;
          break;
        }

        throw new _appiumBaseDriver.errors.StaleElementReferenceError(result.value);

      case 16:
        return context$1$0.abrupt('return', result.value);

      case 17:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this, [[7, 11]]);
};

commands.elementEnabled = function callee$0$0(el) {
  var commandObject, commandJSON, data, result;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:

        el = (0, _utils.unwrapEl)(el);

        commandObject = {
          name: 'elementEnabled',
          args: ['' + el]
        };
        commandJSON = JSON.stringify(commandObject);
        context$1$0.next = 5;
        return _regeneratorRuntime.awrap(this.executeSocketCommand(commandJSON));

      case 5:
        data = context$1$0.sent;
        result = undefined;
        context$1$0.prev = 7;

        result = JSON.parse(data);
        context$1$0.next = 14;
        break;

      case 11:
        context$1$0.prev = 11;
        context$1$0.t0 = context$1$0['catch'](7);
        throw new Error("Bad response from elementEnabled");

      case 14:
        if (!(result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_UNKNOWN_COMMAND)) {
          context$1$0.next = 18;
          break;
        }

        throw new _appiumBaseDriver.errors.UnknownCommandError(result.value);

      case 18:
        if (!(result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_NO_SUCH_ELEMENT)) {
          context$1$0.next = 20;
          break;
        }

        throw new _appiumBaseDriver.errors.NoSuchElementError(result.value);

      case 20:
        return context$1$0.abrupt('return', result.value);

      case 21:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this, [[7, 11]]);
};

commands.elementSelected = function callee$0$0(el) {
  var commandObject, commandJSON, data, result;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:

        el = (0, _utils.unwrapEl)(el);

        commandObject = {
          name: 'elementSelected',
          args: ['' + el]
        };
        commandJSON = JSON.stringify(commandObject);
        context$1$0.next = 5;
        return _regeneratorRuntime.awrap(this.executeSocketCommand(commandJSON));

      case 5:
        data = context$1$0.sent;
        result = undefined;
        context$1$0.prev = 7;

        result = JSON.parse(data);
        context$1$0.next = 14;
        break;

      case 11:
        context$1$0.prev = 11;
        context$1$0.t0 = context$1$0['catch'](7);
        throw new Error("Bad response from elementSelected");

      case 14:
        if (!(result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_ELEMENT_IS_NOT_SELECTABLE)) {
          context$1$0.next = 18;
          break;
        }

        throw new _appiumBaseDriver.errors.ElementIsNotSelectableError(result.value);

      case 18:
        if (!(result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_NO_SUCH_ELEMENT)) {
          context$1$0.next = 20;
          break;
        }

        throw new _appiumBaseDriver.errors.NoSuchElementError(result.value);

      case 20:
        return context$1$0.abrupt('return', result.value);

      case 21:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this, [[7, 11]]);
};

commands.elementDisplayed = function callee$0$0(el) {
  var commandObject, commandJSON, data, result;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:

        el = (0, _utils.unwrapEl)(el);

        commandObject = {
          name: 'elementDisplayed',
          args: ['' + el]
        };
        commandJSON = JSON.stringify(commandObject);
        context$1$0.next = 5;
        return _regeneratorRuntime.awrap(this.executeSocketCommand(commandJSON));

      case 5:
        data = context$1$0.sent;
        result = undefined;
        context$1$0.prev = 7;

        result = JSON.parse(data);
        context$1$0.next = 14;
        break;

      case 11:
        context$1$0.prev = 11;
        context$1$0.t0 = context$1$0['catch'](7);
        throw new Error("Bad response from elementDisplayed");

      case 14:
        if (!(result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_UNKNOWN_COMMAND)) {
          context$1$0.next = 18;
          break;
        }

        throw new _appiumBaseDriver.errors.UnknownCommandError(result.value);

      case 18:
        if (!(result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_NO_SUCH_ELEMENT)) {
          context$1$0.next = 20;
          break;
        }

        throw new _appiumBaseDriver.errors.NoSuchElementError(result.value);

      case 20:
        return context$1$0.abrupt('return', result.value);

      case 21:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this, [[7, 11]]);
};

commands.clear = function callee$0$0(el) {
  var commandObject, commandJSON, data, result;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        el = (0, _utils.unwrapEl)(el);

        commandObject = {
          name: 'clear',
          args: ['' + el]
        };
        commandJSON = JSON.stringify(commandObject);
        context$1$0.next = 5;
        return _regeneratorRuntime.awrap(this.executeSocketCommand(commandJSON));

      case 5:
        data = context$1$0.sent;
        result = undefined;
        context$1$0.prev = 7;

        result = JSON.parse(data);
        context$1$0.next = 14;
        break;

      case 11:
        context$1$0.prev = 11;
        context$1$0.t0 = context$1$0['catch'](7);
        throw new Error("Bad response from clear");

      case 14:
        if (!(result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_NO_SUCH_ELEMENT)) {
          context$1$0.next = 18;
          break;
        }

        throw new _appiumBaseDriver.errors.NoSuchElementError(result.value);

      case 18:
        if (!(result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_UNKNOWN_COMMAND)) {
          context$1$0.next = 20;
          break;
        }

        throw new _appiumBaseDriver.errors.UnknownCommandError(result.value);

      case 20:
        return context$1$0.abrupt('return', result.value);

      case 21:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this, [[7, 11]]);
};

commands.getLocation = function callee$0$0(el) {
  var commandObject, commandJSON, data, result;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:

        el = (0, _utils.unwrapEl)(el);

        commandObject = {
          name: 'elementLocation',
          args: ['' + el]
        };
        commandJSON = JSON.stringify(commandObject);
        context$1$0.next = 5;
        return _regeneratorRuntime.awrap(this.executeSocketCommand(commandJSON));

      case 5:
        data = context$1$0.sent;
        result = undefined;
        context$1$0.prev = 7;

        result = JSON.parse(data);
        context$1$0.next = 14;
        break;

      case 11:
        context$1$0.prev = 11;
        context$1$0.t0 = context$1$0['catch'](7);
        throw new Error("Bad response from elementLocation");

      case 14:
        if (!(result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_UNKNOWN_COMMAND)) {
          context$1$0.next = 18;
          break;
        }

        throw new _appiumBaseDriver.errors.UnknownCommandError(result.value);

      case 18:
        if (!(result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_NO_SUCH_ELEMENT)) {
          context$1$0.next = 20;
          break;
        }

        throw new _appiumBaseDriver.errors.NoSuchElementError(result.value);

      case 20:
        return context$1$0.abrupt('return', result.value);

      case 21:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this, [[7, 11]]);
};

commands.getLocationInView = function callee$0$0(elementId) {
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        context$1$0.next = 2;
        return _regeneratorRuntime.awrap(this.getLocation(elementId));

      case 2:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 3:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

commands.getSize = function callee$0$0(el) {
  var commandObject, commandJSON, data, result;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:

        el = (0, _utils.unwrapEl)(el);

        commandObject = {
          name: 'elementSize',
          args: ['' + el]
        };
        commandJSON = JSON.stringify(commandObject);
        context$1$0.next = 5;
        return _regeneratorRuntime.awrap(this.executeSocketCommand(commandJSON));

      case 5:
        data = context$1$0.sent;
        result = undefined;
        context$1$0.prev = 7;

        result = JSON.parse(data);
        context$1$0.next = 14;
        break;

      case 11:
        context$1$0.prev = 11;
        context$1$0.t0 = context$1$0['catch'](7);
        throw new Error("Bad response from getSize");

      case 14:
        if (!(result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_UNKNOWN_COMMAND)) {
          context$1$0.next = 18;
          break;
        }

        throw new _appiumBaseDriver.errors.UnknownCommandError(result.value);

      case 18:
        if (!(result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_NO_SUCH_ELEMENT)) {
          context$1$0.next = 20;
          break;
        }

        throw new _appiumBaseDriver.errors.NoSuchElementError(result.value);

      case 20:
        return context$1$0.abrupt('return', result.value);

      case 21:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this, [[7, 11]]);
};

exports['default'] = commands;
module.exports = exports['default'];

// get status returned

// get status returned

// get status returned

// get status returned and handle errors returned from server

// get status returned and handle errors returned from server

// get status returned and handle errors returned from server

// get status returned and handle errors returned from server

// get status returned and handle errors returned from server
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9lbGVtZW50LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O2dDQUF1QixvQkFBb0I7O3FCQUNZLFVBQVU7OzZCQUM1QyxnQkFBZ0I7O0FBRXJDLElBQUksUUFBUSxHQUFHLEVBQUUsQ0FBQzs7QUFFbEIsUUFBUSxDQUFDLFlBQVksR0FBRyxvQkFBZ0IsU0FBUyxFQUFFLEVBQUU7TUFHL0MsYUFBYSxFQUliLFdBQVcsRUFFWCxJQUFJLEVBRUosTUFBTTs7OztBQVZWLFVBQUUsR0FBRyxxQkFBUyxFQUFFLENBQUMsQ0FBQzs7QUFFZCxxQkFBYSxHQUFHO0FBQ2xCLGNBQUksRUFBRSxjQUFjO0FBQ3BCLGNBQUksRUFBRSxNQUFJLEVBQUUsT0FBTyxTQUFTLENBQUc7U0FDaEM7QUFDRyxtQkFBVyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDOzt5Q0FFOUIsSUFBSSxDQUFDLG9CQUFvQixDQUFDLFdBQVcsQ0FBQzs7O0FBQW5ELFlBQUk7QUFFSixjQUFNOzs7QUFFUixjQUFNLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQzs7Ozs7OztjQUVwQixJQUFJLEtBQUssQ0FBQyxnQ0FBZ0MsQ0FBQzs7O2NBSS9DLE1BQU0sQ0FBQyxNQUFNLEtBQUssb0NBQTZCLHVCQUF1QixDQUFBOzs7OztjQUNsRSxJQUFJLHlCQUFPLDBCQUEwQixDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7OztjQUV2RCxNQUFNLENBQUMsTUFBTSxLQUFLLG9DQUE2QiwwQkFBMEIsQ0FBQTs7Ozs7Y0FDckUsSUFBSSx5QkFBTyxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDOzs7NENBRTlDLE1BQU0sQ0FBQyxLQUFLOzs7Ozs7O0NBQ3BCLENBQUM7O0FBRUYsUUFBUSxDQUFDLFFBQVEsR0FBRyxvQkFBZ0IsS0FBSyxFQUFFLEVBQUU7TUFhdkMsYUFBYSxFQUliLFdBQVcsRUFFWCxJQUFJLEVBRUosTUFBTTs7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QVM7Ozs7O3lDQUN2QyxJQUFJLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQzs7Ozs7Ozs7OztDQUN6QyxDQUFDOztBQUVGLFFBQVEsQ0FBQyxPQUFPLEdBQUcsb0JBQWdCLEVBQUU7TUFJL0IsYUFBYSxFQUliLFdBQVcsRUFFWCxJQUFJLEVBRUosTUFBTTs7Ozs7QUFWVixVQUFFLEdBQUcscUJBQVMsRUFBRSxDQUFDLENBQUM7O0FBRWQscUJBQWEsR0FBRztBQUNsQixjQUFJLEVBQUUsYUFBYTtBQUNuQixjQUFJLEVBQUUsTUFBSSxFQUFFLENBQUc7U0FDaEI7QUFDRyxtQkFBVyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDOzt5Q0FFOUIsSUFBSSxDQUFDLG9CQUFvQixDQUFDLFdBQVcsQ0FBQzs7O0FBQW5ELFlBQUk7QUFFSixjQUFNOzs7QUFFUixjQUFNLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQzs7Ozs7OztjQUVwQixJQUFJLEtBQUssQ0FBQywyQkFBMkIsQ0FBQzs7O2NBSTFDLE1BQU0sQ0FBQyxNQUFNLEtBQUssb0NBQTZCLHlCQUF5QixDQUFBOzs7OztjQUNwRSxJQUFJLHlCQUFPLG1CQUFtQixDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7OztjQUN6QyxNQUFNLENBQUMsTUFBTSxLQUFLLG9DQUE2Qix5QkFBeUIsQ0FBQTs7Ozs7Y0FDM0UsSUFBSSx5QkFBTyxrQkFBa0IsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDOzs7NENBRzVDLE1BQU0sQ0FBQyxLQUFLOzs7Ozs7O0NBQ3BCLENBQUM7O3FCQUVhLFFBQVEiLCJmaWxlIjoibGliL2NvbW1hbmRzL2VsZW1lbnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBlcnJvcnMgfSBmcm9tICdhcHBpdW0tYmFzZS1kcml2ZXInO1xuaW1wb3J0IHsgdW53cmFwRWwsIHlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMgfSBmcm9tICcuLi91dGlscyc7XG5pbXBvcnQgeyB1dGlsIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuXG5sZXQgY29tbWFuZHMgPSB7fTtcblxuY29tbWFuZHMuZ2V0QXR0cmlidXRlID0gYXN5bmMgZnVuY3Rpb24gKGF0dHJpYnV0ZSwgZWwpIHtcbiAgZWwgPSB1bndyYXBFbChlbCk7XG5cbiAgdmFyIGNvbW1hbmRPYmplY3QgPSB7XG4gICAgbmFtZTogJ2dldEF0dHJpYnV0ZScsXG4gICAgYXJnczogW2Ake2VsfWAsIGAke2F0dHJpYnV0ZX1gXVxuICB9O1xuICB2YXIgY29tbWFuZEpTT04gPSBKU09OLnN0cmluZ2lmeShjb21tYW5kT2JqZWN0KTtcblxuICBsZXQgZGF0YSA9IGF3YWl0IHRoaXMuZXhlY3V0ZVNvY2tldENvbW1hbmQoY29tbWFuZEpTT04pO1xuXG4gIGxldCByZXN1bHQ7XG4gIHRyeSB7XG4gICAgcmVzdWx0ID0gSlNPTi5wYXJzZShkYXRhKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkJhZCByZXNwb25zZSBmcm9tIGdldEF0dHJpYnV0ZVwiKTtcbiAgfVxuXG4gIC8vIGdldCBzdGF0dXMgcmV0dXJuZWRcbiAgaWYgKHJlc3VsdC5zdGF0dXMgPT09IHlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMuV0VCRFJJVkVSX1NUQUxFX0VMRU1FTlQpXG4gICAgdGhyb3cgbmV3IGVycm9ycy5TdGFsZUVsZW1lbnRSZWZlcmVuY2VFcnJvcihyZXN1bHQudmFsdWUpO1xuXG4gIGlmIChyZXN1bHQuc3RhdHVzID09PSB5b3VpRW5naW5lRHJpdmVyUmV0dXJuVmFsdWVzLldFQkRSSVZFUl9JTlZBTElEX1NFTEVDVE9SKVxuICAgIHRocm93IG5ldyBlcnJvcnMuSW52YWxpZFNlbGVjdG9yRXJyb3IocmVzdWx0LnZhbHVlKTtcblxuICByZXR1cm4gcmVzdWx0LnZhbHVlO1xufTtcblxuY29tbWFuZHMuc2V0VmFsdWUgPSBhc3luYyBmdW5jdGlvbiAodmFsdWUsIGVsKSB7XG4gIGVsID0gdW53cmFwRWwoZWwpO1xuICBcbiAgaWYgKHZhbHVlIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICB2YWx1ZSA9IHZhbHVlLmpvaW4oXCJcIik7XG4gIH1cbiAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ3N0cmluZycpIHtcbiAgICB2YWx1ZSA9IGAke3ZhbHVlfWA7XG4gIH1cbiAgdmFsdWUgPSB1dGlsLmVzY2FwZVNwZWNpYWxDaGFycyh2YWx1ZSwgXCInXCIpO1xuICAvLyBkZS1lc2NhcGUgXFxuIHNvIGl0IGNhbiBiZSB1c2VkIHNwZWNpYWxseVxuICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL1xcXFxcXFxcbi9nLCBcIlxcXFxuXCIpO1xuXG4gIHZhciBjb21tYW5kT2JqZWN0ID0ge1xuICAgIG5hbWU6ICdzZW5ka2V5cycsXG4gICAgYXJnczogW2Ake2VsfWAsIGAke3ZhbHVlfWBdXG4gIH07XG4gIHZhciBjb21tYW5kSlNPTiA9IEpTT04uc3RyaW5naWZ5KGNvbW1hbmRPYmplY3QpO1xuXG4gIGxldCBkYXRhID0gYXdhaXQgdGhpcy5leGVjdXRlU29ja2V0Q29tbWFuZChjb21tYW5kSlNPTik7XG5cbiAgbGV0IHJlc3VsdDtcbiAgdHJ5IHtcbiAgICByZXN1bHQgPSBKU09OLnBhcnNlKGRhdGEpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQmFkIHJlc3BvbnNlIGZyb20gc2V0VmFsdWVcIik7XG4gIH1cblxuICAvLyBnZXQgc3RhdHVzIHJldHVybmVkXG4gIGlmIChyZXN1bHQuc3RhdHVzID09PSB5b3VpRW5naW5lRHJpdmVyUmV0dXJuVmFsdWVzLldFQkRSSVZFUl9TVEFMRV9FTEVNRU5UKVxuICAgIHRocm93IG5ldyBlcnJvcnMuU3RhbGVFbGVtZW50UmVmZXJlbmNlRXJyb3IocmVzdWx0LnZhbHVlKTtcblxuICByZXR1cm4gcmVzdWx0LnZhbHVlO1xuXG59O1xuXG5jb21tYW5kcy5nZXRUZXh0ID0gYXN5bmMgZnVuY3Rpb24gKGVsKSB7XG4gIGVsID0gdW53cmFwRWwoZWwpO1xuXG4gIHZhciBjb21tYW5kT2JqZWN0ID0ge1xuICAgIG5hbWU6ICdnZXRUZXh0JyxcbiAgICBhcmdzOiBbYCR7ZWx9YF1cbiAgfTtcbiAgdmFyIGNvbW1hbmRKU09OID0gSlNPTi5zdHJpbmdpZnkoY29tbWFuZE9iamVjdCk7XG5cbiAgbGV0IGRhdGEgPSBhd2FpdCB0aGlzLmV4ZWN1dGVTb2NrZXRDb21tYW5kKGNvbW1hbmRKU09OKTtcblxuICBsZXQgcmVzdWx0O1xuICB0cnkge1xuICAgIHJlc3VsdCA9IEpTT04ucGFyc2UoZGF0YSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJCYWQgcmVzcG9uc2UgZnJvbSBnZXRUZXh0XCIpO1xuICB9XG5cbiAgLy8gZ2V0IHN0YXR1cyByZXR1cm5lZFxuICBpZiAocmVzdWx0LnN0YXR1cyA9PT0geW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcy5XRUJEUklWRVJfU1RBTEVfRUxFTUVOVClcbiAgICB0aHJvdyBuZXcgZXJyb3JzLlN0YWxlRWxlbWVudFJlZmVyZW5jZUVycm9yKHJlc3VsdC52YWx1ZSk7XG5cbiAgcmV0dXJuIHJlc3VsdC52YWx1ZTtcblxufTtcblxuY29tbWFuZHMuZWxlbWVudEVuYWJsZWQgPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcblxuICBlbCA9IHVud3JhcEVsKGVsKTtcblxuICB2YXIgY29tbWFuZE9iamVjdCA9IHtcbiAgICBuYW1lOiAnZWxlbWVudEVuYWJsZWQnLFxuICAgIGFyZ3M6IFtgJHtlbH1gXVxuICB9O1xuICB2YXIgY29tbWFuZEpTT04gPSBKU09OLnN0cmluZ2lmeShjb21tYW5kT2JqZWN0KTtcblxuICBsZXQgZGF0YSA9IGF3YWl0IHRoaXMuZXhlY3V0ZVNvY2tldENvbW1hbmQoY29tbWFuZEpTT04pO1xuXG4gIGxldCByZXN1bHQ7XG4gIHRyeSB7XG4gICAgcmVzdWx0ID0gSlNPTi5wYXJzZShkYXRhKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkJhZCByZXNwb25zZSBmcm9tIGVsZW1lbnRFbmFibGVkXCIpO1xuICB9XG5cbiAgLy8gZ2V0IHN0YXR1cyByZXR1cm5lZCBhbmQgaGFuZGxlIGVycm9ycyByZXR1cm5lZCBmcm9tIHNlcnZlclxuICBpZiAocmVzdWx0LnN0YXR1cyA9PT0geW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcy5XRUJEUklWRVJfVU5LTk9XTl9DT01NQU5EKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Vbmtub3duQ29tbWFuZEVycm9yKHJlc3VsdC52YWx1ZSk7XG4gIH0gZWxzZSBpZiAocmVzdWx0LnN0YXR1cyA9PT0geW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcy5XRUJEUklWRVJfTk9fU1VDSF9FTEVNRU5UKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob1N1Y2hFbGVtZW50RXJyb3IocmVzdWx0LnZhbHVlKTtcbiAgfVxuXG4gIHJldHVybiByZXN1bHQudmFsdWU7XG59O1xuXG5jb21tYW5kcy5lbGVtZW50U2VsZWN0ZWQgPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcblxuICBlbCA9IHVud3JhcEVsKGVsKTtcblxuICB2YXIgY29tbWFuZE9iamVjdCA9IHtcbiAgICBuYW1lOiAnZWxlbWVudFNlbGVjdGVkJyxcbiAgICBhcmdzOiBbYCR7ZWx9YF1cbiAgfTtcbiAgdmFyIGNvbW1hbmRKU09OID0gSlNPTi5zdHJpbmdpZnkoY29tbWFuZE9iamVjdCk7XG5cbiAgbGV0IGRhdGEgPSBhd2FpdCB0aGlzLmV4ZWN1dGVTb2NrZXRDb21tYW5kKGNvbW1hbmRKU09OKTtcblxuICBsZXQgcmVzdWx0O1xuICB0cnkge1xuICAgIHJlc3VsdCA9IEpTT04ucGFyc2UoZGF0YSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJCYWQgcmVzcG9uc2UgZnJvbSBlbGVtZW50U2VsZWN0ZWRcIik7XG4gIH1cblxuICAvLyBnZXQgc3RhdHVzIHJldHVybmVkIGFuZCBoYW5kbGUgZXJyb3JzIHJldHVybmVkIGZyb20gc2VydmVyXG4gIGlmIChyZXN1bHQuc3RhdHVzID09PSB5b3VpRW5naW5lRHJpdmVyUmV0dXJuVmFsdWVzLldFQkRSSVZFUl9FTEVNRU5UX0lTX05PVF9TRUxFQ1RBQkxFKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5FbGVtZW50SXNOb3RTZWxlY3RhYmxlRXJyb3IocmVzdWx0LnZhbHVlKTtcbiAgfSBlbHNlIGlmIChyZXN1bHQuc3RhdHVzID09PSB5b3VpRW5naW5lRHJpdmVyUmV0dXJuVmFsdWVzLldFQkRSSVZFUl9OT19TVUNIX0VMRU1FTlQpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vU3VjaEVsZW1lbnRFcnJvcihyZXN1bHQudmFsdWUpO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdC52YWx1ZTtcbn07XG5cbmNvbW1hbmRzLmVsZW1lbnREaXNwbGF5ZWQgPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcblxuICBlbCA9IHVud3JhcEVsKGVsKTtcblxuICB2YXIgY29tbWFuZE9iamVjdCA9IHtcbiAgICBuYW1lOiAnZWxlbWVudERpc3BsYXllZCcsXG4gICAgYXJnczogW2Ake2VsfWBdXG4gIH07XG4gIHZhciBjb21tYW5kSlNPTiA9IEpTT04uc3RyaW5naWZ5KGNvbW1hbmRPYmplY3QpO1xuXG4gIGxldCBkYXRhID0gYXdhaXQgdGhpcy5leGVjdXRlU29ja2V0Q29tbWFuZChjb21tYW5kSlNPTik7XG5cbiAgbGV0IHJlc3VsdDtcbiAgdHJ5IHtcbiAgICByZXN1bHQgPSBKU09OLnBhcnNlKGRhdGEpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQmFkIHJlc3BvbnNlIGZyb20gZWxlbWVudERpc3BsYXllZFwiKTtcbiAgfVxuXG4gIC8vIGdldCBzdGF0dXMgcmV0dXJuZWQgYW5kIGhhbmRsZSBlcnJvcnMgcmV0dXJuZWQgZnJvbSBzZXJ2ZXJcbiAgaWYgKHJlc3VsdC5zdGF0dXMgPT09IHlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMuV0VCRFJJVkVSX1VOS05PV05fQ09NTUFORCkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuVW5rbm93bkNvbW1hbmRFcnJvcihyZXN1bHQudmFsdWUpO1xuICB9IGVsc2UgaWYgKHJlc3VsdC5zdGF0dXMgPT09IHlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMuV0VCRFJJVkVSX05PX1NVQ0hfRUxFTUVOVCkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuTm9TdWNoRWxlbWVudEVycm9yKHJlc3VsdC52YWx1ZSk7XG4gIH1cblxuICByZXR1cm4gcmVzdWx0LnZhbHVlO1xufTtcblxuY29tbWFuZHMuY2xlYXIgPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcbiAgZWwgPSB1bndyYXBFbChlbCk7XG5cbiAgdmFyIGNvbW1hbmRPYmplY3QgPSB7XG4gICAgbmFtZTogJ2NsZWFyJyxcbiAgICBhcmdzOiBbYCR7ZWx9YF1cbiAgfTtcblxuICB2YXIgY29tbWFuZEpTT04gPSBKU09OLnN0cmluZ2lmeShjb21tYW5kT2JqZWN0KTtcblxuICBsZXQgZGF0YSA9IGF3YWl0IHRoaXMuZXhlY3V0ZVNvY2tldENvbW1hbmQoY29tbWFuZEpTT04pO1xuXG4gIGxldCByZXN1bHQ7XG4gIHRyeSB7XG4gICAgcmVzdWx0ID0gSlNPTi5wYXJzZShkYXRhKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkJhZCByZXNwb25zZSBmcm9tIGNsZWFyXCIpO1xuICB9XG5cbiAgaWYgKHJlc3VsdC5zdGF0dXMgPT09IHlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMuV0VCRFJJVkVSX05PX1NVQ0hfRUxFTUVOVCkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuTm9TdWNoRWxlbWVudEVycm9yKHJlc3VsdC52YWx1ZSk7XG4gIH0gZWxzZSBpZiAocmVzdWx0LnN0YXR1cyA9PT0geW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcy5XRUJEUklWRVJfVU5LTk9XTl9DT01NQU5EKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Vbmtub3duQ29tbWFuZEVycm9yKHJlc3VsdC52YWx1ZSk7XG4gIH1cblxuICByZXR1cm4gcmVzdWx0LnZhbHVlO1xufTtcblxuY29tbWFuZHMuZ2V0TG9jYXRpb24gPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcblxuICBlbCA9IHVud3JhcEVsKGVsKTtcblxuICB2YXIgY29tbWFuZE9iamVjdCA9IHtcbiAgICBuYW1lOiAnZWxlbWVudExvY2F0aW9uJyxcbiAgICBhcmdzOiBbYCR7ZWx9YF1cbiAgfTtcbiAgdmFyIGNvbW1hbmRKU09OID0gSlNPTi5zdHJpbmdpZnkoY29tbWFuZE9iamVjdCk7XG5cbiAgbGV0IGRhdGEgPSBhd2FpdCB0aGlzLmV4ZWN1dGVTb2NrZXRDb21tYW5kKGNvbW1hbmRKU09OKTtcblxuICBsZXQgcmVzdWx0O1xuICB0cnkge1xuICAgIHJlc3VsdCA9IEpTT04ucGFyc2UoZGF0YSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJCYWQgcmVzcG9uc2UgZnJvbSBlbGVtZW50TG9jYXRpb25cIik7XG4gIH1cblxuICAvLyBnZXQgc3RhdHVzIHJldHVybmVkIGFuZCBoYW5kbGUgZXJyb3JzIHJldHVybmVkIGZyb20gc2VydmVyXG4gIGlmIChyZXN1bHQuc3RhdHVzID09PSB5b3VpRW5naW5lRHJpdmVyUmV0dXJuVmFsdWVzLldFQkRSSVZFUl9VTktOT1dOX0NPTU1BTkQpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLlVua25vd25Db21tYW5kRXJyb3IocmVzdWx0LnZhbHVlKTtcbiAgfSBlbHNlIGlmIChyZXN1bHQuc3RhdHVzID09PSB5b3VpRW5naW5lRHJpdmVyUmV0dXJuVmFsdWVzLldFQkRSSVZFUl9OT19TVUNIX0VMRU1FTlQpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vU3VjaEVsZW1lbnRFcnJvcihyZXN1bHQudmFsdWUpO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdC52YWx1ZTtcbn07XG5cbmNvbW1hbmRzLmdldExvY2F0aW9uSW5WaWV3ID0gYXN5bmMgZnVuY3Rpb24gKGVsZW1lbnRJZCkge1xuICByZXR1cm4gYXdhaXQgdGhpcy5nZXRMb2NhdGlvbihlbGVtZW50SWQpO1xufTtcblxuY29tbWFuZHMuZ2V0U2l6ZSA9IGFzeW5jIGZ1bmN0aW9uIChlbCkge1xuXG4gIGVsID0gdW53cmFwRWwoZWwpO1xuXG4gIHZhciBjb21tYW5kT2JqZWN0ID0ge1xuICAgIG5hbWU6ICdlbGVtZW50U2l6ZScsXG4gICAgYXJnczogW2Ake2VsfWBdXG4gIH07XG4gIHZhciBjb21tYW5kSlNPTiA9IEpTT04uc3RyaW5naWZ5KGNvbW1hbmRPYmplY3QpO1xuXG4gIGxldCBkYXRhID0gYXdhaXQgdGhpcy5leGVjdXRlU29ja2V0Q29tbWFuZChjb21tYW5kSlNPTik7XG5cbiAgbGV0IHJlc3VsdDtcbiAgdHJ5IHtcbiAgICByZXN1bHQgPSBKU09OLnBhcnNlKGRhdGEpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQmFkIHJlc3BvbnNlIGZyb20gZ2V0U2l6ZVwiKTtcbiAgfVxuXG4gIC8vIGdldCBzdGF0dXMgcmV0dXJuZWQgYW5kIGhhbmRsZSBlcnJvcnMgcmV0dXJuZWQgZnJvbSBzZXJ2ZXJcbiAgaWYgKHJlc3VsdC5zdGF0dXMgPT09IHlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMuV0VCRFJJVkVSX1VOS05PV05fQ09NTUFORCkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuVW5rbm93bkNvbW1hbmRFcnJvcihyZXN1bHQudmFsdWUpO1xuICB9IGVsc2UgaWYgKHJlc3VsdC5zdGF0dXMgPT09IHlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMuV0VCRFJJVkVSX05PX1NVQ0hfRUxFTUVOVCkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuTm9TdWNoRWxlbWVudEVycm9yKHJlc3VsdC52YWx1ZSk7XG4gIH1cblxuICByZXR1cm4gcmVzdWx0LnZhbHVlO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgY29tbWFuZHM7XG4iXSwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
