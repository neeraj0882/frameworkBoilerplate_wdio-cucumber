'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

Object.defineProperty(exports, '__esModule', {
  value: true
});

var _appiumBaseDriver = require('appium-base-driver');

var _utils = require('../utils');

var commands = {};

commands.findElOrEls = function callee$0$0(strategy, selector, mult, context) {
  var createGetElementCommand, result, doFind;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    var _this = this;

    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        createGetElementCommand = function createGetElementCommand(strategy, selector, mult, context) {

          if (typeof context === "undefined" || !context) {
            context = '';
          }

          var ext = mult ? 's' : '';
          var commandObject = {
            args: ['' + selector, '' + context]
          };

          switch (strategy) {
            case "name":
              commandObject.name = 'getElement' + ext + 'ByName';
              break;
            case "accessibility id":
              commandObject.name = 'getElement' + ext + 'ByName';
              break;
            case "id":
              commandObject.name = 'getElement' + ext + 'ById';
              break;
            case "class name":
              commandObject.name = 'getElement' + ext + 'ByType';
              break;
            default:
              throw new Error("Unsupported strategy for findElOrEls: " + strategy);
          }

          return JSON.stringify(commandObject);
        };

        result = undefined;

        doFind = function doFind() {
          var findByAxIdCmd, res;
          return _regeneratorRuntime.async(function doFind$(context$2$0) {
            while (1) switch (context$2$0.prev = context$2$0.next) {
              case 0:
                findByAxIdCmd = createGetElementCommand(strategy, selector, mult, context);
                context$2$0.next = 3;
                return _regeneratorRuntime.awrap(this.executeSocketCommand(findByAxIdCmd));

              case 3:
                res = context$2$0.sent;
                context$2$0.prev = 4;

                result = JSON.parse(res);
                context$2$0.next = 11;
                break;

              case 8:
                context$2$0.prev = 8;
                context$2$0.t0 = context$2$0['catch'](4);
                throw new Error("Bad response from findElOrEls");

              case 11:
                if (!(result.status === _utils.youiEngineDriverReturnValues.WEBDRIVER_INVALID_SELECTOR)) {
                  context$2$0.next = 13;
                  break;
                }

                throw new _appiumBaseDriver.errors.InvalidSelectorError(result.value);

              case 13:
                if (!(result.value === "")) {
                  context$2$0.next = 15;
                  break;
                }

                return context$2$0.abrupt('return', false);

              case 15:
                return context$2$0.abrupt('return', true);

              case 16:
              case 'end':
                return context$2$0.stop();
            }
          }, null, _this, [[4, 8]]);
        };

        context$1$0.prev = 3;
        context$1$0.next = 6;
        return _regeneratorRuntime.awrap(this.implicitWaitForCondition(doFind));

      case 6:
        context$1$0.next = 15;
        break;

      case 8:
        context$1$0.prev = 8;
        context$1$0.t0 = context$1$0['catch'](3);

        if (!(context$1$0.t0.message && context$1$0.t0.message.match(/Condition unmet/))) {
          context$1$0.next = 14;
          break;
        }

        throw new _appiumBaseDriver.errors.NoSuchElementError(result.value);

      case 14:
        throw context$1$0.t0;

      case 15:
        return context$1$0.abrupt('return', result.value);

      case 16:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this, [[3, 8]]);
};

exports['default'] = commands;
module.exports = exports['default'];

// parse error

// looks like we have to check the status or resulting value to see that it's not empty.

// condition was not met, throw NoSuchElementError

// some other issue occurred, report it
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9maW5kLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O2dDQUF1QixvQkFBb0I7O3FCQUNFLFVBQVU7O0FBRXZELElBQUksUUFBUSxHQUFHLEVBQUUsQ0FBQzs7QUFFbEIsUUFBUSxDQUFDLFdBQVcsR0FBRyxvQkFBZ0IsUUFBUSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsT0FBTztNQUVsRSx1QkFBdUIsRUErQnZCLE1BQU0sRUFDTixNQUFNOzs7Ozs7QUFoQ04sK0JBQXVCLEdBQUcsU0FBMUIsdUJBQXVCLENBQWEsUUFBUSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFOztBQUV6RSxjQUFJLE9BQU8sT0FBTyxLQUFLLFdBQVcsSUFBSSxDQUFDLE9BQU8sRUFBRTtBQUM5QyxtQkFBTyxHQUFHLEVBQUUsQ0FBQztXQUNkOztBQUVELGNBQUksR0FBRyxHQUFHLElBQUksR0FBRyxHQUFHLEdBQUcsRUFBRSxDQUFDO0FBQzFCLGNBQUksYUFBYSxHQUFHO0FBQ2xCLGdCQUFJLEVBQUUsTUFBSSxRQUFRLE9BQU8sT0FBTyxDQUFHO1dBQ3BDLENBQUM7O0FBRUYsa0JBQVEsUUFBUTtBQUNkLGlCQUFLLE1BQU07QUFDVCwyQkFBYSxDQUFDLElBQUksa0JBQWdCLEdBQUcsV0FBUSxDQUFDO0FBQzlDLG9CQUFNO0FBQUEsQUFDUixpQkFBSyxrQkFBa0I7QUFDckIsMkJBQWEsQ0FBQyxJQUFJLGtCQUFnQixHQUFHLFdBQVEsQ0FBQztBQUM5QyxvQkFBTTtBQUFBLEFBQ1IsaUJBQUssSUFBSTtBQUNQLDJCQUFhLENBQUMsSUFBSSxrQkFBZ0IsR0FBRyxTQUFNLENBQUM7QUFDNUMsb0JBQU07QUFBQSxBQUNSLGlCQUFLLFlBQVk7QUFDZiwyQkFBYSxDQUFDLElBQUksa0JBQWdCLEdBQUcsV0FBUSxDQUFDO0FBQzlDLG9CQUFNO0FBQUEsQUFDUjtBQUNFLG9CQUFNLElBQUksS0FBSyxDQUFDLHdDQUF3QyxHQUFHLFFBQVEsQ0FBQyxDQUFDO0FBQUEsV0FDeEU7O0FBRUQsaUJBQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxhQUFhLENBQUMsQ0FBQztTQUN0Qzs7QUFFRyxjQUFNOztBQUNOLGNBQU0sR0FBRyxTQUFULE1BQU07Y0FDSixhQUFhLEVBRWIsR0FBRzs7OztBQUZILDZCQUFhLEdBQUcsdUJBQXVCLENBQUMsUUFBUSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsT0FBTyxDQUFDOztpREFFOUQsSUFBSSxDQUFDLG9CQUFvQixDQUFDLGFBQWEsQ0FBQzs7O0FBQXBELG1CQUFHOzs7QUFHTCxzQkFBTSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7Ozs7Ozs7c0JBR25CLElBQUksS0FBSyxDQUFDLCtCQUErQixDQUFDOzs7c0JBRTlDLE1BQU0sQ0FBQyxNQUFNLEtBQUssb0NBQTZCLDBCQUEwQixDQUFBOzs7OztzQkFDckUsSUFBSSx5QkFBTyxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDOzs7c0JBSWpELE1BQU0sQ0FBQyxLQUFLLEtBQUssRUFBRSxDQUFBOzs7OztvREFDZCxLQUFLOzs7b0RBRVAsSUFBSTs7Ozs7OztTQUNaOzs7O3lDQUdPLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxNQUFNLENBQUM7Ozs7Ozs7Ozs7Y0FFdkMsZUFBSSxPQUFPLElBQUksZUFBSSxPQUFPLENBQUMsS0FBSyxDQUFDLGlCQUFpQixDQUFDLENBQUE7Ozs7O2NBRS9DLElBQUkseUJBQU8sa0JBQWtCLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQzs7Ozs7OzRDQU05QyxNQUFNLENBQUMsS0FBSzs7Ozs7OztDQUNwQixDQUFDOztxQkFFYSxRQUFRIiwiZmlsZSI6ImxpYi9jb21tYW5kcy9maW5kLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXJyb3JzIH0gZnJvbSAnYXBwaXVtLWJhc2UtZHJpdmVyJztcbmltcG9ydCB7IHlvdWlFbmdpbmVEcml2ZXJSZXR1cm5WYWx1ZXMgfSBmcm9tICcuLi91dGlscyc7XG5cbmxldCBjb21tYW5kcyA9IHt9O1xuXG5jb21tYW5kcy5maW5kRWxPckVscyA9IGFzeW5jIGZ1bmN0aW9uIChzdHJhdGVneSwgc2VsZWN0b3IsIG11bHQsIGNvbnRleHQpIHtcblxuICBsZXQgY3JlYXRlR2V0RWxlbWVudENvbW1hbmQgPSBmdW5jdGlvbiAoc3RyYXRlZ3ksIHNlbGVjdG9yLCBtdWx0LCBjb250ZXh0KSB7XG5cbiAgICBpZiAodHlwZW9mIGNvbnRleHQgPT09IFwidW5kZWZpbmVkXCIgfHwgIWNvbnRleHQpIHtcbiAgICAgIGNvbnRleHQgPSAnJztcbiAgICB9XG5cbiAgICBsZXQgZXh0ID0gbXVsdCA/ICdzJyA6ICcnO1xuICAgIHZhciBjb21tYW5kT2JqZWN0ID0ge1xuICAgICAgYXJnczogW2Ake3NlbGVjdG9yfWAsIGAke2NvbnRleHR9YF1cbiAgICB9O1xuXG4gICAgc3dpdGNoIChzdHJhdGVneSkge1xuICAgICAgY2FzZSBcIm5hbWVcIjpcbiAgICAgICAgY29tbWFuZE9iamVjdC5uYW1lID0gYGdldEVsZW1lbnQke2V4dH1CeU5hbWVgO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJhY2Nlc3NpYmlsaXR5IGlkXCI6XG4gICAgICAgIGNvbW1hbmRPYmplY3QubmFtZSA9IGBnZXRFbGVtZW50JHtleHR9QnlOYW1lYDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiaWRcIjpcbiAgICAgICAgY29tbWFuZE9iamVjdC5uYW1lID0gYGdldEVsZW1lbnQke2V4dH1CeUlkYDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiY2xhc3MgbmFtZVwiOlxuICAgICAgICBjb21tYW5kT2JqZWN0Lm5hbWUgPSBgZ2V0RWxlbWVudCR7ZXh0fUJ5VHlwZWA7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5zdXBwb3J0ZWQgc3RyYXRlZ3kgZm9yIGZpbmRFbE9yRWxzOiBcIiArIHN0cmF0ZWd5KTtcbiAgICB9XG5cbiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoY29tbWFuZE9iamVjdCk7XG4gIH07XG5cbiAgbGV0IHJlc3VsdDtcbiAgbGV0IGRvRmluZCA9IGFzeW5jICgpID0+IHtcbiAgICBsZXQgZmluZEJ5QXhJZENtZCA9IGNyZWF0ZUdldEVsZW1lbnRDb21tYW5kKHN0cmF0ZWd5LCBzZWxlY3RvciwgbXVsdCwgY29udGV4dCk7XG5cbiAgICBsZXQgcmVzID0gYXdhaXQgdGhpcy5leGVjdXRlU29ja2V0Q29tbWFuZChmaW5kQnlBeElkQ21kKTtcblxuICAgIHRyeSB7XG4gICAgICByZXN1bHQgPSBKU09OLnBhcnNlKHJlcyk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgLy8gcGFyc2UgZXJyb3JcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkJhZCByZXNwb25zZSBmcm9tIGZpbmRFbE9yRWxzXCIpO1xuICAgIH1cbiAgICBpZiAocmVzdWx0LnN0YXR1cyA9PT0geW91aUVuZ2luZURyaXZlclJldHVyblZhbHVlcy5XRUJEUklWRVJfSU5WQUxJRF9TRUxFQ1RPUikge1xuICAgICAgdGhyb3cgbmV3IGVycm9ycy5JbnZhbGlkU2VsZWN0b3JFcnJvcihyZXN1bHQudmFsdWUpO1xuICAgIH1cbiAgICAgIFxuICAgIC8vIGxvb2tzIGxpa2Ugd2UgaGF2ZSB0byBjaGVjayB0aGUgc3RhdHVzIG9yIHJlc3VsdGluZyB2YWx1ZSB0byBzZWUgdGhhdCBpdCdzIG5vdCBlbXB0eS5cbiAgICBpZiAocmVzdWx0LnZhbHVlID09PSBcIlwiKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9O1xuXG4gIHRyeSB7XG4gICAgYXdhaXQgdGhpcy5pbXBsaWNpdFdhaXRGb3JDb25kaXRpb24oZG9GaW5kKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgaWYgKGVyci5tZXNzYWdlICYmIGVyci5tZXNzYWdlLm1hdGNoKC9Db25kaXRpb24gdW5tZXQvKSkge1xuICAgICAgLy8gY29uZGl0aW9uIHdhcyBub3QgbWV0LCB0aHJvdyBOb1N1Y2hFbGVtZW50RXJyb3JcbiAgICAgIHRocm93IG5ldyBlcnJvcnMuTm9TdWNoRWxlbWVudEVycm9yKHJlc3VsdC52YWx1ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIHNvbWUgb3RoZXIgaXNzdWUgb2NjdXJyZWQsIHJlcG9ydCBpdFxuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzdWx0LnZhbHVlO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgY29tbWFuZHM7XG4iXSwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
