require('source-map-support').install();

'use strict';

var _extends = require('babel-runtime/helpers/extends')['default'];

var _slicedToArray = require('babel-runtime/helpers/sliced-to-array')['default'];

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _wd = require('wd');

var _wd2 = _interopRequireDefault(_wd);

var _requestPromise = require('request-promise');

var _requestPromise2 = _interopRequireDefault(_requestPromise);

var _libMain = require('../lib/main');

var _helpers = require('./helpers');

var _appiumBaseDriver = require('appium-base-driver');

var _appiumFakeDriver = require('appium-fake-driver');

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

_chai2['default'].use(_chaiAsPromised2['default']);

var should = _chai2['default'].should();
var shouldStartServer = process.env.USE_RUNNING_SERVER !== "0";
var caps = { platformName: "Fake", deviceName: "Fake", app: _helpers.TEST_FAKE_APP };

describe('FakeDriver - via HTTP', function () {
  var server = null;
  var baseUrl = 'http://' + _helpers.TEST_HOST + ':' + _helpers.TEST_PORT + '/wd/hub/session';
  before(function callee$1$0() {
    var args;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          if (!shouldStartServer) {
            context$2$0.next = 5;
            break;
          }

          args = { port: _helpers.TEST_PORT, host: _helpers.TEST_HOST };
          context$2$0.next = 4;
          return _regeneratorRuntime.awrap((0, _libMain.main)(args));

        case 4:
          server = context$2$0.sent;

        case 5:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });
  after(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          if (!server) {
            context$2$0.next = 3;
            break;
          }

          context$2$0.next = 3;
          return _regeneratorRuntime.awrap(server.close());

        case 3:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  describe('session handling', function () {
    it('should start and stop a session', function callee$2$0() {
      var driver, _ref, _ref2, sessionId;

      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            driver = _wd2['default'].promiseChainRemote(_helpers.TEST_HOST, _helpers.TEST_PORT);
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(driver.init(caps));

          case 3:
            _ref = context$3$0.sent;
            _ref2 = _slicedToArray(_ref, 1);
            sessionId = _ref2[0];

            should.exist(sessionId);
            sessionId.should.be.a('string');
            context$3$0.next = 10;
            return _regeneratorRuntime.awrap(driver.quit());

          case 10:
            context$3$0.next = 12;
            return _regeneratorRuntime.awrap(driver.title().should.eventually.be.rejectedWith(/terminated/));

          case 12:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should be able to run two FakeDriver sessions simultaneously', function callee$2$0() {
      var driver1, _ref3, _ref32, sessionId1, driver2, _ref4, _ref42, sessionId2;

      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            driver1 = _wd2['default'].promiseChainRemote(_helpers.TEST_HOST, _helpers.TEST_PORT);
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(driver1.init(caps));

          case 3:
            _ref3 = context$3$0.sent;
            _ref32 = _slicedToArray(_ref3, 1);
            sessionId1 = _ref32[0];

            should.exist(sessionId1);
            sessionId1.should.be.a('string');
            driver2 = _wd2['default'].promiseChainRemote(_helpers.TEST_HOST, _helpers.TEST_PORT);
            context$3$0.next = 11;
            return _regeneratorRuntime.awrap(driver2.init(caps));

          case 11:
            _ref4 = context$3$0.sent;
            _ref42 = _slicedToArray(_ref4, 1);
            sessionId2 = _ref42[0];

            should.exist(sessionId2);
            sessionId2.should.be.a('string');
            sessionId1.should.not.equal(sessionId2);
            context$3$0.next = 19;
            return _regeneratorRuntime.awrap(driver1.quit());

          case 19:
            context$3$0.next = 21;
            return _regeneratorRuntime.awrap(driver2.quit());

          case 21:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should not be able to run two FakeDriver sessions simultaneously when one is unique', function callee$2$0() {
      var uniqueCaps, driver1, _ref5, _ref52, sessionId1, driver2;

      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            uniqueCaps = _lodash2['default'].clone(caps);

            uniqueCaps.uniqueApp = true;
            driver1 = _wd2['default'].promiseChainRemote(_helpers.TEST_HOST, _helpers.TEST_PORT);
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver1.init(uniqueCaps));

          case 5:
            _ref5 = context$3$0.sent;
            _ref52 = _slicedToArray(_ref5, 1);
            sessionId1 = _ref52[0];

            should.exist(sessionId1);
            sessionId1.should.be.a('string');
            driver2 = _wd2['default'].promiseChainRemote(_helpers.TEST_HOST, _helpers.TEST_PORT);
            context$3$0.next = 13;
            return _regeneratorRuntime.awrap(driver2.init(caps).should.eventually.be.rejected);

          case 13:
            context$3$0.next = 15;
            return _regeneratorRuntime.awrap(driver1.quit());

          case 15:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should use the newCommandTimeout of the inner Driver on session creation', function callee$2$0() {
      var driver, _ref6, _ref62, sessionId;

      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            driver = _wd2['default'].promiseChainRemote(_helpers.TEST_HOST, _helpers.TEST_PORT);

            caps.newCommandTimeout = 0.25;

            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(driver.init(caps));

          case 4:
            _ref6 = context$3$0.sent;
            _ref62 = _slicedToArray(_ref6, 1);
            sessionId = _ref62[0];

            should.exist(sessionId);

            context$3$0.next = 10;
            return _regeneratorRuntime.awrap(_bluebird2['default'].delay(250));

          case 10:
            context$3$0.next = 12;
            return _regeneratorRuntime.awrap(driver.source().should.eventually.be.rejectedWith(/terminated/));

          case 12:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should accept valid W3C capabilities and start a W3C session', function callee$2$0() {
      var w3cCaps, _ref7,

      // Create the session
      status, value, sessionId, _ref8, screenshotStatus, screenshotValue, _ref9,

      // Now use that sessionID to call an arbitrary W3C-only endpoint that isn't implemented to see if it responds with correct error
      statusCode, error, _error$value, errorMessage, message, stacktrace;

      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            w3cCaps = {
              capabilities: {
                alwaysMatch: { platformName: 'Fake' },
                firstMatch: [{ 'appium:deviceName': 'Fake', 'appium:app': _helpers.TEST_FAKE_APP }]
              }
            };
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(_requestPromise2['default'].post({ url: baseUrl, json: w3cCaps }));

          case 3:
            _ref7 = context$3$0.sent;
            status = _ref7.status;
            value = _ref7.value;
            sessionId = _ref7.sessionId;

            should.not.exist(status); // Test that it's a W3C session by checking that 'status' is not in the response
            should.not.exist(sessionId);
            value.sessionId.should.be.a.string;
            value.should.exist;
            value.capabilities.should.deep.equal({
              platformName: 'Fake',
              deviceName: 'Fake',
              app: _helpers.TEST_FAKE_APP
            });

            // Now use that sessionId to call /screenshot
            context$3$0.next = 14;
            return _regeneratorRuntime.awrap((0, _requestPromise2['default'])({ url: baseUrl + '/' + value.sessionId + '/screenshot', json: true }));

          case 14:
            _ref8 = context$3$0.sent;
            screenshotStatus = _ref8.status;
            screenshotValue = _ref8.value;

            should.not.exist(screenshotStatus);
            screenshotValue.should.equal('hahahanotreallyascreenshot');context$3$0.next = 21;
            return _regeneratorRuntime.awrap(_requestPromise2['default'].post({ url: baseUrl + '/' + value.sessionId + '/execute/async', json: { script: '', args: ['a'] } }).should.eventually.be.rejected);

          case 21:
            _ref9 = context$3$0.sent;
            statusCode = _ref9.statusCode;
            error = _ref9.error;

            statusCode.should.equal(404);
            _error$value = error.value;
            errorMessage = _error$value.error;
            message = _error$value.message;
            stacktrace = _error$value.stacktrace;

            errorMessage.should.match(/unknown method/);
            message.should.match(/Method has not yet been implemented/);
            stacktrace.should.match(/FakeDriver.executeCommand/);

            // End session
            context$3$0.next = 34;
            return _regeneratorRuntime.awrap(_requestPromise2['default']['delete']({ url: baseUrl + '/' + value.sessionId }).should.eventually.be.resolved);

          case 34:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should reject invalid W3C capabilities and respond with a 400 Bad Parameters error', function callee$2$0() {
      var badW3Ccaps, _ref10, statusCode, error;

      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            badW3Ccaps = {
              capabilities: {
                alwaysMatch: {},
                firstMatch: [{ 'appium:deviceName': 'Fake', 'appium:app': _helpers.TEST_FAKE_APP }]
              }
            };
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(_requestPromise2['default'].post({ url: baseUrl, json: badW3Ccaps }).should.eventually.be.rejected);

          case 3:
            _ref10 = context$3$0.sent;
            statusCode = _ref10.statusCode;
            error = _ref10.error;

            statusCode.should.equal(400);
            error.value.message.should.match(/can't be blank/);

          case 8:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should accept a combo of W3C and JSONWP capabilities but default to W3C', function callee$2$0() {
      var combinedCaps, _ref11, status, value, sessionId;

      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            combinedCaps = {
              "desiredCapabilities": _extends({}, caps),
              "capabilities": {
                "alwaysMatch": _extends({}, caps),
                "firstMatch": [{
                  w3cParam: 'w3cParam'
                }]
              }
            };
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(_requestPromise2['default'].post({ url: baseUrl, json: combinedCaps }));

          case 3:
            _ref11 = context$3$0.sent;
            status = _ref11.status;
            value = _ref11.value;
            sessionId = _ref11.sessionId;

            should.not.exist(status); // If it's a W3C session, should not respond with 'status'
            should.not.exist(sessionId);
            value.sessionId.should.exist;
            value.capabilities.should.deep.equal(_extends({}, caps, {
              w3cParam: 'w3cParam'
            }));

            // End session
            context$3$0.next = 13;
            return _regeneratorRuntime.awrap(_requestPromise2['default']['delete']({ url: baseUrl + '/' + value.sessionId }).should.eventually.be.resolved);

          case 13:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should accept a combo of W3C and JSONWP but use JSONWP if desiredCapabilities contains extraneous keys', function callee$2$0() {
      var combinedCaps, _ref12, sessionId, status, value;

      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            combinedCaps = {
              "desiredCapabilities": _extends({}, caps, {
                automationName: 'Fake',
                anotherParam: 'Hello'
              }),
              "capabilities": {
                "alwaysMatch": _extends({}, caps),
                "firstMatch": [{
                  w3cParam: 'w3cParam'
                }]
              }
            };
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(_requestPromise2['default'].post({ url: baseUrl, json: combinedCaps }));

          case 3:
            _ref12 = context$3$0.sent;
            sessionId = _ref12.sessionId;
            status = _ref12.status;
            value = _ref12.value;

            status.should.exist;
            sessionId.should.exist;
            should.not.exist(value.sessionId);
            value.should.deep.equal(_extends({}, caps, {
              automationName: 'Fake',
              anotherParam: 'Hello'
            }));

            // End session
            context$3$0.next = 13;
            return _regeneratorRuntime.awrap(_requestPromise2['default']['delete']({ url: baseUrl + '/' + value.sessionId }).should.eventually.be.resolved);

          case 13:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should reject bad W3C capabilities with a BadParametersError (400)', function callee$2$0() {
      var w3cCaps, _ref13, error, statusCode, response, message;

      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            w3cCaps = {
              "capabilities": {
                "alwaysMatch": _extends({}, caps, {
                  "automationName": "BadAutomationName"
                })
              }
            };
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(_requestPromise2['default'].post({ url: baseUrl, json: w3cCaps }).should.eventually.be.rejected);

          case 3:
            _ref13 = context$3$0.sent;
            error = _ref13.error;
            statusCode = _ref13.statusCode;
            response = _ref13.response;

            response.headers['content-type'].should.match(/application\/json/);
            message = error.value.message;

            message.should.match(/BadAutomationName not part of/);
            statusCode.should.equal(400);

          case 11:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should accept capabilities that are provided in the firstMatch array', function callee$2$0() {
      var w3cCaps, _ref14, value, sessionId, status;

      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            w3cCaps = {
              "capabilities": {
                "alwaysMatch": {},
                "firstMatch": [{}, _extends({}, caps)]
              }
            };
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(_requestPromise2['default'].post({ url: baseUrl, json: w3cCaps }));

          case 3:
            _ref14 = context$3$0.sent;
            value = _ref14.value;
            sessionId = _ref14.sessionId;
            status = _ref14.status;

            should.not.exist(status);
            should.not.exist(sessionId);
            value.capabilities.should.deep.equal(caps);

            // End session
            context$3$0.next = 12;
            return _regeneratorRuntime.awrap(_requestPromise2['default']['delete']({ url: baseUrl + '/' + value.sessionId }).should.eventually.be.resolved);

          case 12:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should fall back to MJSONWP if w3c caps are invalid', function callee$2$0() {
      var combinedCaps, _ref15, value, sessionId, status;

      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            combinedCaps = {
              "desiredCapabilities": _extends({}, caps),
              "capabilities": {
                "alwaysMatch": {},
                "firstMatch": [{}, _extends({}, caps, {
                  deviceName: null
                })]
              }
            };
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(_requestPromise2['default'].post({ url: baseUrl, json: combinedCaps }));

          case 3:
            _ref15 = context$3$0.sent;
            value = _ref15.value;
            sessionId = _ref15.sessionId;
            status = _ref15.status;

            status.should.exist;
            sessionId.should.exist;
            value.should.deep.equal(caps);

            // End session
            context$3$0.next = 12;
            return _regeneratorRuntime.awrap(_requestPromise2['default']['delete']({ url: baseUrl + '/' + value.sessionId }).should.eventually.be.resolved);

          case 12:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should fall back to MJSONWP if Inner Driver is not ready for W3C', function callee$2$0() {
      var combinedCaps, createSessionStub, _ref16, value, sessionId, status;

      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            combinedCaps = {
              "desiredCapabilities": _extends({}, caps),
              "capabilities": {
                "alwaysMatch": _extends({}, caps, {
                  deviceName: null
                })
              }
            };
            createSessionStub = _sinon2['default'].stub(_appiumFakeDriver.FakeDriver.prototype, 'createSession', function callee$3$0(jsonwpCaps) {
              var res;
              return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
                while (1) switch (context$4$0.prev = context$4$0.next) {
                  case 0:
                    context$4$0.next = 2;
                    return _regeneratorRuntime.awrap(_appiumBaseDriver.BaseDriver.prototype.createSession.call(this, jsonwpCaps));

                  case 2:
                    res = context$4$0.sent;

                    this.protocol.should.equal('MJSONWP');
                    return context$4$0.abrupt('return', res);

                  case 5:
                  case 'end':
                    return context$4$0.stop();
                }
              }, null, this);
            });
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(_requestPromise2['default'].post({ url: baseUrl, json: combinedCaps }));

          case 4:
            _ref16 = context$3$0.sent;
            value = _ref16.value;
            sessionId = _ref16.sessionId;
            status = _ref16.status;

            status.should.exist;
            sessionId.should.exist;
            value.should.deep.equal(caps);

            createSessionStub.restore();

          case 12:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should handle concurrent MJSONWP and W3C sessions', function callee$2$0() {
      var combinedCaps, _ref17, mjsonwpSessId, mjsonwpValue, status, _ref18, value, w3cSessId, mjsonwpPayload, w3cPayload;

      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            combinedCaps = {
              "desiredCapabilities": _extends({}, caps),
              "capabilities": {
                "alwaysMatch": _extends({}, caps)
              }
            };
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(_requestPromise2['default'].post({ url: baseUrl, json: _lodash2['default'].omit(combinedCaps, 'capabilities') }));

          case 3:
            _ref17 = context$3$0.sent;
            mjsonwpSessId = _ref17.sessionId;
            mjsonwpValue = _ref17.value;
            status = _ref17.status;
            context$3$0.next = 9;
            return _regeneratorRuntime.awrap(_requestPromise2['default'].post({ url: baseUrl, json: _lodash2['default'].omit(combinedCaps, 'desiredCapabilities') }));

          case 9:
            _ref18 = context$3$0.sent;
            value = _ref18.value;
            w3cSessId = value.sessionId;

            status.should.exist;
            mjsonwpValue.should.eql(caps);
            mjsonwpSessId.should.exist;
            value.sessionId.should.exist;
            value.capabilities.should.eql(caps);

            // Test that both return the proper payload based on their protocol
            context$3$0.next = 19;
            return _regeneratorRuntime.awrap((0, _requestPromise2['default'])(baseUrl + '/' + mjsonwpSessId, { json: true }));

          case 19:
            mjsonwpPayload = context$3$0.sent;
            context$3$0.next = 22;
            return _regeneratorRuntime.awrap((0, _requestPromise2['default'])(baseUrl + '/' + w3cSessId, { json: true }));

          case 22:
            w3cPayload = context$3$0.sent;

            // Test that the payloads are MJSONWP and W3C
            mjsonwpPayload.sessionId.should.exist;
            mjsonwpPayload.status.should.exist;
            mjsonwpPayload.value.should.eql(caps);
            should.not.exist(w3cPayload.sessionId);
            should.not.exist(w3cPayload.status);
            w3cPayload.value.should.eql(caps);

          case 29:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
  });
});

describe('Logsink', function () {
  var server = null;
  var logs = [];
  var logHandler = function logHandler(level, message) {
    logs.push([level, message]);
  };
  var args = { port: _helpers.TEST_PORT, host: _helpers.TEST_HOST, logHandler: logHandler };

  before(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap((0, _libMain.main)(args));

        case 2:
          server = context$2$0.sent;

        case 3:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  after(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(server.close());

        case 2:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  it('should send logs to a logHandler passed in by a parent package', function callee$1$0() {
    var welcomeIndex;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          logs.length.should.be.above(1);
          welcomeIndex = logs[0][1].includes('versions of node') ? 1 : 0;

          logs[welcomeIndex].length.should.equal(2);
          logs[welcomeIndex][1].should.include("Welcome to Appium");

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });
});

// Try with valid capabilities and check that it returns a session ID

// Have an MJSONWP and W3C session running concurrently
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZHJpdmVyLWUyZS1zcGVjcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7c0JBRWMsUUFBUTs7Ozt3QkFDUixVQUFVOzs7O29CQUNQLE1BQU07Ozs7OEJBQ0ksa0JBQWtCOzs7O2tCQUM5QixJQUFJOzs7OzhCQUNDLGlCQUFpQjs7Ozt1QkFDQSxhQUFhOzt1QkFDRSxXQUFXOztnQ0FDcEMsb0JBQW9COztnQ0FDcEIsb0JBQW9COztxQkFDN0IsT0FBTzs7OztBQUV6QixrQkFBSyxHQUFHLDZCQUFnQixDQUFDOztBQUV6QixJQUFNLE1BQU0sR0FBRyxrQkFBSyxNQUFNLEVBQUUsQ0FBQztBQUM3QixJQUFNLGlCQUFpQixHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0JBQWtCLEtBQUssR0FBRyxDQUFDO0FBQ2pFLElBQU0sSUFBSSxHQUFHLEVBQUMsWUFBWSxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLEdBQUcsd0JBQWUsRUFBQyxDQUFDOztBQUU1RSxRQUFRLENBQUMsdUJBQXVCLEVBQUUsWUFBWTtBQUM1QyxNQUFJLE1BQU0sR0FBRyxJQUFJLENBQUM7QUFDbEIsTUFBTSxPQUFPLGdGQUFvRCxDQUFDO0FBQ2xFLFFBQU0sQ0FBQztRQUVDLElBQUk7Ozs7ZUFETixpQkFBaUI7Ozs7O0FBQ2YsY0FBSSxHQUFHLEVBQUMsSUFBSSxvQkFBVyxFQUFFLElBQUksb0JBQVcsRUFBQzs7MkNBQzlCLG1CQUFhLElBQUksQ0FBQzs7O0FBQWpDLGdCQUFNOzs7Ozs7O0dBRVQsQ0FBQyxDQUFDO0FBQ0gsT0FBSyxDQUFDOzs7O2VBQ0EsTUFBTTs7Ozs7OzJDQUNGLE1BQU0sQ0FBQyxLQUFLLEVBQUU7Ozs7Ozs7R0FFdkIsQ0FBQyxDQUFDOztBQUVILFVBQVEsQ0FBQyxrQkFBa0IsRUFBRSxZQUFZO0FBQ3ZDLE1BQUUsQ0FBQyxpQ0FBaUMsRUFBRTtVQUNoQyxNQUFNLGVBQ0wsU0FBUzs7Ozs7QUFEVixrQkFBTSxHQUFH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QUFDOztBQUUxRCxRQUFNLENBQUM7Ozs7OzJDQUNVLG1CQUFhLElBQUksQ0FBQzs7O0FBQWpDLGdCQUFNOzs7Ozs7O0dBQ1AsQ0FBQyxDQUFDOztBQUVILE9BQUssQ0FBQzs7Ozs7MkNBQ0UsTUFBTSxDQUFDLEtBQUssRUFBRTs7Ozs7OztHQUNyQixDQUFDLENBQUM7O0FBRUgsSUFBRSxDQUFDLGdFQUFnRSxFQUFFO1FBRS9ELFlBQVk7Ozs7QUFEaEIsY0FBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUMzQixzQkFBWSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsa0JBQWtCLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQzs7QUFDbEUsY0FBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQzFDLGNBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLG1CQUFtQixDQUFDLENBQUM7Ozs7Ozs7R0FDM0QsQ0FBQyxDQUFDO0NBRUosQ0FBQyxDQUFDIiwiZmlsZSI6InRlc3QvZHJpdmVyLWUyZS1zcGVjcy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIHRyYW5zcGlsZTptb2NoYVxuXG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IGNoYWkgZnJvbSAnY2hhaSc7XG5pbXBvcnQgY2hhaUFzUHJvbWlzZWQgZnJvbSAnY2hhaS1hcy1wcm9taXNlZCc7XG5pbXBvcnQgd2QgZnJvbSAnd2QnO1xuaW1wb3J0IHJlcXVlc3QgZnJvbSAncmVxdWVzdC1wcm9taXNlJztcbmltcG9ydCB7IG1haW4gYXMgYXBwaXVtU2VydmVyIH0gZnJvbSAnLi4vbGliL21haW4nO1xuaW1wb3J0IHsgVEVTVF9GQUtFX0FQUCwgVEVTVF9IT1NULCBURVNUX1BPUlQgfSBmcm9tICcuL2hlbHBlcnMnO1xuaW1wb3J0IHsgQmFzZURyaXZlciB9IGZyb20gJ2FwcGl1bS1iYXNlLWRyaXZlcic7XG5pbXBvcnQgeyBGYWtlRHJpdmVyIH0gZnJvbSAnYXBwaXVtLWZha2UtZHJpdmVyJztcbmltcG9ydCBzaW5vbiBmcm9tICdzaW5vbic7XG5cbmNoYWkudXNlKGNoYWlBc1Byb21pc2VkKTtcblxuY29uc3Qgc2hvdWxkID0gY2hhaS5zaG91bGQoKTtcbmNvbnN0IHNob3VsZFN0YXJ0U2VydmVyID0gcHJvY2Vzcy5lbnYuVVNFX1JVTk5JTkdfU0VSVkVSICE9PSBcIjBcIjtcbmNvbnN0IGNhcHMgPSB7cGxhdGZvcm1OYW1lOiBcIkZha2VcIiwgZGV2aWNlTmFtZTogXCJGYWtlXCIsIGFwcDogVEVTVF9GQUtFX0FQUH07XG5cbmRlc2NyaWJlKCdGYWtlRHJpdmVyIC0gdmlhIEhUVFAnLCBmdW5jdGlvbiAoKSB7XG4gIGxldCBzZXJ2ZXIgPSBudWxsO1xuICBjb25zdCBiYXNlVXJsID0gYGh0dHA6Ly8ke1RFU1RfSE9TVH06JHtURVNUX1BPUlR9L3dkL2h1Yi9zZXNzaW9uYDtcbiAgYmVmb3JlKGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoc2hvdWxkU3RhcnRTZXJ2ZXIpIHtcbiAgICAgIGxldCBhcmdzID0ge3BvcnQ6IFRFU1RfUE9SVCwgaG9zdDogVEVTVF9IT1NUfTtcbiAgICAgIHNlcnZlciA9IGF3YWl0IGFwcGl1bVNlcnZlcihhcmdzKTtcbiAgICB9XG4gIH0pO1xuICBhZnRlcihhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHNlcnZlcikge1xuICAgICAgYXdhaXQgc2VydmVyLmNsb3NlKCk7XG4gICAgfVxuICB9KTtcblxuICBkZXNjcmliZSgnc2Vzc2lvbiBoYW5kbGluZycsIGZ1bmN0aW9uICgpIHtcbiAgICBpdCgnc2hvdWxkIHN0YXJ0IGFuZCBzdG9wIGEgc2Vzc2lvbicsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBkcml2ZXIgPSB3ZC5wcm9taXNlQ2hhaW5SZW1vdGUoVEVTVF9IT1NULCBURVNUX1BPUlQpO1xuICAgICAgbGV0IFtzZXNzaW9uSWRdID0gYXdhaXQgZHJpdmVyLmluaXQoY2Fwcyk7XG4gICAgICBzaG91bGQuZXhpc3Qoc2Vzc2lvbklkKTtcbiAgICAgIHNlc3Npb25JZC5zaG91bGQuYmUuYSgnc3RyaW5nJyk7XG4gICAgICBhd2FpdCBkcml2ZXIucXVpdCgpO1xuICAgICAgYXdhaXQgZHJpdmVyLnRpdGxlKCkuc2hvdWxkLmV2ZW50dWFsbHkuYmUucmVqZWN0ZWRXaXRoKC90ZXJtaW5hdGVkLyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGJlIGFibGUgdG8gcnVuIHR3byBGYWtlRHJpdmVyIHNlc3Npb25zIHNpbXVsdGFuZW91c2x5JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IGRyaXZlcjEgPSB3ZC5wcm9taXNlQ2hhaW5SZW1vdGUoVEVTVF9IT1NULCBURVNUX1BPUlQpO1xuICAgICAgbGV0IFtzZXNzaW9uSWQxXSA9IGF3YWl0IGRyaXZlcjEuaW5pdChjYXBzKTtcbiAgICAgIHNob3VsZC5leGlzdChzZXNzaW9uSWQxKTtcbiAgICAgIHNlc3Npb25JZDEuc2hvdWxkLmJlLmEoJ3N0cmluZycpO1xuICAgICAgbGV0IGRyaXZlcjIgPSB3ZC5wcm9taXNlQ2hhaW5SZW1vdGUoVEVTVF9IT1NULCBURVNUX1BPUlQpO1xuICAgICAgbGV0IFtzZXNzaW9uSWQyXSA9IGF3YWl0IGRyaXZlcjIuaW5pdChjYXBzKTtcbiAgICAgIHNob3VsZC5leGlzdChzZXNzaW9uSWQyKTtcbiAgICAgIHNlc3Npb25JZDIuc2hvdWxkLmJlLmEoJ3N0cmluZycpO1xuICAgICAgc2Vzc2lvbklkMS5zaG91bGQubm90LmVxdWFsKHNlc3Npb25JZDIpO1xuICAgICAgYXdhaXQgZHJpdmVyMS5xdWl0KCk7XG4gICAgICBhd2FpdCBkcml2ZXIyLnF1aXQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbm90IGJlIGFibGUgdG8gcnVuIHR3byBGYWtlRHJpdmVyIHNlc3Npb25zIHNpbXVsdGFuZW91c2x5IHdoZW4gb25lIGlzIHVuaXF1ZScsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCB1bmlxdWVDYXBzID0gXy5jbG9uZShjYXBzKTtcbiAgICAgIHVuaXF1ZUNhcHMudW5pcXVlQXBwID0gdHJ1ZTtcbiAgICAgIGxldCBkcml2ZXIxID0gd2QucHJvbWlzZUNoYWluUmVtb3RlKFRFU1RfSE9TVCwgVEVTVF9QT1JUKTtcbiAgICAgIGxldCBbc2Vzc2lvbklkMV0gPSBhd2FpdCBkcml2ZXIxLmluaXQodW5pcXVlQ2Fwcyk7XG4gICAgICBzaG91bGQuZXhpc3Qoc2Vzc2lvbklkMSk7XG4gICAgICBzZXNzaW9uSWQxLnNob3VsZC5iZS5hKCdzdHJpbmcnKTtcbiAgICAgIGxldCBkcml2ZXIyID0gd2QucHJvbWlzZUNoYWluUmVtb3RlKFRFU1RfSE9TVCwgVEVTVF9QT1JUKTtcbiAgICAgIGF3YWl0IGRyaXZlcjIuaW5pdChjYXBzKS5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZDtcbiAgICAgIGF3YWl0IGRyaXZlcjEucXVpdCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1c2UgdGhlIG5ld0NvbW1hbmRUaW1lb3V0IG9mIHRoZSBpbm5lciBEcml2ZXIgb24gc2Vzc2lvbiBjcmVhdGlvbicsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBkcml2ZXIgPSB3ZC5wcm9taXNlQ2hhaW5SZW1vdGUoVEVTVF9IT1NULCBURVNUX1BPUlQpO1xuXG4gICAgICBjYXBzLm5ld0NvbW1hbmRUaW1lb3V0ID0gMC4yNTtcblxuICAgICAgbGV0IFtzZXNzaW9uSWRdID0gYXdhaXQgZHJpdmVyLmluaXQoY2Fwcyk7XG4gICAgICBzaG91bGQuZXhpc3Qoc2Vzc2lvbklkKTtcblxuICAgICAgYXdhaXQgQi5kZWxheSgyNTApO1xuICAgICAgYXdhaXQgZHJpdmVyLnNvdXJjZSgpLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlamVjdGVkV2l0aCgvdGVybWluYXRlZC8pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhY2NlcHQgdmFsaWQgVzNDIGNhcGFiaWxpdGllcyBhbmQgc3RhcnQgYSBXM0Mgc2Vzc2lvbicsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vIFRyeSB3aXRoIHZhbGlkIGNhcGFiaWxpdGllcyBhbmQgY2hlY2sgdGhhdCBpdCByZXR1cm5zIGEgc2Vzc2lvbiBJRFxuICAgICAgY29uc3QgdzNjQ2FwcyA9IHtcbiAgICAgICAgY2FwYWJpbGl0aWVzOiB7XG4gICAgICAgICAgYWx3YXlzTWF0Y2g6IHtwbGF0Zm9ybU5hbWU6ICdGYWtlJ30sXG4gICAgICAgICAgZmlyc3RNYXRjaDogW3snYXBwaXVtOmRldmljZU5hbWUnOiAnRmFrZScsICdhcHBpdW06YXBwJzogVEVTVF9GQUtFX0FQUH1dLFxuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICAvLyBDcmVhdGUgdGhlIHNlc3Npb25cbiAgICAgIGNvbnN0IHtzdGF0dXMsIHZhbHVlLCBzZXNzaW9uSWR9ID0gYXdhaXQgcmVxdWVzdC5wb3N0KHt1cmw6IGJhc2VVcmwsIGpzb246IHczY0NhcHN9KTtcbiAgICAgIHNob3VsZC5ub3QuZXhpc3Qoc3RhdHVzKTsgLy8gVGVzdCB0aGF0IGl0J3MgYSBXM0Mgc2Vzc2lvbiBieSBjaGVja2luZyB0aGF0ICdzdGF0dXMnIGlzIG5vdCBpbiB0aGUgcmVzcG9uc2VcbiAgICAgIHNob3VsZC5ub3QuZXhpc3Qoc2Vzc2lvbklkKTtcbiAgICAgIHZhbHVlLnNlc3Npb25JZC5zaG91bGQuYmUuYS5zdHJpbmc7XG4gICAgICB2YWx1ZS5zaG91bGQuZXhpc3Q7XG4gICAgICB2YWx1ZS5jYXBhYmlsaXRpZXMuc2hvdWxkLmRlZXAuZXF1YWwoe1xuICAgICAgICBwbGF0Zm9ybU5hbWU6ICdGYWtlJyxcbiAgICAgICAgZGV2aWNlTmFtZTogJ0Zha2UnLFxuICAgICAgICBhcHA6IFRFU1RfRkFLRV9BUFAsXG4gICAgICB9KTtcblxuICAgICAgLy8gTm93IHVzZSB0aGF0IHNlc3Npb25JZCB0byBjYWxsIC9zY3JlZW5zaG90XG4gICAgICBjb25zdCB7c3RhdHVzOnNjcmVlbnNob3RTdGF0dXMsIHZhbHVlOnNjcmVlbnNob3RWYWx1ZX0gPSBhd2FpdCByZXF1ZXN0KHt1cmw6IGAke2Jhc2VVcmx9LyR7dmFsdWUuc2Vzc2lvbklkfS9zY3JlZW5zaG90YCwganNvbjogdHJ1ZX0pO1xuICAgICAgc2hvdWxkLm5vdC5leGlzdChzY3JlZW5zaG90U3RhdHVzKTtcbiAgICAgIHNjcmVlbnNob3RWYWx1ZS5zaG91bGQuZXF1YWwoJ2hhaGFoYW5vdHJlYWxseWFzY3JlZW5zaG90Jyk7XG5cbiAgICAgIC8vIE5vdyB1c2UgdGhhdCBzZXNzaW9uSUQgdG8gY2FsbCBhbiBhcmJpdHJhcnkgVzNDLW9ubHkgZW5kcG9pbnQgdGhhdCBpc24ndCBpbXBsZW1lbnRlZCB0byBzZWUgaWYgaXQgcmVzcG9uZHMgd2l0aCBjb3JyZWN0IGVycm9yXG4gICAgICBjb25zdCB7c3RhdHVzQ29kZSwgZXJyb3J9ID0gYXdhaXQgcmVxdWVzdC5wb3N0KHt1cmw6IGAke2Jhc2VVcmx9LyR7dmFsdWUuc2Vzc2lvbklkfS9leGVjdXRlL2FzeW5jYCwganNvbjoge3NjcmlwdDogJycsIGFyZ3M6IFsnYSddfX0pLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlamVjdGVkO1xuICAgICAgc3RhdHVzQ29kZS5zaG91bGQuZXF1YWwoNDA0KTtcbiAgICAgIGNvbnN0IHtlcnJvcjplcnJvck1lc3NhZ2UsIG1lc3NhZ2UsIHN0YWNrdHJhY2V9ID0gZXJyb3IudmFsdWU7XG4gICAgICBlcnJvck1lc3NhZ2Uuc2hvdWxkLm1hdGNoKC91bmtub3duIG1ldGhvZC8pO1xuICAgICAgbWVzc2FnZS5zaG91bGQubWF0Y2goL01ldGhvZCBoYXMgbm90IHlldCBiZWVuIGltcGxlbWVudGVkLyk7XG4gICAgICBzdGFja3RyYWNlLnNob3VsZC5tYXRjaCgvRmFrZURyaXZlci5leGVjdXRlQ29tbWFuZC8pO1xuXG4gICAgICAvLyBFbmQgc2Vzc2lvblxuICAgICAgYXdhaXQgcmVxdWVzdC5kZWxldGUoe3VybDogYCR7YmFzZVVybH0vJHt2YWx1ZS5zZXNzaW9uSWR9YH0pLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlc29sdmVkO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgaW52YWxpZCBXM0MgY2FwYWJpbGl0aWVzIGFuZCByZXNwb25kIHdpdGggYSA0MDAgQmFkIFBhcmFtZXRlcnMgZXJyb3InLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBiYWRXM0NjYXBzID0ge1xuICAgICAgICBjYXBhYmlsaXRpZXM6IHtcbiAgICAgICAgICBhbHdheXNNYXRjaDoge30sXG4gICAgICAgICAgZmlyc3RNYXRjaDogW3snYXBwaXVtOmRldmljZU5hbWUnOiAnRmFrZScsICdhcHBpdW06YXBwJzogVEVTVF9GQUtFX0FQUH1dLFxuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBjb25zdCB7c3RhdHVzQ29kZSwgZXJyb3J9ID0gYXdhaXQgcmVxdWVzdC5wb3N0KHt1cmw6IGJhc2VVcmwsIGpzb246IGJhZFczQ2NhcHN9KS5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZDtcbiAgICAgIHN0YXR1c0NvZGUuc2hvdWxkLmVxdWFsKDQwMCk7XG4gICAgICBlcnJvci52YWx1ZS5tZXNzYWdlLnNob3VsZC5tYXRjaCgvY2FuJ3QgYmUgYmxhbmsvKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYWNjZXB0IGEgY29tYm8gb2YgVzNDIGFuZCBKU09OV1AgY2FwYWJpbGl0aWVzIGJ1dCBkZWZhdWx0IHRvIFczQycsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGNvbWJpbmVkQ2FwcyA9IHtcbiAgICAgICAgXCJkZXNpcmVkQ2FwYWJpbGl0aWVzXCI6IHtcbiAgICAgICAgICAuLi5jYXBzLFxuICAgICAgICB9LFxuICAgICAgICBcImNhcGFiaWxpdGllc1wiOiB7XG4gICAgICAgICAgXCJhbHdheXNNYXRjaFwiOiB7Li4uY2Fwc30sXG4gICAgICAgICAgXCJmaXJzdE1hdGNoXCI6IFt7XG4gICAgICAgICAgICB3M2NQYXJhbTogJ3czY1BhcmFtJyxcbiAgICAgICAgICB9XSxcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgY29uc3Qge3N0YXR1cywgdmFsdWUsIHNlc3Npb25JZH0gPSBhd2FpdCByZXF1ZXN0LnBvc3Qoe3VybDogYmFzZVVybCwganNvbjogY29tYmluZWRDYXBzfSk7XG4gICAgICBzaG91bGQubm90LmV4aXN0KHN0YXR1cyk7IC8vIElmIGl0J3MgYSBXM0Mgc2Vzc2lvbiwgc2hvdWxkIG5vdCByZXNwb25kIHdpdGggJ3N0YXR1cydcbiAgICAgIHNob3VsZC5ub3QuZXhpc3Qoc2Vzc2lvbklkKTtcbiAgICAgIHZhbHVlLnNlc3Npb25JZC5zaG91bGQuZXhpc3Q7XG4gICAgICB2YWx1ZS5jYXBhYmlsaXRpZXMuc2hvdWxkLmRlZXAuZXF1YWwoe1xuICAgICAgICAuLi5jYXBzLFxuICAgICAgICB3M2NQYXJhbTogJ3czY1BhcmFtJyxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBFbmQgc2Vzc2lvblxuICAgICAgYXdhaXQgcmVxdWVzdC5kZWxldGUoeyB1cmw6IGAke2Jhc2VVcmx9LyR7dmFsdWUuc2Vzc2lvbklkfWAgfSkuc2hvdWxkLmV2ZW50dWFsbHkuYmUucmVzb2x2ZWQ7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFjY2VwdCBhIGNvbWJvIG9mIFczQyBhbmQgSlNPTldQIGJ1dCB1c2UgSlNPTldQIGlmIGRlc2lyZWRDYXBhYmlsaXRpZXMgY29udGFpbnMgZXh0cmFuZW91cyBrZXlzJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgY29tYmluZWRDYXBzID0ge1xuICAgICAgICBcImRlc2lyZWRDYXBhYmlsaXRpZXNcIjoge1xuICAgICAgICAgIC4uLmNhcHMsXG4gICAgICAgICAgYXV0b21hdGlvbk5hbWU6ICdGYWtlJyxcbiAgICAgICAgICBhbm90aGVyUGFyYW06ICdIZWxsbycsXG4gICAgICAgIH0sXG4gICAgICAgIFwiY2FwYWJpbGl0aWVzXCI6IHtcbiAgICAgICAgICBcImFsd2F5c01hdGNoXCI6IHsuLi5jYXBzfSxcbiAgICAgICAgICBcImZpcnN0TWF0Y2hcIjogW3tcbiAgICAgICAgICAgIHczY1BhcmFtOiAndzNjUGFyYW0nLFxuICAgICAgICAgIH1dLFxuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBjb25zdCB7c2Vzc2lvbklkLCBzdGF0dXMsIHZhbHVlfSA9IGF3YWl0IHJlcXVlc3QucG9zdCh7dXJsOiBiYXNlVXJsLCBqc29uOiBjb21iaW5lZENhcHN9KTtcbiAgICAgIHN0YXR1cy5zaG91bGQuZXhpc3Q7XG4gICAgICBzZXNzaW9uSWQuc2hvdWxkLmV4aXN0O1xuICAgICAgc2hvdWxkLm5vdC5leGlzdCh2YWx1ZS5zZXNzaW9uSWQpO1xuICAgICAgdmFsdWUuc2hvdWxkLmRlZXAuZXF1YWwoe1xuICAgICAgICAuLi5jYXBzLFxuICAgICAgICBhdXRvbWF0aW9uTmFtZTogJ0Zha2UnLFxuICAgICAgICBhbm90aGVyUGFyYW06ICdIZWxsbycsXG4gICAgICB9KTtcblxuICAgICAgLy8gRW5kIHNlc3Npb25cbiAgICAgIGF3YWl0IHJlcXVlc3QuZGVsZXRlKHsgdXJsOiBgJHtiYXNlVXJsfS8ke3ZhbHVlLnNlc3Npb25JZH1gIH0pLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlc29sdmVkO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgYmFkIFczQyBjYXBhYmlsaXRpZXMgd2l0aCBhIEJhZFBhcmFtZXRlcnNFcnJvciAoNDAwKScsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IHczY0NhcHMgPSB7XG4gICAgICAgIFwiY2FwYWJpbGl0aWVzXCI6IHtcbiAgICAgICAgICBcImFsd2F5c01hdGNoXCI6IHtcbiAgICAgICAgICAgIC4uLmNhcHMsXG4gICAgICAgICAgICBcImF1dG9tYXRpb25OYW1lXCI6IFwiQmFkQXV0b21hdGlvbk5hbWVcIixcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgICAgY29uc3Qge2Vycm9yLCBzdGF0dXNDb2RlLCByZXNwb25zZX0gPSBhd2FpdCByZXF1ZXN0LnBvc3Qoe3VybDogYmFzZVVybCwganNvbjogdzNjQ2Fwc30pLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlamVjdGVkO1xuICAgICAgcmVzcG9uc2UuaGVhZGVyc1snY29udGVudC10eXBlJ10uc2hvdWxkLm1hdGNoKC9hcHBsaWNhdGlvblxcL2pzb24vKTtcbiAgICAgIGNvbnN0IHttZXNzYWdlfSA9IGVycm9yLnZhbHVlO1xuICAgICAgbWVzc2FnZS5zaG91bGQubWF0Y2goL0JhZEF1dG9tYXRpb25OYW1lIG5vdCBwYXJ0IG9mLyk7XG4gICAgICBzdGF0dXNDb2RlLnNob3VsZC5lcXVhbCg0MDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhY2NlcHQgY2FwYWJpbGl0aWVzIHRoYXQgYXJlIHByb3ZpZGVkIGluIHRoZSBmaXJzdE1hdGNoIGFycmF5JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgdzNjQ2FwcyA9IHtcbiAgICAgICAgXCJjYXBhYmlsaXRpZXNcIjoge1xuICAgICAgICAgIFwiYWx3YXlzTWF0Y2hcIjoge30sXG4gICAgICAgICAgXCJmaXJzdE1hdGNoXCI6IFt7fSwge1xuICAgICAgICAgICAgLi4uY2Fwc1xuICAgICAgICAgIH1dLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICAgIGNvbnN0IHt2YWx1ZSwgc2Vzc2lvbklkLCBzdGF0dXN9ID0gYXdhaXQgcmVxdWVzdC5wb3N0KHt1cmw6IGJhc2VVcmwsIGpzb246IHczY0NhcHN9KTtcbiAgICAgIHNob3VsZC5ub3QuZXhpc3Qoc3RhdHVzKTtcbiAgICAgIHNob3VsZC5ub3QuZXhpc3Qoc2Vzc2lvbklkKTtcbiAgICAgIHZhbHVlLmNhcGFiaWxpdGllcy5zaG91bGQuZGVlcC5lcXVhbChjYXBzKTtcblxuICAgICAgLy8gRW5kIHNlc3Npb25cbiAgICAgIGF3YWl0IHJlcXVlc3QuZGVsZXRlKHsgdXJsOiBgJHtiYXNlVXJsfS8ke3ZhbHVlLnNlc3Npb25JZH1gIH0pLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlc29sdmVkO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBmYWxsIGJhY2sgdG8gTUpTT05XUCBpZiB3M2MgY2FwcyBhcmUgaW52YWxpZCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGNvbWJpbmVkQ2FwcyA9IHtcbiAgICAgICAgXCJkZXNpcmVkQ2FwYWJpbGl0aWVzXCI6IHtcbiAgICAgICAgICAuLi5jYXBzLFxuICAgICAgICB9LFxuICAgICAgICBcImNhcGFiaWxpdGllc1wiOiB7XG4gICAgICAgICAgXCJhbHdheXNNYXRjaFwiOiB7fSxcbiAgICAgICAgICBcImZpcnN0TWF0Y2hcIjogW3t9LCB7XG4gICAgICAgICAgICAuLi5jYXBzLFxuICAgICAgICAgICAgZGV2aWNlTmFtZTogbnVsbCxcbiAgICAgICAgICB9XSxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgICBjb25zdCB7dmFsdWUsIHNlc3Npb25JZCwgc3RhdHVzfSA9IGF3YWl0IHJlcXVlc3QucG9zdCh7dXJsOiBiYXNlVXJsLCBqc29uOiBjb21iaW5lZENhcHN9KTtcbiAgICAgIHN0YXR1cy5zaG91bGQuZXhpc3Q7XG4gICAgICBzZXNzaW9uSWQuc2hvdWxkLmV4aXN0O1xuICAgICAgdmFsdWUuc2hvdWxkLmRlZXAuZXF1YWwoY2Fwcyk7XG5cbiAgICAgIC8vIEVuZCBzZXNzaW9uXG4gICAgICBhd2FpdCByZXF1ZXN0LmRlbGV0ZSh7IHVybDogYCR7YmFzZVVybH0vJHt2YWx1ZS5zZXNzaW9uSWR9YCB9KS5zaG91bGQuZXZlbnR1YWxseS5iZS5yZXNvbHZlZDtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZmFsbCBiYWNrIHRvIE1KU09OV1AgaWYgSW5uZXIgRHJpdmVyIGlzIG5vdCByZWFkeSBmb3IgVzNDJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgY29tYmluZWRDYXBzID0ge1xuICAgICAgICBcImRlc2lyZWRDYXBhYmlsaXRpZXNcIjoge1xuICAgICAgICAgIC4uLmNhcHMsXG4gICAgICAgIH0sXG4gICAgICAgIFwiY2FwYWJpbGl0aWVzXCI6IHtcbiAgICAgICAgICBcImFsd2F5c01hdGNoXCI6IHtcbiAgICAgICAgICAgIC4uLmNhcHMsXG4gICAgICAgICAgICBkZXZpY2VOYW1lOiBudWxsLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgICAgY29uc3QgY3JlYXRlU2Vzc2lvblN0dWIgPSBzaW5vbi5zdHViKEZha2VEcml2ZXIucHJvdG90eXBlLCAnY3JlYXRlU2Vzc2lvbicsIGFzeW5jIGZ1bmN0aW9uIChqc29ud3BDYXBzKSB7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IEJhc2VEcml2ZXIucHJvdG90eXBlLmNyZWF0ZVNlc3Npb24uY2FsbCh0aGlzLCBqc29ud3BDYXBzKTtcbiAgICAgICAgdGhpcy5wcm90b2NvbC5zaG91bGQuZXF1YWwoJ01KU09OV1AnKTtcbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCB7dmFsdWUsIHNlc3Npb25JZCwgc3RhdHVzfSA9IGF3YWl0IHJlcXVlc3QucG9zdCh7dXJsOiBiYXNlVXJsLCBqc29uOiBjb21iaW5lZENhcHN9KTtcbiAgICAgIHN0YXR1cy5zaG91bGQuZXhpc3Q7XG4gICAgICBzZXNzaW9uSWQuc2hvdWxkLmV4aXN0O1xuICAgICAgdmFsdWUuc2hvdWxkLmRlZXAuZXF1YWwoY2Fwcyk7XG5cbiAgICAgIGNyZWF0ZVNlc3Npb25TdHViLnJlc3RvcmUoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNvbmN1cnJlbnQgTUpTT05XUCBhbmQgVzNDIHNlc3Npb25zJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgY29tYmluZWRDYXBzID0ge1xuICAgICAgICBcImRlc2lyZWRDYXBhYmlsaXRpZXNcIjoge1xuICAgICAgICAgIC4uLmNhcHMsXG4gICAgICAgIH0sXG4gICAgICAgIFwiY2FwYWJpbGl0aWVzXCI6IHtcbiAgICAgICAgICBcImFsd2F5c01hdGNoXCI6IHtcbiAgICAgICAgICAgIC4uLmNhcHMsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIC8vIEhhdmUgYW4gTUpTT05XUCBhbmQgVzNDIHNlc3Npb24gcnVubmluZyBjb25jdXJyZW50bHlcbiAgICAgIGNvbnN0IHtzZXNzaW9uSWQ6bWpzb253cFNlc3NJZCwgdmFsdWU6bWpzb253cFZhbHVlLCBzdGF0dXN9ID0gYXdhaXQgcmVxdWVzdC5wb3N0KHt1cmw6IGJhc2VVcmwsIGpzb246IF8ub21pdChjb21iaW5lZENhcHMsICdjYXBhYmlsaXRpZXMnKX0pO1xuICAgICAgY29uc3Qge3ZhbHVlfSA9IGF3YWl0IHJlcXVlc3QucG9zdCh7dXJsOiBiYXNlVXJsLCBqc29uOiBfLm9taXQoY29tYmluZWRDYXBzLCAnZGVzaXJlZENhcGFiaWxpdGllcycpfSk7XG4gICAgICBjb25zdCB3M2NTZXNzSWQgPSB2YWx1ZS5zZXNzaW9uSWQ7XG5cbiAgICAgIHN0YXR1cy5zaG91bGQuZXhpc3Q7XG4gICAgICBtanNvbndwVmFsdWUuc2hvdWxkLmVxbChjYXBzKTtcbiAgICAgIG1qc29ud3BTZXNzSWQuc2hvdWxkLmV4aXN0O1xuICAgICAgdmFsdWUuc2Vzc2lvbklkLnNob3VsZC5leGlzdDtcbiAgICAgIHZhbHVlLmNhcGFiaWxpdGllcy5zaG91bGQuZXFsKGNhcHMpO1xuXG4gICAgICAvLyBUZXN0IHRoYXQgYm90aCByZXR1cm4gdGhlIHByb3BlciBwYXlsb2FkIGJhc2VkIG9uIHRoZWlyIHByb3RvY29sXG4gICAgICBjb25zdCBtanNvbndwUGF5bG9hZCA9IGF3YWl0IHJlcXVlc3QoYCR7YmFzZVVybH0vJHttanNvbndwU2Vzc0lkfWAsIHtqc29uOiB0cnVlfSk7XG4gICAgICBjb25zdCB3M2NQYXlsb2FkID0gYXdhaXQgcmVxdWVzdChgJHtiYXNlVXJsfS8ke3czY1Nlc3NJZH1gLCB7anNvbjogdHJ1ZX0pO1xuXG4gICAgICAvLyBUZXN0IHRoYXQgdGhlIHBheWxvYWRzIGFyZSBNSlNPTldQIGFuZCBXM0NcbiAgICAgIG1qc29ud3BQYXlsb2FkLnNlc3Npb25JZC5zaG91bGQuZXhpc3Q7XG4gICAgICBtanNvbndwUGF5bG9hZC5zdGF0dXMuc2hvdWxkLmV4aXN0O1xuICAgICAgbWpzb253cFBheWxvYWQudmFsdWUuc2hvdWxkLmVxbChjYXBzKTtcbiAgICAgIHNob3VsZC5ub3QuZXhpc3QodzNjUGF5bG9hZC5zZXNzaW9uSWQpO1xuICAgICAgc2hvdWxkLm5vdC5leGlzdCh3M2NQYXlsb2FkLnN0YXR1cyk7XG4gICAgICB3M2NQYXlsb2FkLnZhbHVlLnNob3VsZC5lcWwoY2Fwcyk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdMb2dzaW5rJywgZnVuY3Rpb24gKCkge1xuICBsZXQgc2VydmVyID0gbnVsbDtcbiAgbGV0IGxvZ3MgPSBbXTtcbiAgbGV0IGxvZ0hhbmRsZXIgPSAobGV2ZWwsIG1lc3NhZ2UpID0+IHtcbiAgICBsb2dzLnB1c2goW2xldmVsLCBtZXNzYWdlXSk7XG4gIH07XG4gIGxldCBhcmdzID0ge3BvcnQ6IFRFU1RfUE9SVCwgaG9zdDogVEVTVF9IT1NULCBsb2dIYW5kbGVyfTtcblxuICBiZWZvcmUoYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgIHNlcnZlciA9IGF3YWl0IGFwcGl1bVNlcnZlcihhcmdzKTtcbiAgfSk7XG5cbiAgYWZ0ZXIoYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgIGF3YWl0IHNlcnZlci5jbG9zZSgpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHNlbmQgbG9ncyB0byBhIGxvZ0hhbmRsZXIgcGFzc2VkIGluIGJ5IGEgcGFyZW50IHBhY2thZ2UnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgbG9ncy5sZW5ndGguc2hvdWxkLmJlLmFib3ZlKDEpO1xuICAgIGxldCB3ZWxjb21lSW5kZXggPSBsb2dzWzBdWzFdLmluY2x1ZGVzKCd2ZXJzaW9ucyBvZiBub2RlJykgPyAxIDogMDtcbiAgICBsb2dzW3dlbGNvbWVJbmRleF0ubGVuZ3RoLnNob3VsZC5lcXVhbCgyKTtcbiAgICBsb2dzW3dlbGNvbWVJbmRleF1bMV0uc2hvdWxkLmluY2x1ZGUoXCJXZWxjb21lIHRvIEFwcGl1bVwiKTtcbiAgfSk7XG5cbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIuLi8uLiJ9
